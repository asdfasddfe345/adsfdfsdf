import{j as e}from"./vendor-motion-_XdJ9pBm.js";import{u as M,r as i}from"./vendor-react-B4msnGgW.js";import{c as z,s as m,i as D,C as S,a as C,U as O,x as p,L as T,h as $}from"./index-BbSeE-q4.js";import{U as q}from"./user-check-BwtIKeEV.js";import{S as G}from"./search-DiwtcWwp.js";import"./vendor-pdf-B1igRwBP.js";import"./vendor-supabase-B_87WqdG.js";import"./vendor-forms-BxTF4-4_.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=z("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),k="primoboostai@gmail.com";class P{async isCurrentUserAdmin(){try{const{data:{session:s},error:a}=await m.auth.getSession();return a||!s?!1:s.user.email===k}catch(s){return console.error("AdminService: Error in isCurrentUserAdmin:",s),!1}}async getAdminStatus(){try{const{data:{session:s},error:a}=await m.auth.getSession();if(a||!s)return{authenticated:!1,user_id:null,user_email:null,profile_exists:!1,profile_role:null,metadata_role:null,is_admin_result:!1,timestamp:new Date().toISOString(),message:"Not authenticated"};const d=s.user.email===k;return{authenticated:!0,user_id:s.user.id,user_email:s.user.email||null,profile_exists:!0,profile_role:d?"admin":"client",metadata_role:d?"admin":"client",is_admin_result:d,timestamp:new Date().toISOString(),message:d?"Admin access granted":"Regular user"}}catch(s){return console.error("AdminService: Error in getAdminStatus:",s),null}}async verifyAndFixAdminAccess(){try{const{data:{session:s},error:a}=await m.auth.getSession();return a||!s?{success:!1,message:"No active session. Please log in."}:s.user.email===k?{success:!0,message:"Admin access verified successfully."}:{success:!1,message:"Admin access denied. Only primoboostai@gmail.com has admin privileges."}}catch(s){return console.error("AdminService: Error in verifyAndFixAdminAccess:",s),{success:!1,message:"Failed to verify admin access."}}}async getAllUsers(s="",a="all",d=50,c=0){try{const{data:n,error:o}=await m.rpc("get_all_users",{search_query:s,role_filter:a,limit_count:d,offset_count:c});if(o)throw console.error("Error fetching users:",o),new Error(o.message||"Failed to fetch users");return n}catch(n){throw console.error("Error in getAllUsers:",n),n}}async getUserStats(){try{const{data:s,error:a}=await m.from("user_profiles").select("role, is_active");if(a)throw console.error("Error fetching user stats:",a),new Error("Failed to fetch user statistics");const d=s.length,c=s.filter(l=>l.role==="admin").length,n=s.filter(l=>l.role==="client").length,o=s.filter(l=>l.is_active).length;return{totalUsers:d,totalAdmins:c,totalClients:n,activeUsers:o}}catch(s){throw console.error("Error in getUserStats:",s),s}}}const y=new P,Y=()=>{const j=M(),[s,a]=i.useState([]),[d,c]=i.useState(!0),[n,o]=i.useState(""),[l,E]=i.useState("all"),[g,N]=i.useState(null),[R,b]=i.useState(!1),[t,f]=i.useState(null),[u,F]=i.useState({totalUsers:0,totalAdmins:0,totalClients:0,activeUsers:0});i.useEffect(()=>{v(),w()},[l]);const v=async()=>{c(!0);try{const r=await y.getAllUsers(n,l);a(r)}catch(r){console.error("Error fetching users:",r),h("error","Failed to fetch users")}finally{c(!1)}},w=async()=>{try{const r=await y.getUserStats();F(r)}catch(r){console.error("Error fetching stats:",r)}},h=(r,x)=>{N({type:r,message:x}),setTimeout(()=>N(null),4e3)},A=(r,x,I)=>{f({userId:r,action:x,userName:I}),b(!0)},L=async()=>{if(t)try{let r;t.action==="grant"?r=await y.grantAdminRole(t.userId):r=await y.revokeAdminRole(t.userId),r.success?(h("success",r.message),await v(),await w()):h("error",r.message)}catch{h("error","Failed to update user role")}finally{b(!1),f(null)}},_=s.filter(r=>{if(!n)return!0;const x=n.toLowerCase();return r.full_name.toLowerCase().includes(x)||r.email_address.toLowerCase().includes(x)});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-dark-50 dark:to-dark-200 lg:pl-16",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40 dark:bg-dark-50 dark:border-dark-300",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-between h-16 py-3",children:[e.jsxs("button",{onClick:()=>j("/admin/jobs"),className:"lg:hidden bg-gradient-to-r from-neon-cyan-500 to-neon-blue-500 text-white hover:from-neon-cyan-400 hover:to-neon-blue-400 py-3 px-5 rounded-xl inline-flex items-center space-x-2 transition-all duration-200",children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:block",children:"Back to Jobs"})]}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"User Management"}),e.jsx("div",{className:"w-24"})]})})}),g&&e.jsx("div",{className:"fixed top-20 right-4 z-50 animate-fade-in-down",children:e.jsx("div",{className:`p-4 rounded-xl shadow-lg border ${g.type==="success"?"bg-green-50 border-green-200 text-green-800 dark:bg-neon-cyan-500/10 dark:border-neon-cyan-400/50 dark:text-neon-cyan-300":"bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-500/50 dark:text-red-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[g.type==="success"?e.jsx(S,{className:"w-5 h-5"}):e.jsx(C,{className:"w-5 h-5"}),e.jsx("p",{className:"font-medium",children:g.message})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white dark:bg-dark-100 rounded-xl shadow-md p-6 border border-gray-200 dark:border-dark-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:u.totalUsers})]}),e.jsx("div",{className:"bg-blue-100 dark:bg-neon-cyan-500/20 w-12 h-12 rounded-lg flex items-center justify-center",children:e.jsx(O,{className:"w-6 h-6 text-blue-600 dark:text-neon-cyan-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-dark-100 rounded-xl shadow-md p-6 border border-gray-200 dark:border-dark-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Administrators"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:u.totalAdmins})]}),e.jsx("div",{className:"bg-purple-100 dark:bg-purple-500/20 w-12 h-12 rounded-lg flex items-center justify-center",children:e.jsx(p,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-dark-100 rounded-xl shadow-md p-6 border border-gray-200 dark:border-dark-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Clients"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-neon-cyan-400",children:u.totalClients})]}),e.jsx("div",{className:"bg-green-100 dark:bg-neon-cyan-500/20 w-12 h-12 rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 text-green-600 dark:text-neon-cyan-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-dark-100 rounded-xl shadow-md p-6 border border-gray-200 dark:border-dark-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:u.activeUsers})]}),e.jsx("div",{className:"bg-gray-100 dark:bg-dark-200 w-12 h-12 rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"w-6 h-6 text-gray-600 dark:text-gray-400"})})]})})]}),e.jsx("div",{className:"bg-white dark:bg-dark-100 rounded-xl shadow-md border border-gray-200 dark:border-dark-300 p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:n,onChange:r=>o(r.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-dark-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-dark-200 dark:text-gray-100"})]}),e.jsxs("select",{value:l,onChange:r=>E(r.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-dark-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-dark-200 dark:text-gray-100",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Administrators Only"}),e.jsx("option",{value:"client",children:"Clients Only"})]})]})}),d?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(T,{className:"w-12 h-12 text-blue-600 dark:text-neon-cyan-400 animate-spin"})}):_.length===0?e.jsxs("div",{className:"bg-white dark:bg-dark-100 rounded-xl shadow-md border border-gray-200 dark:border-dark-300 p-12 text-center",children:[e.jsx(C,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"No users found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:n?"Try adjusting your search query":"No users match the selected filters"})]}):e.jsx("div",{className:"bg-white dark:bg-dark-100 rounded-xl shadow-md border border-gray-200 dark:border-dark-300 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-dark-200 border-b border-gray-200 dark:border-dark-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Resumes Created"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Joined"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-dark-300",children:_.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-dark-200 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-neon-cyan-500 to-neon-blue-500 w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold",children:r.full_name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.full_name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.email_address})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${r.role==="admin"?"bg-purple-100 text-purple-700 dark:bg-purple-500/20 dark:text-purple-300":"bg-gray-100 text-gray-700 dark:bg-dark-300 dark:text-gray-400"}`,children:r.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-3 h-3 mr-1"})," Admin"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-3 h-3 mr-1"})," Client"]})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-3 py-1 rounded-full text-sm font-medium ${r.is_active?"bg-green-100 text-green-700 dark:bg-neon-cyan-500/20 dark:text-neon-cyan-300":"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-300"}`,children:r.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 text-gray-600 dark:text-gray-400",children:r.resumes_created_count||0}),e.jsx("td",{className:"px-6 py-4 text-gray-600 dark:text-gray-400 text-sm",children:new Date(r.profile_created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:r.role==="admin"?e.jsxs("button",{onClick:()=>A(r.id,"revoke",r.full_name),className:"inline-flex items-center space-x-1 px-3 py-2 bg-red-50 hover:bg-red-100 dark:bg-red-500/10 dark:hover:bg-red-500/20 text-red-600 dark:text-red-400 rounded-lg transition-colors text-sm font-medium",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:"Revoke Admin"})]}):e.jsxs("button",{onClick:()=>A(r.id,"grant",r.full_name),className:"inline-flex items-center space-x-1 px-3 py-2 bg-purple-50 hover:bg-purple-100 dark:bg-purple-500/10 dark:hover:bg-purple-500/20 text-purple-600 dark:text-purple-400 rounded-lg transition-colors text-sm font-medium",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:"Grant Admin"})]})})]},r.id))})]})})})]}),R&&t&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-100 rounded-2xl shadow-2xl max-w-md w-full p-6 border border-gray-200 dark:border-dark-300",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${t.action==="grant"?"bg-purple-100 dark:bg-purple-500/20":"bg-red-100 dark:bg-red-900/20"}`,children:t.action==="grant"?e.jsx(p,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"}):e.jsx(U,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:t.action==="grant"?"Grant Admin Role?":"Revoke Admin Role?"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:t.action==="grant"?e.jsxs(e.Fragment,{children:["Are you sure you want to grant admin privileges to ",e.jsx("strong",{children:t.userName}),"? They will have full access to manage users, jobs, and system settings."]}):e.jsxs(e.Fragment,{children:["Are you sure you want to revoke admin privileges from ",e.jsx("strong",{children:t.userName}),"? They will be downgraded to a regular client account."]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{b(!1),f(null)},className:"flex-1 px-4 py-3 bg-gray-200 hover:bg-gray-300 dark:bg-dark-200 dark:hover:bg-dark-300 text-gray-700 dark:text-gray-300 rounded-xl font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:L,className:`flex-1 px-4 py-3 rounded-xl font-medium transition-colors text-white ${t.action==="grant"?"bg-purple-600 hover:bg-purple-700":"bg-red-600 hover:bg-red-700"}`,children:t.action==="grant"?"Grant Admin":"Revoke Admin"})]})]})})]})};export{Y as AdminUsersPage};
