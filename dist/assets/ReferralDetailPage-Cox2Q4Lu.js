import{j as e,m as B,A as le}from"./vendor-motion-_XdJ9pBm.js";import{r as i,f as oe,u as ne}from"./vendor-react-B4msnGgW.js";import{r as S}from"./referralService-D35ZF_Jn.js";import{u as ie,C as ce,n as de,h as me,q as xe,N as he,a as ue,r as pe,i as fe,B as be,O as ge,b as je,X as Ne,M as ye,a3 as we,t as ve}from"./index-BbSeE-q4.js";import{I as J}from"./indian-rupee-CtMJjFIv.js";import{C as Ce}from"./chevron-left-Dbkualgq.js";import{C as K}from"./chevron-right-CPxmRku4.js";import{B as Se}from"./building-2-B7dH_DvY.js";import{C as ke}from"./code-GxPtUTRK.js";import{S as _e}from"./search-DiwtcWwp.js";import{U as De}from"./user-check-BwtIKeEV.js";import{S as Be}from"./star-DBKesPgG.js";import"./vendor-pdf-B1igRwBP.js";import"./vendor-supabase-B_87WqdG.js";import"./vendor-forms-BxTF4-4_.js";const M={KEY_ID:"rzp_live_U7N6E8ot31tiej",CURRENCY:"INR",COMPANY_NAME:"PrimoJobs",THEME_COLOR:"#2563eb"},H=(c,r,o)=>{switch(r){case"query":return(o==null?void 0:o.query)??c.query_price;case"profile":return(o==null?void 0:o.profile)??c.profile_price;case"consultation":return(o==null?void 0:o.slot)??c.slot_price;default:return(o==null?void 0:o.slot)??c.slot_price}},Me=({listingId:c,slotType:r,title:o,subtitle:s,icon:R,accentColor:p,onShowAuth:P,listingQueryPrice:A,listingProfilePrice:$,listingSlotPrice:u})=>{const g={query:A,profile:$,slot:u},{isAuthenticated:y,user:x}=ie(),[n,a]=i.useState(null),[d,j]=i.useState(null),[q,Q]=i.useState([]),[W,F]=i.useState(!1),[k,E]=i.useState(null),[N,O]=i.useState(new Date),[h,_]=i.useState({name:"",email:"",phone:""}),[I,w]=i.useState("idle"),[T,v]=i.useState("");i.useEffect(()=>{S.getPricing().then(a)},[]),i.useEffect(()=>{x&&_({name:x.name||"",email:x.email||"",phone:""})},[x]);const U=async t=>{F(!0);const l=await S.getSlotsForDate(c,t,r);Q(l),F(!1)},X=t=>{j(t),E(null),v(""),U(t)},Z=t=>new Promise(l=>{const m={key:M.KEY_ID,amount:t,currency:M.CURRENCY,name:M.COMPANY_NAME,description:`${o} - Slot Booking`,prefill:{name:h.name,email:h.email,contact:h.phone||void 0},theme:{color:M.THEME_COLOR},handler:f=>{l({success:!0,paymentId:f.razorpay_payment_id})},modal:{ondismiss:()=>{l({success:!1,error:"Payment cancelled."})}}},b=new window.Razorpay(m);b.on("payment.failed",f=>{var C;l({success:!1,error:((C=f.error)==null?void 0:C.description)||"Payment failed."})}),b.open()}),V=async()=>{if(!y){P();return}if(!(x!=null&&x.id)||!d||!k||!n)return;if(!h.name||!h.email){v("Name and email are required.");return}w("processing"),v("");const t=H(n,r,g);if(t>0){const m=await Z(t);if(!m.success){w("idle"),v(m.error||"Payment was not completed.");return}}const l=await S.bookSlot(x.id,c,d,k,r,h.name,h.email,h.phone);l.success?(w("success"),U(d)):(w("error"),v(l.error||"Booking failed."))},ee=t=>{const l=t.getFullYear(),m=t.getMonth(),b=new Date(l,m,1).getDay(),f=new Date(l,m+1,0).getDate();return{firstDay:b,daysInMonth:f,year:l,month:m}},{firstDay:te,daysInMonth:se,year:z,month:G}=ee(N),Y=new Date;Y.setHours(0,0,0,0);const D=n?H(n,r,g)/100:0;return I==="success"?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-emerald-500/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(ce,{className:"w-8 h-8 text-emerald-400"})}),e.jsx("h3",{className:"text-white font-bold text-xl mb-2",children:"Slot Booked!"}),e.jsxs("p",{className:"text-slate-400 text-sm mb-2",children:["Your ",o.toLowerCase()," session has been confirmed."]}),e.jsx("p",{className:"text-slate-500 text-xs mb-4",children:"We will connect you for the call at your scheduled time."}),e.jsx("button",{onClick:()=>{w("idle"),E(null)},className:"px-6 py-2.5 bg-slate-800/60 border border-slate-700/40 text-white rounded-xl text-sm hover:bg-slate-700/60 transition-colors",children:"Book Another Slot"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${p} flex items-center justify-center`,children:R}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold",children:o}),e.jsx("p",{className:"text-slate-400 text-xs",children:s})]})]}),n&&D>0&&e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsx(J,{className:"w-3.5 h-3.5 text-emerald-400"}),e.jsx("span",{className:"text-emerald-400 font-bold text-sm",children:D}),e.jsx("span",{className:"text-slate-500 text-xs",children:"/slot"})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>O(new Date(N.getFullYear(),N.getMonth()-1)),className:"p-1.5 rounded-lg hover:bg-slate-700/50 text-slate-400 hover:text-white transition-colors",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-white font-medium text-sm",children:N.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>O(new Date(N.getFullYear(),N.getMonth()+1)),className:"p-1.5 rounded-lg hover:bg-slate-700/50 text-slate-400 hover:text-white transition-colors",children:e.jsx(K,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(t=>e.jsx("div",{className:"text-center text-slate-500 text-xs py-1",children:t},t))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:te}).map((t,l)=>e.jsx("div",{},`empty-${l}`)),Array.from({length:se}).map((t,l)=>{const m=l+1,b=new Date(z,G,m),f=`${z}-${String(G+1).padStart(2,"0")}-${String(m).padStart(2,"0")}`,C=b<Y,ae=d===f,re=b.getTime()===Y.getTime();return e.jsx("button",{disabled:C,onClick:()=>X(f),className:`py-2 rounded-lg text-xs font-medium transition-colors ${C?"text-slate-700 cursor-not-allowed":ae?"bg-emerald-500 text-white":re?"bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30":"text-slate-300 hover:bg-slate-700/50"}`,children:m},m)})]})]}),e.jsx("div",{children:d?W?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"w-6 h-6 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-400 text-sm mb-3",children:["Available slots for"," ",e.jsx("span",{className:"text-white font-medium",children:new Date(d+"T00:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),e.jsx("div",{className:"space-y-2 mb-5 max-h-64 overflow-y-auto",children:q.length===0?e.jsx("p",{className:"text-slate-500 text-sm text-center py-4",children:"No slots available for this date"}):q.map(t=>e.jsxs("button",{disabled:t.status==="booked"||t.status==="blocked",onClick:()=>E(t.time_slot),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl text-sm font-medium transition-all ${t.status==="booked"?"bg-red-500/10 text-red-400 border border-red-500/20 cursor-not-allowed":t.status==="blocked"?"bg-slate-800/60 text-slate-600 cursor-not-allowed":k===t.time_slot?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/40":"bg-slate-800/40 text-slate-300 border border-slate-700/40 hover:border-emerald-500/30"}`,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),t.label]}),e.jsx("span",{className:"text-xs",children:t.status==="booked"?"Booked":t.status==="blocked"?"Unavailable":"Available"})]},t.time_slot))}),k&&e.jsxs("div",{className:"space-y-3 border-t border-slate-700/40 pt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"text",placeholder:"Your Name",value:h.name,onChange:t=>_(l=>({...l,name:t.target.value})),className:"w-full pl-10 pr-4 py-2.5 bg-slate-800/60 border border-slate-700/50 rounded-xl text-white text-sm placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"email",placeholder:"Your Email",value:h.email,onChange:t=>_(l=>({...l,email:t.target.value})),className:"w-full pl-10 pr-4 py-2.5 bg-slate-800/60 border border-slate-700/50 rounded-xl text-white text-sm placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"tel",placeholder:"Phone (optional)",value:h.phone,onChange:t=>_(l=>({...l,phone:t.target.value})),className:"w-full pl-10 pr-4 py-2.5 bg-slate-800/60 border border-slate-700/50 rounded-xl text-white text-sm placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"})]}),T&&e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-xs bg-red-500/10 px-3 py-2 rounded-lg",children:[e.jsx(ue,{className:"w-3.5 h-3.5 flex-shrink-0"}),T]}),e.jsx("button",{onClick:V,disabled:I==="processing",className:"w-full px-4 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-semibold rounded-xl text-sm hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center gap-2",children:I==="processing"?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4"}),n&&D>0?`Pay ₹${D} & Confirm`:"Confirm Slot"]})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-slate-500 text-sm",children:"Select a date to view available slots"})})]})]})},L=[{key:"query",title:"Referral Query",subtitle:"15-min slots | Get referrer contact details",description:"Connect directly with the referrer to get your profile referred for this role.",features:["Direct referrer contact","Profile forwarding","15-min call slot"],icon:e.jsx(_e,{className:"w-5 h-5 text-blue-400"}),cardIcon:e.jsx(ye,{className:"w-6 h-6"}),accentColor:"text-blue-400",borderColor:"border-blue-500/30 hover:border-blue-500/60",bgGradient:"from-blue-500/5 to-blue-600/10",iconBg:"bg-blue-500/10",getPrice:(c,r)=>(r==null?void 0:r.query_price)??c.query_price},{key:"profile",title:"Profile Monetization",subtitle:"1-hour session | Profile shared with referrer",description:"Your resume and profile are shared with the referrer for a detailed review and referral.",features:["Resume shared with referrer","Detailed profile review","Priority referral"],icon:e.jsx(Be,{className:"w-5 h-5 text-amber-400"}),cardIcon:e.jsx(De,{className:"w-6 h-6"}),accentColor:"text-amber-400",borderColor:"border-amber-500/30 hover:border-amber-500/60",bgGradient:"from-amber-500/5 to-amber-600/10",iconBg:"bg-amber-500/10",getPrice:(c,r)=>(r==null?void 0:r.profile_price)??c.profile_price},{key:"consultation",title:"Consultation Slot",subtitle:"15-min slots | Resume review session",description:"Book a one-on-one consultation to get expert guidance on your resume and interview prep.",features:["1-on-1 expert guidance","Resume & interview tips","Personalized feedback"],icon:e.jsx(ve,{className:"w-5 h-5 text-emerald-400"}),cardIcon:e.jsx(we,{className:"w-6 h-6"}),accentColor:"text-emerald-400",borderColor:"border-emerald-500/30 hover:border-emerald-500/60",bgGradient:"from-emerald-500/5 to-emerald-600/10",iconBg:"bg-emerald-500/10",getPrice:(c,r)=>(r==null?void 0:r.slot_price)??c.slot_price}],He=({onShowAuth:c})=>{const{id:r}=oe(),o=ne(),[s,R]=i.useState(null),[p,P]=i.useState(null),[A,$]=i.useState(!0),[u,g]=i.useState(null),[y,x]=i.useState(!1);if(i.useEffect(()=>{(async()=>{if(!r)return;const[d,j]=await Promise.all([S.getListingById(r),S.getPricing()]);R(d),P(j),$(!1)})()},[r]),A)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin"})});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsx("p",{className:"text-slate-400 text-lg",children:"Referral not found."})});const n=u?L.find(a=>a.key===u):null;return e.jsx("div",{className:"min-h-screen pb-20 md:pl-16",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 pt-8 sm:pt-12",children:[e.jsxs("button",{onClick:()=>o("/referrals"),className:"flex items-center gap-2 text-slate-400 hover:text-white text-sm mb-6 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4"}),"Back to Referrals"]}),e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-[#0d1f2d] to-[#0a1a24] border border-slate-700/50 rounded-2xl overflow-hidden mb-8",children:e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[s.company_logo_url?e.jsx("img",{src:s.company_logo_url,alt:s.company_name,className:"w-16 h-16 rounded-xl object-contain bg-white/5 p-2 flex-shrink-0"}):e.jsx("div",{className:"w-16 h-16 rounded-xl bg-emerald-500/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Se,{className:"w-8 h-8 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:s.company_name}),e.jsx("p",{className:"text-slate-300 text-lg font-medium",children:s.role_title})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[s.experience_range&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-slate-800/60 text-slate-300 text-sm",children:[e.jsx(be,{className:"w-4 h-4"}),s.experience_range]}),s.package_range&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-slate-800/60 text-slate-300 text-sm",children:[e.jsx(J,{className:"w-4 h-4"}),s.package_range]}),s.location&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-slate-800/60 text-slate-300 text-sm",children:[e.jsx(ge,{className:"w-4 h-4"}),s.location]})]}),s.tech_stack.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-2",children:"Tech Stack"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tech_stack.map(a=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-md bg-emerald-500/10 text-emerald-400 text-sm font-medium",children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),a]},a))})]}),s.job_description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-2",children:"Job Description"}),e.jsx("div",{className:"bg-slate-800/40 rounded-xl p-4 text-slate-300 text-sm leading-relaxed whitespace-pre-wrap max-h-64 overflow-y-auto",children:s.job_description})]}),s.referrer_name&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-slate-700/40 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400 font-bold",children:s.referrer_name[0]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-white font-medium text-sm",children:["Referred by ",s.referrer_name]}),s.referrer_designation&&e.jsx("p",{className:"text-slate-400 text-xs",children:s.referrer_designation})]})]})]})}),!u&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-white font-bold text-xl mb-4",children:"Choose a Service"}),e.jsx("div",{className:"grid sm:grid-cols-3 gap-4 mb-6",children:L.map(a=>{const d=p?a.getPrice(p,s)/100:0;return e.jsxs(B.button,{onClick:()=>g(a.key),whileHover:{y:-2},whileTap:{scale:.98},className:"relative text-left p-5 rounded-2xl border bg-[#0d1f2d]/80 border-slate-700/40 hover:border-slate-600/60 transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:`w-11 h-11 rounded-xl ${a.iconBg} flex items-center justify-center ${a.accentColor}`,children:a.cardIcon}),p&&d>0&&e.jsxs("span",{className:`text-lg font-bold ${a.accentColor}`,children:["₹",d]})]}),e.jsx("h3",{className:"text-white font-bold text-base mb-1",children:a.title}),e.jsx("p",{className:"text-slate-400 text-xs leading-relaxed mb-3",children:a.description}),e.jsx("ul",{className:"space-y-1.5 mb-4",children:a.features.map(j=>e.jsxs("li",{className:"flex items-center gap-2 text-xs text-slate-300",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${a.iconBg} flex-shrink-0`}),j]},j))}),e.jsxs("div",{className:"flex items-center gap-1.5 text-sm font-medium text-slate-400",children:["Book Now",e.jsx(K,{className:"w-4 h-4"})]})]},a.key)})})]}),u&&n&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 rounded-lg ${n.iconBg} flex items-center justify-center ${n.accentColor}`,children:n.cardIcon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-base",children:n.title}),e.jsx("p",{className:"text-slate-400 text-xs",children:n.subtitle})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>x(!y),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-slate-800/60 border border-slate-700/40 text-slate-300 text-xs font-medium hover:border-slate-600 transition-colors",children:["Switch",e.jsx(je,{className:`w-3.5 h-3.5 transition-transform ${y?"rotate-180":""}`})]}),e.jsx(le,{children:y&&e.jsx(B.div,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},className:"absolute right-0 top-full mt-1 z-20 w-52 bg-[#0d1f2d] border border-slate-700/60 rounded-xl overflow-hidden shadow-xl",children:L.filter(a=>a.key!==u).map(a=>{const d=p?a.getPrice(p,s)/100:0;return e.jsxs("button",{onClick:()=>{g(a.key),x(!1)},className:"flex items-center gap-3 w-full px-4 py-3 hover:bg-slate-800/60 transition-colors text-left",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg ${a.iconBg} flex items-center justify-center ${a.accentColor} flex-shrink-0`,children:a.cardIcon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm font-medium truncate",children:a.title}),p&&d>0&&e.jsxs("p",{className:"text-slate-500 text-xs",children:["₹",d]})]})]},a.key)})})})]}),e.jsx("button",{onClick:()=>{g(null),x(!1)},className:"p-1.5 rounded-lg bg-slate-800/60 border border-slate-700/40 text-slate-400 hover:text-white hover:border-slate-600 transition-colors",children:e.jsx(Ne,{className:"w-4 h-4"})})]})]}),e.jsx(B.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.25},children:e.jsx("div",{className:"bg-gradient-to-br from-[#0d1f2d] to-[#0a1a24] border border-slate-700/50 rounded-2xl p-4 sm:p-6",children:e.jsx(Me,{listingId:s.id,slotType:u,title:n.title,subtitle:n.subtitle,icon:n.icon,accentColor:n.iconBg,onShowAuth:()=>c(()=>o(`/referrals/${r}`)),listingQueryPrice:s.query_price,listingProfilePrice:s.profile_price,listingSlotPrice:s.slot_price})})},u)]})]})})};export{He as ReferralDetailPage};
