import{j as e}from"./vendor-motion-_XdJ9pBm.js";import{u as se,r as g}from"./vendor-react-B4msnGgW.js";import{p as D}from"./vendor-pdf-B1igRwBP.js";import{l as ge}from"./index-4HxsnF8w.js";import{s as f,u as re,n as V,y as xe,C as ne,a as fe,k as we,F as Z,B as ye}from"./index-BbSeE-q4.js";import{g as F}from"./geminiServiceWrapper-tvm4MzT7.js";import{c as P}from"./codeCompilerService-Fc1MZoaD.js";import{S as ee}from"./send-BNy5p617.js";import{C as ae}from"./code-GxPtUTRK.js";import{P as oe}from"./play-BW95sg1B.js";import{X as be}from"./x-circle-ytsTtMRB.js";import{U as ve}from"./upload-CurydzNZ.js";import{L as te}from"./loader-Bt6ig5Kl.js";import"./vendor-supabase-B_87WqdG.js";import"./vendor-forms-BxTF4-4_.js";import"./edenAITextService-y6w1oEiu.js";import"./aiProxyService-HwcJnoDm.js";D.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${D.version}/pdf.worker.min.js`;class je{async uploadAndParseResume(t,r){try{const s=await this.extractTextFromFile(t),a=await this.parseResumeContent(s),{data:n,error:o}=await f.from("interview_resumes").insert({user_id:r,original_filename:t.name,raw_text:s,parsed_data:a,projects_extracted:a.projects,skills:a.skills,experience_level:a.experienceLevel}).select().single();if(o)throw o;return{resumeId:n.id,parsedData:a,success:!0}}catch(s){return console.error("Resume parsing error:",s),{resumeId:"",parsedData:{rawText:"",projects:[],skills:[],experienceLevel:"unknown"},success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async extractTextFromFile(t){const r=t.type;if(r==="application/pdf")return this.extractTextFromPDF(t);if(r==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"||r==="application/msword")return this.extractTextFromWord(t);if(r==="text/plain")return this.extractTextFromPlain(t);throw new Error("Unsupported file type. Please upload PDF, DOCX, or TXT file.")}async extractTextFromPDF(t){const r=await t.arrayBuffer(),s=await D.getDocument({data:r}).promise;let a="";for(let n=1;n<=s.numPages;n++){const l=(await(await s.getPage(n)).getTextContent()).items.map(d=>d.str).join(" ");a+=l+`
`}return a}async extractTextFromWord(t){const r=await t.arrayBuffer();return(await ge.extractRawText({arrayBuffer:r})).value}async extractTextFromPlain(t){return await t.text()}async parseResumeContent(t){const r=this.extractProjects(t),s=this.extractSkills(t),a=this.determineExperienceLevel(t),n=this.extractEducation(t),o=this.extractWorkExperience(t),c=this.calculateYearsOfExperience(t);return{rawText:t,projects:r,skills:s,experienceLevel:a,education:n,workExperience:o,totalYearsOfExperience:c}}extractProjects(t){const r=[],s=/(?:projects?|personal projects?|academic projects?|portfolio)[:\s]*([\s\S]*?)(?=(?:experience|education|skills|certifications|$))/gi,a=t.match(s);return a&&a.forEach(o=>{o.split(/\n\s*\n/).forEach(l=>{const d=l.split(`
`).filter(v=>v.trim());if(d.length===0)return;const p=d[0].match(/^[•\-\*]?\s*(.+?)(?:\s*[\|\-]\s*(.+))?$/),u=p?p[1].trim():d[0].trim(),j=this.extractTechnologiesFromBlock(l),N=this.extractDescriptionFromBlock(l),b=this.extractAchievementsFromBlock(l);u&&(j.length>0||N)&&r.push({name:u,description:N||"",technologies:j,achievements:b})})}),this.extractProjectsUsingPatterns(t).forEach(o=>{r.some(c=>c.name.toLowerCase()===o.name.toLowerCase())||r.push(o)}),r}extractProjectsUsingPatterns(t){const r=[],s=t.split(`
`),a=["react","node","python","java","angular","vue","django","flask","spring","mongodb","sql","aws","docker","kubernetes"];for(let n=0;n<s.length;n++){const o=s[n].trim(),c=s.slice(n,n+5).join(" ").toLowerCase(),l=a.some(p=>c.includes(p));if(/^[•\-\*]?\s*[A-Z][a-zA-Z\s]{3,50}(?:\s*[\|\-]|$)/.test(o)&&l&&o.length>5&&o.length<100){const p=s.slice(n,n+8).join(" "),u=this.extractTechnologiesFromBlock(p);u.length>0&&r.push({name:o.replace(/^[•\-\*]\s*/,""),description:this.extractDescriptionFromBlock(p)||"",technologies:u})}}return r}extractTechnologiesFromBlock(t){const r=[/(?:technologies?|tech stack|tools?|built with|using)[:\s]*(.*?)(?:\n|$)/gi,/\((.*?)\)/g],s=new Set,a=["react","angular","vue","svelte","node.js","express","django","flask","spring boot","python","java","javascript","typescript","c++","c#","go","rust","kotlin","swift","mongodb","postgresql","mysql","redis","elasticsearch","aws","azure","gcp","docker","kubernetes","jenkins","git","tensorflow","pytorch","scikit-learn","pandas","numpy","graphql","rest api","websocket","microservices"];r.forEach(o=>{var l;const c=t.matchAll(o);for(const d of c){const p=((l=d[1])==null?void 0:l.toLowerCase())||"";a.forEach(u=>{p.includes(u.toLowerCase())&&s.add(u)})}});const n=t.toLowerCase();return a.forEach(o=>{n.includes(o.toLowerCase())&&s.add(o)}),Array.from(s)}extractDescriptionFromBlock(t){return t.split(`
`).filter(a=>a.trim()).filter(a=>{const n=a.trim();return n.length>20&&!n.match(/^(?:technologies?|tech stack|tools?|duration|role)[:\s]/i)&&!n.match(/^\(.*\)$/)}).slice(0,3).join(" ").trim()}extractAchievementsFromBlock(t){const r=[];return t.split(`
`).forEach(a=>{const n=a.trim();n.match(/^[•\-\*]\s*.{20,}/)&&r.push(n.replace(/^[•\-\*]\s*/,""))}),r}extractSkills(t){const r=t.match(/(?:skills?|technical skills?|core competencies)[:\s]*([\s\S]*?)(?=(?:experience|education|projects|certifications|$))/gi),s=new Set;if(r){const n=["javascript","typescript","python","java","c++","c#","go","rust","php","ruby","swift","kotlin","react","angular","vue","svelte","next.js","nuxt.js","node.js","express","django","flask","spring boot","asp.net","mongodb","postgresql","mysql","redis","dynamodb","cassandra","aws","azure","gcp","docker","kubernetes","terraform","git","ci/cd","jenkins","github actions","machine learning","deep learning","nlp","computer vision","tensorflow","pytorch","scikit-learn","html","css","sass","tailwind","rest api","graphql","grpc","websocket","agile","scrum","tdd","microservices"],o=r[0].toLowerCase();n.forEach(c=>{o.includes(c.toLowerCase())&&s.add(c)})}const a=t.toLowerCase();return["react","python","java","node.js","aws","docker"].forEach(n=>{a.includes(n)&&s.add(n)}),Array.from(s)}extractEducation(t){const r=t.match(/(?:education|academic background)[:\s]*([\s\S]*?)(?=(?:experience|projects|skills|certifications|$))/gi);return r?r[0].split(`
`).filter(s=>s.trim().length>10).map(s=>s.trim()).slice(0,5):[]}extractWorkExperience(t){const r=t.match(/(?:work experience|professional experience|employment history)[:\s]*([\s\S]*?)(?=(?:education|projects|skills|certifications|$))/gi);return r?r[0].split(`

`).filter(s=>s.trim().length>20).map(s=>s.trim()).slice(0,5):[]}determineExperienceLevel(t){const r=this.calculateYearsOfExperience(t);if(r===null){const s=t.toLowerCase();return s.includes("senior")||s.includes("lead")||s.includes("architect")?"senior":s.includes("junior")||s.includes("intern")||s.includes("fresher")?"junior":"unknown"}return r<2?"junior":r<5?"mid":r<8?"senior":"lead"}calculateYearsOfExperience(t){const r=[/(\d+)\+?\s*years?\s*of\s*experience/i,/experience[:\s]*(\d+)\+?\s*years?/i];for(const n of r){const o=t.match(n);if(o)return parseInt(o[1],10)}const s=/(\d{4})\s*-\s*(?:(\d{4})|present|current)/gi,a=Array.from(t.matchAll(s));if(a.length>0){let n=0;return a.forEach(o=>{const c=parseInt(o[1],10),l=o[2]?parseInt(o[2],10):new Date().getFullYear();n+=l-c}),Math.max(0,n)}return null}async getResumeById(t,r){const{data:s,error:a}=await f.from("interview_resumes").select("*").eq("id",t).eq("user_id",r).single();if(a)throw a;return s}async getUserResumes(t){const{data:r,error:s}=await f.from("interview_resumes").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(s)throw s;return r||[]}}const Ne=new je;class Se{async generateQuestionsFromResume(t,r){const s=[],{totalQuestions:a,includeProjectQuestions:n,includeCodingQuestions:o}=r,c=Math.floor(a*.4),l=Math.floor(a*.4),d=a-c-l;if(n&&t.projects.length>0){const u=await this.generateProjectSpecificQuestions(t.projects,c,t.experienceLevel);s.push(...u)}if(o){const u=await this.generateCodingQuestions(t.skills,l,t.experienceLevel,r.programmingLanguages);s.push(...u)}const p=await this.generateTechnicalQuestions(t.skills,d,t.experienceLevel);return s.push(...p),s.map((u,j)=>({...u,questionNumber:j+1}))}async generateProjectSpecificQuestions(t,r,s){const a=[],n=t.slice(0,Math.min(r,t.length));for(const o of n){const c=`
You are an expert technical interviewer. Generate a detailed, probing interview question about this project:

Project: ${o.name}
Description: ${o.description}
Technologies: ${o.technologies.join(", ")}
Experience Level: ${s}

Generate ONE insightful question that:
1. Tests deep understanding of the technical decisions made
2. Explores challenges faced and solutions implemented
3. Assesses architecture and design choices
4. Is appropriate for a ${s} level candidate

Format your response as JSON:
{
  "question": "the interview question",
  "expectedTopics": ["topic1", "topic2", "topic3"],
  "evaluationCriteria": ["criteria1", "criteria2", "criteria3"],
  "difficulty": "easy|medium|hard"
}
`;try{const l=await F.generateText(c),d=this.parseJSONResponse(l);a.push({questionNumber:0,questionType:"project_specific",questionText:d.question,relatedProject:o.name,relatedSkills:o.technologies,difficultyLevel:d.difficulty||"medium",expectedDurationMinutes:15,requiresCoding:!1,context:{expectedTopics:d.expectedTopics||[],evaluationCriteria:d.evaluationCriteria||[]}})}catch(l){console.error("Error generating project question:",l),a.push(this.createFallbackProjectQuestion(o,s))}}return a}async generateCodingQuestions(t,r,s,a){const n=[],o=a||this.detectProgrammingLanguages(t),c={junior:["easy","easy","medium"],mid:["easy","medium","medium"],senior:["medium","medium","hard"],lead:["medium","hard","hard"],unknown:["easy","medium","hard"]},l=c[s]||c.unknown;for(let d=0;d<r;d++){const p=o[d%o.length]||"Python",u=l[d%l.length],j=`
You are an expert technical interviewer. Generate a coding problem for a ${s} level candidate.

Requirements:
- Difficulty: ${u}
- Programming Language: ${p}
- Related Skills: ${t.join(", ")}
- Should test problem-solving, algorithm design, and clean code practices
- Should be solvable in 15-20 minutes

Generate ONE coding question that includes:
1. Clear problem statement
2. Input/output examples
3. Constraints
4. Two test cases with expected outputs

Format your response as JSON:
{
  "question": "the coding problem statement",
  "approach": "suggested approach to solve",
  "testCases": [
    {"input": "test input 1", "expectedOutput": "expected output 1"},
    {"input": "test input 2", "expectedOutput": "expected output 2"}
  ],
  "evaluationCriteria": ["criteria1", "criteria2", "criteria3"],
  "difficulty": "${u}"
}
`;try{const N=await F.generateText(j),b=this.parseJSONResponse(N);n.push({questionNumber:0,questionType:"coding",questionText:b.question,relatedSkills:[p,...t.slice(0,3)],difficultyLevel:u,expectedDurationMinutes:20,requiresCoding:!0,programmingLanguage:p,context:{expectedTopics:[b.approach],evaluationCriteria:b.evaluationCriteria||[],testCases:b.testCases||[]}})}catch(N){console.error("Error generating coding question:",N),n.push(this.createFallbackCodingQuestion(p,u))}}return n}async generateTechnicalQuestions(t,r,s){const a=[];for(let n=0;n<r;n++){const o=t.slice(n*2,n*2+3),c=`
You are an expert technical interviewer. Generate a technical question for a ${s} level candidate.

Skills to test: ${o.join(", ")}
Experience Level: ${s}

Generate ONE in-depth technical question that:
1. Tests conceptual understanding
2. Explores practical application
3. Assesses architectural knowledge
4. Is appropriate for ${s} level

Format your response as JSON:
{
  "question": "the technical question",
  "expectedTopics": ["topic1", "topic2", "topic3"],
  "evaluationCriteria": ["criteria1", "criteria2", "criteria3"],
  "difficulty": "easy|medium|hard"
}
`;try{const l=await F.generateText(c),d=this.parseJSONResponse(l);a.push({questionNumber:0,questionType:"technical",questionText:d.question,relatedSkills:o,difficultyLevel:d.difficulty||"medium",expectedDurationMinutes:15,requiresCoding:!1,context:{expectedTopics:d.expectedTopics||[],evaluationCriteria:d.evaluationCriteria||[]}})}catch(l){console.error("Error generating technical question:",l),a.push(this.createFallbackTechnicalQuestion(o,s))}}return a}async generateFollowUpQuestion(t,r,s){const a=`
You are an expert interviewer conducting a follow-up question.

Original Question: ${t}
Candidate's Response: ${r}
Analysis: ${JSON.stringify(s)}

Based on the candidate's response, generate ONE insightful follow-up question that:
1. Probes deeper into areas they mentioned
2. Tests understanding of concepts they used
3. Explores edge cases or alternative approaches
4. Clarifies vague or incomplete parts of their answer

Return ONLY the follow-up question text, no additional formatting.
`;try{return(await F.generateText(a)).trim()}catch(n){return console.error("Error generating follow-up:",n),"Can you elaborate more on the approach you mentioned?"}}async saveQuestionsToSession(t,r){const s=r.map(o=>({session_id:t,question_number:o.questionNumber,question_type:o.questionType,question_text:o.questionText,related_project:o.relatedProject,related_skills:o.relatedSkills,difficulty_level:o.difficultyLevel,expected_duration_minutes:o.expectedDurationMinutes,requires_coding:o.requiresCoding,programming_language:o.programmingLanguage,context:o.context})),{data:a,error:n}=await f.from("interview_questions_dynamic").insert(s).select();if(n)throw n;return a}async getSessionQuestions(t){const{data:r,error:s}=await f.from("interview_questions_dynamic").select("*").eq("session_id",t).order("question_number");if(s)throw s;return r||[]}detectProgrammingLanguages(t){const r={javascript:"JavaScript",typescript:"JavaScript",python:"Python",java:"Java","c++":"C++","c#":"C#",go:"Go",rust:"Rust",php:"PHP",ruby:"Ruby",swift:"Swift",kotlin:"Kotlin"},s=new Set;return t.forEach(a=>{const n=a.toLowerCase();r[n]&&s.add(r[n])}),Array.from(s).slice(0,3)||["Python","JavaScript"]}parseJSONResponse(t){try{const r=t.match(/\{[\s\S]*\}/);return JSON.parse(r?r[0]:t)}catch{return{question:t}}}createFallbackProjectQuestion(t,r){return{questionNumber:0,questionType:"project_specific",questionText:`Can you walk me through the architecture and technical decisions you made in your ${t.name} project? What challenges did you face and how did you overcome them?`,relatedProject:t.name,relatedSkills:t.technologies,difficultyLevel:"medium",expectedDurationMinutes:15,requiresCoding:!1,context:{expectedTopics:["architecture","technical decisions","problem solving"],evaluationCriteria:["clarity","technical depth","problem-solving approach"]}}}createFallbackCodingQuestion(t,r){return{questionNumber:0,questionType:"coding",questionText:{easy:"Write a function to check if a given string is a palindrome. Ignore spaces and case sensitivity.",medium:"Implement a function to find the first non-repeating character in a string. Return its index or -1 if not found.",hard:"Design and implement a LRU (Least Recently Used) cache with get and put operations in O(1) time complexity."}[r],relatedSkills:[t,"algorithms","data structures"],difficultyLevel:r,expectedDurationMinutes:20,requiresCoding:!0,programmingLanguage:t,context:{expectedTopics:["string manipulation","algorithms"],evaluationCriteria:["correctness","efficiency","code quality"],testCases:[{input:'"racecar"',expectedOutput:"true"},{input:'"hello"',expectedOutput:"false"}]}}}createFallbackTechnicalQuestion(t,r){return{questionNumber:0,questionType:"technical",questionText:`Explain the key concepts and best practices you follow when working with ${t[0]||"software development"}. How do you ensure code quality and maintainability?`,relatedSkills:t,difficultyLevel:"medium",expectedDurationMinutes:15,requiresCoding:!1,context:{expectedTopics:["best practices","code quality","architecture"],evaluationCriteria:["depth of knowledge","practical experience","communication"]}}}}const L=new Se;class _e{async createSession(t,r,s){const{data:a,error:n}=await f.from("adaptive_interview_sessions").insert({user_id:t,resume_id:r,interview_type:s.interviewType,configuration:s,total_questions:s.totalQuestions,status:"not_started"}).select().single();if(n)throw n;return a.id}async startSession(t){const{data:r,error:s}=await f.from("adaptive_interview_sessions").update({status:"in_progress",started_at:new Date().toISOString()}).eq("id",t).select().single();if(s)throw s;return r}async getSession(t){const{data:r,error:s}=await f.from("adaptive_interview_sessions").select("*").eq("id",t).single();return s?(console.error("Error fetching session:",s),null):r}async updateSessionProgress(t,r){const{data:s,error:a}=await f.from("adaptive_interview_sessions").update({current_question_index:r,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(a)throw a;return s}async completeSession(t,r){const s=await this.getSession(t);if(!s)throw new Error("Session not found");const a=new Date(s.startedAt||Date.now()),n=new Date,o=Math.floor((n.getTime()-a.getTime())/1e3),{data:c,error:l}=await f.from("adaptive_interview_sessions").update({status:"completed",completed_at:n.toISOString(),total_duration_seconds:o,overall_score:r}).eq("id",t).select().single();if(l)throw l;return c}async analyzeResponse(t,r,s,a){const n=`
You are an expert technical interviewer evaluating a candidate's response.

Question Type: ${s}
Question: ${t}
Related Skills: ${a.join(", ")}
Candidate's Response: ${r}

Analyze the response on these dimensions (rate 0-100):
1. Clarity - How clearly did they communicate?
2. Technical Depth - How deep was their technical understanding?
3. Completeness - Did they cover all aspects of the question?
4. Accuracy - Were their statements technically correct?

Also determine:
- Key strengths in the response
- Areas for improvement
- Whether a follow-up question is needed to probe deeper
- Specific suggestions for improvement

Format your response as JSON:
{
  "clarity": 0-100,
  "technicalDepth": 0-100,
  "completeness": 0-100,
  "accuracy": 0-100,
  "strengths": ["strength1", "strength2"],
  "weaknesses": ["weakness1", "weakness2"],
  "suggestions": ["suggestion1", "suggestion2"],
  "needsFollowUp": true/false,
  "followUpReason": "reason if needs follow-up"
}
`;try{const o=await F.generateText(n),c=this.parseJSONResponse(o),l=((c.clarity||50)+(c.technicalDepth||50)+(c.completeness||50)+(c.accuracy||50))/4;return{clarity:c.clarity||50,technicalDepth:c.technicalDepth||50,completeness:c.completeness||50,accuracy:c.accuracy||50,overallScore:Math.round(l),strengths:c.strengths||[],weaknesses:c.weaknesses||[],suggestions:c.suggestions||[],needsFollowUp:c.needsFollowUp||!1,followUpReason:c.followUpReason}}catch(o){return console.error("Error analyzing response:",o),this.createDefaultAnalysis()}}async saveResponse(t,r,s){const{data:a,error:n}=await f.from("interview_responses_detailed").insert({session_id:t,question_id:r,response_type:s.responseType,verbal_response:s.verbalResponse,code_response:s.codeResponse,programming_language:s.programmingLanguage,time_spent_seconds:s.timeSpentSeconds,submitted_at:new Date().toISOString()}).select().single();if(n)throw n;return a}async updateResponseWithAnalysis(t,r,s){const a={...r,codeQuality:s},{data:n,error:o}=await f.from("interview_responses_detailed").update({ai_analysis:a,score:r.overallScore,strengths:r.strengths,weaknesses:r.weaknesses,follow_up_generated:r.needsFollowUp}).eq("id",t).select().single();if(o)throw o;return n}async generateAndSaveFollowUp(t,r,s,a,n,o){if(!o.needsFollowUp)return null;const c=await L.generateFollowUpQuestion(a,n,o),{data:l}=await f.from("follow_up_questions").select("depth_level").eq("session_id",t).eq("parent_question_id",r),d=l!=null&&l.length?Math.max(...l.map(j=>j.depth_level)):0,{data:p,error:u}=await f.from("follow_up_questions").insert({session_id:t,parent_question_id:r,parent_response_id:s,follow_up_text:c,reason_for_followup:o.followUpReason||"Probing deeper understanding",depth_level:d+1,asked_at:new Date().toISOString()}).select().single();if(u)throw u;return p}async saveFollowUpResponse(t,r){const{data:s,error:a}=await f.from("follow_up_questions").update({response:r}).eq("id",t).select().single();if(a)throw a;return s}async getSessionResponses(t){const{data:r,error:s}=await f.from("interview_responses_detailed").select(`
        *,
        interview_questions_dynamic (
          question_text,
          question_type,
          related_project,
          difficulty_level
        )
      `).eq("session_id",t).order("submitted_at");if(s)throw s;return r||[]}async getFollowUpQuestions(t){const{data:r,error:s}=await f.from("follow_up_questions").select("*").eq("session_id",t).order("asked_at");if(s)throw s;return r||[]}async getUserSessions(t){const{data:r,error:s}=await f.from("adaptive_interview_sessions").select(`
        *,
        interview_resumes (
          original_filename,
          experience_level
        )
      `).eq("user_id",t).order("created_at",{ascending:!1});if(s)throw s;return r||[]}parseJSONResponse(t){try{const r=t.match(/\{[\s\S]*\}/);return JSON.parse(r?r[0]:t)}catch{return{}}}createDefaultAnalysis(){return{clarity:50,technicalDepth:50,completeness:50,accuracy:50,overallScore:50,strengths:["Attempted to answer the question"],weaknesses:["Could provide more technical depth"],suggestions:["Elaborate on technical concepts","Provide specific examples"],needsFollowUp:!1}}}const _=new _e,ke=({sessionId:w,onComplete:t})=>{const{user:r}=re();se();const[s,a]=g.useState([]),[n,o]=g.useState(0),[c,l]=g.useState(""),[d,p]=g.useState(""),[u,j]=g.useState("Python"),[N,b]=g.useState(0),[v,y]=g.useState(!1),[k,A]=g.useState([]),[q,E]=g.useState([]),[O,h]=g.useState(!1),[S,Q]=g.useState(""),[U,$]=g.useState(""),[ie,M]=g.useState(!1),[z,B]=g.useState(!1),T=g.useRef(null),Y=g.useRef(Date.now());g.useEffect(()=>(le(),J(),()=>{T.current&&clearInterval(T.current)}),[w]),g.useEffect(()=>{m!=null&&m.requires_coding&&(m!=null&&m.programming_language)&&(j(m.programming_language),de())},[n]);const J=()=>{Y.current=Date.now(),T.current=setInterval(()=>{b(Math.floor((Date.now()-Y.current)/1e3))},1e3)},ce=()=>{T.current&&clearInterval(T.current),b(0),J()},le=async()=>{try{const i=await L.getSessionQuestions(w);a(i);const x=await _.getSession(w);x&&o(x.currentQuestionIndex||0)}catch(i){console.error("Error loading questions:",i)}},de=async()=>{if(m)try{const i=await P.generateTestCases(m.question_text,u);A(i)}catch(i){console.error("Error generating test cases:",i)}},ue=async()=>{if(!d.trim()){alert("Please write some code first");return}B(!0),M(!0);try{const i=await P.executeCode(d,u,k);i.success&&i.executionResults?E(i.executionResults):alert(i.error||"Execution failed")}catch(i){console.error("Execution error:",i),alert("Failed to execute code")}finally{B(!1)}},pe=async()=>{if(!m)return;const i=c.trim().length>0,x=d.trim().length>0;if(!i&&!x){alert("Please provide a response before submitting");return}y(!0);try{const C=x&&i?"mixed":x?"code":"verbal",R=await _.saveResponse(w,m.id,{responseType:C,verbalResponse:i?c:void 0,codeResponse:x?d:void 0,programmingLanguage:x?u:void 0,timeSpentSeconds:N}),I=await _.analyzeResponse(m.question_text,c||"Code-only submission",m.question_type,m.related_skills);let H=null;if(x&&(H=await P.analyzeCodeQuality(d,u,m.question_text),q.length>0&&await P.saveExecutionResult(R.id,w,d,u,k,q)),await _.updateResponseWithAnalysis(R.id,I,H),I.needsFollowUp){const K=await _.generateAndSaveFollowUp(w,m.id,R.id,m.question_text,c||d,I);if(K){Q(K.follow_up_text),h(!0),y(!1);return}}W()}catch(C){console.error("Error submitting response:",C),alert("Failed to submit response")}finally{y(!1)}},me=async()=>{if(!U.trim()){alert("Please provide an answer to the follow-up question");return}y(!0);try{h(!1),W()}catch(i){console.error("Error submitting follow-up:",i)}finally{y(!1)}},W=()=>{const i=n+1;if(i>=s.length){he();return}o(i),_.updateSessionProgress(w,i),l(""),p(""),E([]),M(!1),$(""),ce()},he=async()=>{try{const i=await _.getSessionResponses(w),x=i.reduce((C,R)=>C+(R.score||0),0)/i.length;await _.completeSession(w,x),t()}catch(i){console.error("Error completing interview:",i)}},m=s[n],G=i=>{const x=Math.floor(i/60),C=i%60;return`${x}:${C.toString().padStart(2,"0")}`},X=()=>{if(!m)return"text-gray-600";const i=m.expected_duration_minutes*60,x=N/i;return x>1?"text-red-600":x>.8?"text-orange-600":"text-green-600"};return m?O?e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Follow-up Question"}),e.jsxs("div",{className:`flex items-center gap-2 text-lg font-semibold ${X()}`,children:[e.jsx(V,{className:"w-5 h-5"}),G(N)]})]}),e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:S})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Answer"}),e.jsx("textarea",{value:U,onChange:i=>$(i.target.value),className:"w-full h-40 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Provide your answer..."})]}),e.jsxs("button",{onClick:me,disabled:v,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-400 flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),v?"Submitting...":"Submit Answer"]})]})}):e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:["Question ",m.question_number," of ",s.length]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:m.question_type.replace("_"," ")}),e.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-800 text-sm rounded-full",children:m.difficulty_level}),m.related_project&&e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full",children:["Project: ",m.related_project]})]})]}),e.jsxs("div",{className:`flex items-center gap-2 text-2xl font-bold ${X()}`,children:[e.jsx(V,{className:"w-6 h-6"}),G(N)]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("p",{className:"text-lg text-gray-800 whitespace-pre-wrap",children:m.question_text}),m.related_skills.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:m.related_skills.map((i,x)=>e.jsx("span",{className:"px-2 py-1 bg-gray-200 text-gray-700 text-xs rounded",children:i},x))})]})]}),e.jsxs("div",{className:"p-6",children:[m.requires_coding?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Explain Your Approach"}),e.jsx(xe,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("textarea",{value:c,onChange:i=>l(i.target.value),className:"w-full h-32 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Explain your approach and thought process before coding..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Write Your Code"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-gray-400"}),e.jsx("select",{value:u,onChange:i=>j(i.target.value),className:"px-3 py-1 border border-gray-300 rounded text-sm",children:P.getSupportedLanguages().map(i=>e.jsx("option",{value:i,children:i},i))})]})]}),e.jsx("textarea",{value:d,onChange:i=>p(i.target.value),className:"w-full h-64 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none font-mono text-sm",placeholder:`Write your ${u} code here...`})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:ue,disabled:z||!d.trim(),className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors disabled:bg-gray-400 flex items-center justify-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5"}),z?"Running...":"Run Code & Test"]})}),ie&&q.length>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Test Results"}),e.jsx("div",{className:"space-y-3",children:q.map((i,x)=>e.jsxs("div",{className:`p-3 rounded border ${i.passed?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-medium text-sm",children:["Test Case ",x+1]}),i.passed?e.jsx(ne,{className:"w-5 h-5 text-green-600"}):e.jsx(be,{className:"w-5 h-5 text-red-600"})]}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Input:"})," ",i.testCase.input]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Expected:"})," ",i.testCase.expectedOutput]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Got:"})," ",i.actualOutput]}),i.error&&e.jsxs("div",{className:"text-red-600",children:[e.jsx("span",{className:"font-medium",children:"Error:"})," ",i.error]})]})]},x))})]}),k.length>0&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"Test Cases to Pass"})]}),e.jsx("div",{className:"space-y-2",children:k.map((i,x)=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Input:"})," ",i.input]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Expected Output:"})," ",i.expectedOutput]})]},x))})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Answer"}),e.jsx("textarea",{value:c,onChange:i=>l(i.target.value),className:"w-full h-64 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Type your detailed answer here..."})]}),e.jsxs("button",{onClick:pe,disabled:v,className:"w-full mt-6 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-400 flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),v?"Submitting...":n<s.length-1?"Submit & Continue":"Submit & Complete Interview"]})]})]})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading interview questions..."})]})})},Be=()=>{const{user:w}=re(),t=se(),{isChristmasMode:r,colors:s}=we(),[a,n]=g.useState("upload"),[o,c]=g.useState(null),[l,d]=g.useState(""),[p,u]=g.useState(null),[j,N]=g.useState(""),[b,v]=g.useState(""),[y,k]=g.useState({totalQuestions:5,includeProjectQuestions:!0,includeCodingQuestions:!0,programmingLanguages:["Python","JavaScript"]}),A=h=>{var Q;const S=(Q=h.target.files)==null?void 0:Q[0];if(S){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","text/plain"].includes(S.type)){v("Please upload a PDF, DOCX, or TXT file");return}if(S.size>5*1024*1024){v("File size must be less than 5MB");return}c(S),v("")}},q=async()=>{if(!(!o||!w)){n("parsing"),v("");try{const h=await Ne.uploadAndParseResume(o,w.id);if(!h.success)throw new Error(h.error||"Failed to parse resume");d(h.resumeId),u(h.parsedData),n("configure")}catch(h){console.error("Upload error:",h),v(h instanceof Error?h.message:"Failed to process resume"),n("upload")}}},E=async()=>{if(!(!w||!l)){n("generating"),v("");try{const h=await _.createSession(w.id,l,{totalQuestions:y.totalQuestions,interviewType:"resume_based",includeProjectQuestions:y.includeProjectQuestions,includeCodingQuestions:y.includeCodingQuestions,programmingLanguages:y.programmingLanguages}),S=await L.generateQuestionsFromResume(p,y);await L.saveQuestionsToSession(h,S),await _.startSession(h),N(h),n("interview")}catch(h){console.error("Interview start error:",h),v("Failed to start interview. Please try again."),n("configure")}}},O=()=>{n("completed")};return a==="interview"?e.jsx(ke,{sessionId:j,onComplete:O}):a==="completed"?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow-xl p-8 text-center",children:[e.jsx(ne,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Interview Completed!"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Great job completing the interview. Your performance has been analyzed and a detailed report is being generated."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>t("/mock-interview"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:"View Report"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-gray-200 text-gray-800 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Start New Interview"})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-4",children:"Resume-Based Mock Interview"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Upload your resume and get personalized interview questions based on your projects and experience"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8",children:[a==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(ve,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Upload Your Resume"}),e.jsx("p",{className:"text-gray-600",children:"We'll analyze your resume to create personalized interview questions"})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors",children:[e.jsx("input",{type:"file",id:"resume-upload",accept:".pdf,.docx,.doc,.txt",onChange:A,className:"hidden"}),e.jsxs("label",{htmlFor:"resume-upload",className:"cursor-pointer",children:[e.jsx(Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-medium mb-2",children:o?o.name:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PDF, DOCX, or TXT (max 5MB)"})]})]}),b&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:b})}),e.jsx("button",{onClick:q,disabled:!o,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Parse Resume & Continue"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"What We'll Extract:"}),e.jsxs("ul",{className:"space-y-1 text-sm text-gray-700",children:[e.jsx("li",{children:"• Projects you've worked on"}),e.jsx("li",{children:"• Technical skills and technologies"}),e.jsx("li",{children:"• Experience level and duration"}),e.jsx("li",{children:"• Work history and achievements"})]})]})]}),a==="parsing"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"w-16 h-16 text-blue-600 mx-auto mb-4 animate-spin"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Analyzing Your Resume"}),e.jsx("p",{className:"text-gray-600",children:"Extracting projects, skills, and experience..."})]}),a==="configure"&&p&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Resume Analysis Complete"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx(ye,{className:"w-8 h-8 text-blue-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:p.projects.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Projects Found"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx(ae,{className:"w-8 h-8 text-green-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:p.skills.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Skills Identified"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx(Z,{className:"w-8 h-8 text-purple-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-gray-800 capitalize",children:p.experienceLevel}),e.jsx("div",{className:"text-sm text-gray-600",children:"Experience Level"})]})]}),p.projects.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Projects We Found:"}),e.jsx("div",{className:"space-y-2",children:p.projects.slice(0,5).map((h,S)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-medium text-gray-800",children:h.name}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:h.technologies.slice(0,5).join(", ")})]},S))})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Configure Your Interview"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Questions"}),e.jsxs("select",{value:y.totalQuestions,onChange:h=>k({...y,totalQuestions:parseInt(h.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:3,children:"3 Questions (15-20 min)"}),e.jsx("option",{value:5,children:"5 Questions (25-30 min)"}),e.jsx("option",{value:7,children:"7 Questions (35-40 min)"}),e.jsx("option",{value:10,children:"10 Questions (50-60 min)"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"project-questions",checked:y.includeProjectQuestions,onChange:h=>k({...y,includeProjectQuestions:h.target.checked}),className:"w-5 h-5 text-blue-600"}),e.jsx("label",{htmlFor:"project-questions",className:"text-gray-700",children:"Include questions about my projects"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"coding-questions",checked:y.includeCodingQuestions,onChange:h=>k({...y,includeCodingQuestions:h.target.checked}),className:"w-5 h-5 text-blue-600"}),e.jsx("label",{htmlFor:"coding-questions",className:"text-gray-700",children:"Include coding challenges with compiler"})]})]})]}),b&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:b})}),e.jsxs("button",{onClick:E,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5"}),"Start Interview"]})]}),a==="generating"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"w-16 h-16 text-blue-600 mx-auto mb-4 animate-spin"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Generating Questions"}),e.jsx("p",{className:"text-gray-600",children:"Creating personalized interview questions based on your resume..."})]})]})]})})};export{Be as ResumeBasedInterviewPage};
