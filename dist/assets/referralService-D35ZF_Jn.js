import{s}from"./index-BbSeE-q4.js";class y{async getActiveListings(){const{data:e,error:r}=await s.from("referral_listings").select("*").eq("is_active",!0).order("created_at",{ascending:!1});return r?(console.error("ReferralService: Error fetching listings:",r.message),[]):e||[]}async getAllListings(){const{data:e,error:r}=await s.from("referral_listings").select("*").order("created_at",{ascending:!1});return r?(console.error("ReferralService: Error fetching all listings:",r.message),[]):e||[]}async getListingById(e){const{data:r,error:t}=await s.from("referral_listings").select("*").eq("id",e).maybeSingle();return t?(console.error("ReferralService: Error fetching listing:",t.message),null):r}async createListing(e){const{data:r,error:t}=await s.from("referral_listings").insert(e).select().single();return t?(console.error("ReferralService: Error creating listing:",t.message),null):r}async updateListing(e,r){const{error:t}=await s.from("referral_listings").update({...r,updated_at:new Date().toISOString()}).eq("id",e);return t?(console.error("ReferralService: Error updating listing:",t.message),!1):!0}async deleteListing(e){const{error:r}=await s.from("referral_listings").delete().eq("id",e);return r?(console.error("ReferralService: Error deleting listing:",r.message),!1):!0}async getPricing(){const{data:e,error:r}=await s.from("referral_pricing").select("*").eq("id","1").maybeSingle();return r?(console.error("ReferralService: Error fetching pricing:",r.message),null):e}async updatePricing(e){const{error:r}=await s.from("referral_pricing").update({...e,updated_at:new Date().toISOString()}).eq("id","1");return r?(console.error("ReferralService: Error updating pricing:",r.message),!1):!0}async createPurchase(e,r,t,a){const{data:o,error:l}=await s.from("referral_purchases").insert({user_id:e,referral_listing_id:r,purchase_type:t,amount_paid:a,status:"pending"}).select("id").single();return l?(console.error("ReferralService: Error creating purchase:",l.message),null):o.id}async updatePurchaseStatus(e,r,t,a){const{error:o}=await s.from("referral_purchases").update({payment_id:r,order_id:t,status:a}).eq("id",e);return o?(console.error("ReferralService: Error updating purchase:",o.message),!1):!0}async getUserPurchases(e){const{data:r,error:t}=await s.from("referral_purchases").select("*, referral_listings(*)").eq("user_id",e).eq("status","success").order("created_at",{ascending:!1});return t?(console.error("ReferralService: Error fetching purchases:",t.message),[]):r||[]}async hasUserPurchased(e,r,t){const{data:a,error:o}=await s.from("referral_purchases").select("id").eq("user_id",e).eq("referral_listing_id",r).eq("purchase_type",t).eq("status","success").maybeSingle();return o?!1:!!a}getSlotDuration(e){switch(e){case"profile":return 60;case"query":return 15;case"consultation":return 15;default:return 15}}formatTime(e){const[r,t]=e.split(":").map(Number),a=r>=12?"PM":"AM";return`${r>12?r-12:r===0?12:r}:${String(t).padStart(2,"0")} ${a}`}async getSlotsForDate(e,r,t="consultation"){const l=this.getSlotDuration(t),d=16*60,u=[];let f=0;for(;;){const i=600+f*l,n=i+l;if(n>d)break;const _=String(Math.floor(i/60)).padStart(2,"0"),m=String(i%60).padStart(2,"0"),S=String(Math.floor(n/60)).padStart(2,"0"),h=String(n%60).padStart(2,"0");u.push(`${_}:${m}-${S}:${h}`),f++}const{data:g,error:c}=await s.from("referral_consultation_slots").select("*").eq("referral_listing_id",e).eq("slot_date",r).eq("slot_type",t);if(c)return console.error("ReferralService: Error fetching slots:",c.message),[];const p={};return(g||[]).forEach(i=>{p[i.time_slot]=i}),u.map(i=>{const n=p[i],[_,m]=i.split("-");return{time_slot:i,label:`${this.formatTime(_)} - ${this.formatTime(m)}`,status:(n==null?void 0:n.status)||"available",slot_id:n==null?void 0:n.id}})}async bookSlot(e,r,t,a,o,l,d,u){const{data:f}=await s.from("referral_consultation_slots").select("id").eq("referral_listing_id",r).eq("slot_date",t).eq("time_slot",a).eq("slot_type",o).eq("status","booked").maybeSingle();if(f)return{success:!1,error:"This slot is already booked."};const{data:g,error:c}=await s.from("referral_consultation_slots").insert({referral_listing_id:r,slot_date:t,time_slot:a,slot_type:o,status:"booked",booked_by:e,booking_payment_id:null,user_name:l,user_email:d,user_phone:u||null}).select("id").single();return c?(console.error("ReferralService: Error booking slot:",c.message),{success:!1,error:"Failed to book slot. Please try again."}):{success:!0,slotId:g.id}}async getUserSlotBookings(e){const{data:r,error:t}=await s.from("referral_consultation_slots").select("*").eq("booked_by",e).eq("status","booked").order("slot_date",{ascending:!1});return t?(console.error("ReferralService: Error fetching bookings:",t.message),[]):r||[]}async getAllPurchases(){const{data:e,error:r}=await s.from("referral_purchases").select("*, referral_listings(*)").order("created_at",{ascending:!1});return r?(console.error("ReferralService: Error fetching all purchases:",r.message),[]):e||[]}}const w=new y;export{w as r};
