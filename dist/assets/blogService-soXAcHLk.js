import{s as n}from"./index-BbSeE-q4.js";const b={async fetchPublishedPosts(s=1,o=12,t){try{let e=n.from("blog_posts").select("*",{count:"exact"}).eq("status","published").order("published_at",{ascending:!1});if(t!=null&&t.search&&(e=e.or(`title.ilike.%${t.search}%,body_content.ilike.%${t.search}%`)),t!=null&&t.category_id){const{data:r}=await n.from("blog_post_categories").select("blog_post_id").eq("blog_category_id",t.category_id);if(r&&r.length>0)e=e.in("id",r.map(d=>d.blog_post_id));else return{posts:[],total:0,page:s,pageSize:o,totalPages:0}}if(t!=null&&t.tag_id){const{data:r}=await n.from("blog_post_tags").select("blog_post_id").eq("blog_tag_id",t.tag_id);if(r&&r.length>0)e=e.in("id",r.map(d=>d.blog_post_id));else return{posts:[],total:0,page:s,pageSize:o,totalPages:0}}const i=(s-1)*o,a=i+o-1;e=e.range(i,a);const{data:g,error:c,count:l}=await e;if(c)throw c;return{posts:await Promise.all((g||[]).map(async r=>{const d=await this.getPostCategories(r.id),_=await this.getPostTags(r.id);return{...r,categories:d,tags:_}})),total:l||0,page:s,pageSize:o,totalPages:Math.ceil((l||0)/o)}}catch(e){throw console.error("Error fetching published posts:",e),e}},async fetchPostBySlug(s){try{const{data:o,error:t}=await n.from("blog_posts").select("*").eq("slug",s).eq("status","published").maybeSingle();if(t)throw t;if(!o)return null;const e=await this.getPostCategories(o.id),i=await this.getPostTags(o.id);return await this.incrementViewCount(o.id),{...o,categories:e,tags:i}}catch(o){throw console.error("Error fetching post by slug:",o),o}},async getPostCategories(s){try{const{data:o,error:t}=await n.from("blog_post_categories").select(`
          blog_category_id,
          blog_categories (*)
        `).eq("blog_post_id",s);if(t)throw t;return(o||[]).map(e=>e.blog_categories).filter(Boolean)}catch(o){return console.error("Error fetching post categories:",o),[]}},async getPostTags(s){try{const{data:o,error:t}=await n.from("blog_post_tags").select(`
          blog_tag_id,
          blog_tags (*)
        `).eq("blog_post_id",s);if(t)throw t;return(o||[]).map(e=>e.blog_tags).filter(Boolean)}catch(o){return console.error("Error fetching post tags:",o),[]}},async fetchAllCategories(){try{const{data:s,error:o}=await n.from("blog_categories").select("*").order("name");if(o)throw o;return s||[]}catch(s){return console.error("Error fetching categories:",s),[]}},async fetchAllTags(){try{const{data:s,error:o}=await n.from("blog_tags").select("*").order("name");if(o)throw o;return s||[]}catch(s){return console.error("Error fetching tags:",s),[]}},async fetchCategoryBySlug(s){try{const{data:o,error:t}=await n.from("blog_categories").select("*").eq("slug",s).maybeSingle();if(t)throw t;return o}catch(o){return console.error("Error fetching category by slug:",o),null}},async fetchTagBySlug(s){try{const{data:o,error:t}=await n.from("blog_tags").select("*").eq("slug",s).maybeSingle();if(t)throw t;return o}catch(o){return console.error("Error fetching tag by slug:",o),null}},async fetchRelatedPosts(s,o=4){try{const t=await this.getPostCategories(s),e=await this.getPostTags(s),i=t.map(r=>r.id),a=e.map(r=>r.id);let g=[];if(i.length>0){const{data:r}=await n.from("blog_post_categories").select("blog_post_id").in("blog_category_id",i).neq("blog_post_id",s);r&&(g=r.map(d=>d.blog_post_id))}if(a.length>0){const{data:r}=await n.from("blog_post_tags").select("blog_post_id").in("blog_tag_id",a).neq("blog_post_id",s);r&&(g=[...new Set([...g,...r.map(d=>d.blog_post_id)])])}if(g.length===0)return[];const{data:c,error:l}=await n.from("blog_posts").select("*").in("id",g).eq("status","published").order("published_at",{ascending:!1}).limit(o);if(l)throw l;return await Promise.all((c||[]).map(async r=>{const d=await this.getPostCategories(r.id),_=await this.getPostTags(r.id);return{...r,categories:d,tags:_}}))}catch(t){return console.error("Error fetching related posts:",t),[]}},async incrementViewCount(s){try{const{error:o}=await n.rpc("increment_blog_view_count",{post_id:s}).maybeSingle();o&&await n.from("blog_posts").update({view_count:n.sql`view_count + 1`}).eq("id",s)}catch(o){console.error("Error incrementing view count:",o)}},generateSlug(s){return s.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")},calculateReadingTime(s){const t=s.trim().split(/\s+/).length;return Math.ceil(t/200)},async getBlogStatistics(){try{const{count:s}=await n.from("blog_posts").select("*",{count:"exact",head:!0}).eq("status","published"),{count:o}=await n.from("blog_categories").select("*",{count:"exact",head:!0}),{count:t}=await n.from("blog_posts").select("*",{count:"exact",head:!0}).eq("status","published").eq("is_featured",!0),{data:e}=await n.from("blog_posts").select("estimated_reading_time").eq("status","published"),i=e&&e.length>0?Math.round(e.reduce((a,g)=>a+(g.estimated_reading_time||5),0)/e.length):5;return{totalPosts:s||0,totalCategories:o||0,featuredPosts:t||0,averageReadingTime:i}}catch(s){return console.error("Error fetching blog statistics:",s),{totalPosts:0,totalCategories:0,featuredPosts:0,averageReadingTime:5}}},async fetchPublishedPostsWithAdvancedFilters(s=1,o=12,t){try{let e=n.from("blog_posts").select("*",{count:"exact"}).eq("status","published");if(t!=null&&t.search&&(e=e.or(`title.ilike.%${t.search}%,body_content.ilike.%${t.search}%`)),t!=null&&t.reading_difficulty&&(e=e.eq("reading_difficulty",t.reading_difficulty)),t!=null&&t.reading_time_min&&(e=e.gte("estimated_reading_time",t.reading_time_min)),t!=null&&t.reading_time_max&&(e=e.lte("estimated_reading_time",t.reading_time_max)),(t==null?void 0:t.is_featured)!==void 0&&(e=e.eq("is_featured",t.is_featured)),t!=null&&t.category_id){const{data:r}=await n.from("blog_post_categories").select("blog_post_id").eq("blog_category_id",t.category_id);if(r&&r.length>0)e=e.in("id",r.map(d=>d.blog_post_id));else return{posts:[],total:0,page:s,pageSize:o,totalPages:0}}if(t!=null&&t.tag_id){const{data:r}=await n.from("blog_post_tags").select("blog_post_id").eq("blog_tag_id",t.tag_id);if(r&&r.length>0)e=e.in("id",r.map(d=>d.blog_post_id));else return{posts:[],total:0,page:s,pageSize:o,totalPages:0}}switch(t==null?void 0:t.sort_by){case"oldest":e=e.order("published_at",{ascending:!0});break;case"most_viewed":e=e.order("view_count",{ascending:!1});break;case"trending":e=e.order("trending_score",{ascending:!1});break;case"newest":default:e=e.order("published_at",{ascending:!1});break}const i=(s-1)*o,a=i+o-1;e=e.range(i,a);const{data:g,error:c,count:l}=await e;if(c)throw c;return{posts:await Promise.all((g||[]).map(async r=>{const d=await this.getPostCategories(r.id),_=await this.getPostTags(r.id);return{...r,categories:d,tags:_}})),total:l||0,page:s,pageSize:o,totalPages:Math.ceil((l||0)/o)}}catch(e){throw console.error("Error fetching published posts with filters:",e),e}},async trackUserInteraction(s,o,t,e){var i,a,g;try{const{error:c}=await n.from("blog_user_interactions").upsert({user_id:s,blog_post_id:o,interaction_type:t,reading_progress:e||0,updated_at:new Date().toISOString()},{onConflict:"user_id,blog_post_id,interaction_type"});if(c){if(c.code==="PGRST116"||(i=c.message)!=null&&i.includes("does not exist")||(a=c.message)!=null&&a.includes("404")){console.warn("blog_user_interactions table does not exist. Interaction tracking disabled.");return}throw c}}catch(c){if((c==null?void 0:c.code)==="PGRST116"||(g=c==null?void 0:c.message)!=null&&g.includes("404")||(c==null?void 0:c.status)===404)return;console.error("Error tracking user interaction:",c)}},async getUserBookmarkedPosts(s){var o,t,e;try{const{data:i,error:a}=await n.from("blog_user_interactions").select("blog_post_id").eq("user_id",s).eq("interaction_type","bookmarked");if(a){if(a.code==="PGRST116"||(o=a.message)!=null&&o.includes("does not exist")||(t=a.message)!=null&&t.includes("404"))return console.warn("blog_user_interactions table does not exist. Returning empty bookmarks."),[];throw a}if(!i||i.length===0)return[];const g=i.map(r=>r.blog_post_id),{data:c,error:l}=await n.from("blog_posts").select("*").in("id",g).eq("status","published").order("published_at",{ascending:!1});if(l)throw l;return await Promise.all((c||[]).map(async r=>{const d=await this.getPostCategories(r.id),_=await this.getPostTags(r.id);return{...r,categories:d,tags:_}}))}catch(i){return(i==null?void 0:i.code)==="PGRST116"||(e=i==null?void 0:i.message)!=null&&e.includes("404")||(i==null?void 0:i.status)===404?[]:(console.error("Error fetching bookmarked posts:",i),[])}},async isPostBookmarked(s,o){var t,e,i;try{const{data:a,error:g}=await n.from("blog_user_interactions").select("id").eq("user_id",s).eq("blog_post_id",o).eq("interaction_type","bookmarked").maybeSingle();if(g){if(g.code==="PGRST116"||(t=g.message)!=null&&t.includes("does not exist")||(e=g.message)!=null&&e.includes("404"))return console.warn("blog_user_interactions table does not exist. Bookmark feature disabled."),!1;throw g}return!!a}catch(a){return(a==null?void 0:a.code)==="PGRST116"||(i=a==null?void 0:a.message)!=null&&i.includes("404")||(a==null?void 0:a.status)===404||console.error("Error checking bookmark status:",a),!1}},async removeBookmark(s,o){var t,e,i;try{const{error:a}=await n.from("blog_user_interactions").delete().eq("user_id",s).eq("blog_post_id",o).eq("interaction_type","bookmarked");if(a){if(a.code==="PGRST116"||(t=a.message)!=null&&t.includes("does not exist")||(e=a.message)!=null&&e.includes("404")){console.warn("blog_user_interactions table does not exist. Cannot remove bookmark.");return}throw a}}catch(a){if((a==null?void 0:a.code)==="PGRST116"||(i=a==null?void 0:a.message)!=null&&i.includes("404")||(a==null?void 0:a.status)===404)return;console.error("Error removing bookmark:",a)}}};export{b};
