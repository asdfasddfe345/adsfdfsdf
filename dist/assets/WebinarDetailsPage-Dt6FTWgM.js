import{j as e,m as o}from"./vendor-motion-_XdJ9pBm.js";import{f as B,u as F,r as i}from"./vendor-react-B4msnGgW.js";import{w as m}from"./webinarService-DXJAyzaf.js";import{c as I,u as P,s as _,L as $,i as V,V as f,r as Y,n as q,C as O,h as z,q as G,N as H,a as J,F as K}from"./index-BbSeE-q4.js";import{E as D}from"./external-link-CSmvpDBS.js";import{a as Z,B as C}from"./bell-Be08K7G7.js";import{G as Q}from"./graduation-cap-C94epHPK.js";import{D as X}from"./download-DWlYtjQA.js";import"./vendor-pdf-B1igRwBP.js";import"./vendor-supabase-B_87WqdG.js";import"./vendor-forms-BxTF4-4_.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=I("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]),xe=()=>{const{registrationId:h}=B(),x=F(),{user:l}=P(),[t,M]=i.useState(null),[w,b]=i.useState([]),[L,j]=i.useState(!0),[p,y]=i.useState(0),[c,N]=i.useState(null);i.useEffect(()=>{S()},[h]),i.useEffect(()=>{if(!(t!=null&&t.webinar))return;const a=setInterval(()=>{T()},1e3),s=_.channel(`webinar_updates:${t.webinar.id}`).on("postgres_changes",{event:"*",schema:"public",table:"webinar_updates",filter:`webinar_id=eq.${t.webinar.id}`},()=>{v()}).subscribe();return()=>{clearInterval(a),_.removeChannel(s)}},[t]);const S=async()=>{try{if(j(!0),!h||!l)return;const a=await m.getRegistrationById(h);if(!a){alert("Registration not found"),x("/webinars");return}if(a.user_id!==l.id){alert("Unauthorized access"),x("/webinars");return}M(a),a.webinar&&(await v(),await U(a.webinar.id))}catch(a){console.error("Error loading registration:",a),alert("Failed to load webinar details")}finally{j(!1)}},v=async()=>{if(!(!(t!=null&&t.webinar)||!l))try{const a=await m.getWebinarUpdates(t.webinar.id,l.id);b(a)}catch(a){console.error("Error loading updates:",a)}},U=async a=>{if(l)try{const s=await m.getUnreadUpdatesCount(l.id,a);y(s)}catch(s){console.error("Error loading unread count:",s)}},T=()=>{if(!(t!=null&&t.webinar))return;const a=new Date(t.webinar.scheduled_at),s=new Date,r=a.getTime()-s.getTime();r>0?N({days:Math.floor(r/(1e3*60*60*24)),hours:Math.floor(r/(1e3*60*60)%24),minutes:Math.floor(r/1e3/60%60),seconds:Math.floor(r/1e3%60)}):N(null)},R=async a=>{l&&(await m.markUpdateAsViewed(a,l.id),b(s=>s.map(r=>r.id===a?{...r,is_viewed:!0}:r)),y(s=>Math.max(0,s-1)))},A=async()=>{!(t!=null&&t.webinar)||!l||(await m.markAllUpdatesAsViewed(t.webinar.id,l.id),b(a=>a.map(s=>({...s,is_viewed:!0}))),y(0))},E=a=>{switch(a){case"meet_link":return e.jsx(f,{className:"w-5 h-5"});case"material":return e.jsx(K,{className:"w-5 h-5"});case"announcement":return e.jsx(ee,{className:"w-5 h-5"});case"schedule_change":return e.jsx(J,{className:"w-5 h-5"});default:return e.jsx(C,{className:"w-5 h-5"})}},W=a=>{switch(a){case"meet_link":return"bg-green-50 border-green-200 text-green-800";case"material":return"bg-blue-50 border-blue-200 text-blue-800";case"announcement":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"schedule_change":return"bg-red-50 border-red-200 text-red-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}},g=()=>{if(!(t!=null&&t.webinar))return!1;const a=new Date,s=new Date(t.webinar.scheduled_at),r=new Date(s.getTime()+t.webinar.duration_minutes*6e4);return a>=s&&a<=r},u=()=>{if(!(t!=null&&t.webinar))return!1;const a=new Date,s=new Date(t.webinar.scheduled_at),r=new Date(s.getTime()+t.webinar.duration_minutes*6e4);return a>r};if(L)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-950 dark:to-gray-900 flex items-center justify-center",children:e.jsx($,{className:"w-8 h-8 animate-spin text-blue-600"})});if(!t||!t.webinar)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-950 dark:to-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Webinar not found"}),e.jsx("button",{onClick:()=>x("/webinars"),className:"text-blue-600 hover:text-blue-700",children:"Back to Webinars"})]})});const{webinar:n}=t,k=!!(n!=null&&n.meet_link&&t.payment_status==="completed"&&t.registration_status==="confirmed");return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-950 dark:to-gray-900 lg:pl-16 py-8 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("button",{onClick:()=>x("/webinars"),className:"lg:hidden flex items-center gap-2 text-gray-600 hover:text-gray-800 mb-6",children:[e.jsx(V,{className:"w-5 h-5"}),"Back to Webinars"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg overflow-hidden",children:[n.thumbnail_url&&e.jsx("img",{src:n.thumbnail_url,alt:n.title,className:"w-full h-48 object-cover"}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:n.title}),e.jsxs("div",{className:"mb-4",children:[g()&&e.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-full font-medium",children:[e.jsx("span",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse"}),"Live Now"]}),u()&&e.jsx("span",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-full font-medium",children:"Completed"}),!g()&&!u()&&e.jsx("span",{className:"px-4 py-2 bg-blue-100 text-blue-700 rounded-full font-medium",children:"Upcoming"})]}),c&&e.jsx("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[{label:"Days",value:c.days},{label:"Hours",value:c.hours},{label:"Minutes",value:c.minutes},{label:"Seconds",value:c.seconds}].map(a=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-blue-100 rounded-lg p-3 mb-2",children:e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:String(a.value).padStart(2,"0")})}),e.jsx("p",{className:"text-sm text-gray-600",children:a.label})]},a.label))}),(k||g()||u())&&e.jsxs("a",{href:n.meet_link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:shadow-lg transition-all mb-4",children:[e.jsx(f,{className:"w-5 h-5"}),g()?"Join Webinar Now":u()?"View Recording":"Open Meet Link",e.jsx(D,{className:"w-4 h-4"})]}),e.jsxs("div",{className:"space-y-3 text-gray-700 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-800 dark:text-gray-200",children:[e.jsx(Y,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{children:(()=>{const a=new Date(n.scheduled_at),s=new Date,r=a.getFullYear()===s.getFullYear()&&a.getMonth()===s.getMonth()&&a.getDate()===s.getDate(),d=a.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return r?`Today, ${d.split(", ").slice(1).join(", ")}`:d})()})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-800 dark:text-gray-200",children:[e.jsx(q,{className:"w-5 h-5 text-gray-400"}),e.jsxs("span",{children:[(()=>{const a=new Date(n.scheduled_at),s=new Date,r=a.getFullYear()===s.getFullYear()&&a.getMonth()===s.getMonth()&&a.getDate()===s.getDate(),d=a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kolkata"});return r?`Today Â· ${d}`:d})()," ","(",n.duration_minutes," minutes)"]})]})]})]})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Updates"}),p>0&&e.jsxs("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium",children:[p," New"]})]}),p>0&&e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 text-sm",children:[e.jsx(Z,{className:"w-4 h-4"}),"Mark all as read"]})]}),w.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(C,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No updates yet. Check back later for announcements!"})]}):e.jsx("div",{className:"space-y-4",children:w.map(a=>e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},className:`border-2 rounded-lg p-4 ${W(a.update_type)} ${a.is_viewed?"":"ring-2 ring-blue-400"}`,onClick:()=>!a.is_viewed&&R(a.id),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:E(a.update_type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg",children:a.title}),!a.is_viewed&&e.jsx("span",{className:"ml-2 w-2 h-2 bg-blue-600 rounded-full"})]}),a.description&&e.jsx("p",{className:"text-sm mt-2 whitespace-pre-wrap",children:a.description}),a.link_url&&e.jsxs("a",{href:a.link_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 mt-3 text-sm font-medium hover:underline",children:["Open Link",e.jsx(D,{className:"w-4 h-4"})]}),e.jsx("p",{className:"text-xs mt-3 opacity-70",children:new Date(a.created_at).toLocaleString()})]})]})},a.id))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(O,{className:"w-6 h-6 text-green-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Registration Details"})]}),e.jsxs("div",{className:"space-y-4 text-gray-800 dark:text-gray-200",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Name"})]}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 ml-6",children:t.full_name})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Email"})]}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 ml-6",children:t.email})]}),t.college_name&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"College"})]}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 ml-6",children:t.college_name})]}),t.phone_number&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Phone"})]}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 ml-6",children:t.phone_number})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Payment Status"}),e.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 rounded-full text-xs font-medium",children:t.payment_status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Registration Status"}),e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 rounded-full text-xs font-medium",children:t.registration_status})]})]}),k&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300 mb-2",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Meeting Link"})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[e.jsx("a",{href:n.meet_link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 break-all",children:n.meet_link}),e.jsx("button",{onClick:()=>{var a;return(a=navigator.clipboard)==null?void 0:a.writeText(n.meet_link)},className:"px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 rounded",title:"Copy link",children:"Copy"})]})]}),e.jsxs("button",{type:"button",disabled:!0,"aria-disabled":"true",title:"Receipt download coming soon",className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-gray-100 text-gray-400 rounded-lg cursor-not-allowed",children:[e.jsx(X,{className:"w-4 h-4"}),"Download Receipt (Coming soon)"]})]})]}),e.jsxs(o.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.1},className:"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"Need Help?"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"If you have any questions about this webinar, check the updates above or contact our support team."}),e.jsx("button",{className:"w-full px-4 py-2 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-200 rounded-lg transition-colors text-sm font-medium",children:"Contact Support"})]})]})]})]})})};export{xe as WebinarDetailsPage};
