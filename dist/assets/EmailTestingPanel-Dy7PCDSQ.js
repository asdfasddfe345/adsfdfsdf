import{j as e}from"./vendor-motion-_XdJ9pBm.js";import{r as l}from"./vendor-react-B4msnGgW.js";import{u as z,s as i,q as H,R as J,a as X,C as I,L as f}from"./index-BbSeE-q4.js";import{X as E}from"./x-circle-ytsTtMRB.js";import{S as A}from"./send-BNy5p617.js";import"./vendor-pdf-B1igRwBP.js";import"./vendor-supabase-B_87WqdG.js";import"./vendor-forms-BxTF4-4_.js";const Y=()=>{const{user:n}=z();return(n==null?void 0:n.role)==="admin"||(n==null?void 0:n.email)==="primoboostai@gmail.com"},ae=()=>{const n=Y(),[o,N]=l.useState(""),[k,R]=l.useState("welcome"),[v,b]=l.useState(!1),[j,d]=l.useState(null),[D,L]=l.useState([]),[M,O]=l.useState([]),[P,$]=l.useState(!0),[x,w]=l.useState("unknown"),[S,C]=l.useState(!1),[r,_]=l.useState(null),F=[{value:"welcome",label:"Welcome Email",icon:"ðŸ‘‹"},{value:"job_digest",label:"Job Digest (Last 8 Hours)",icon:"ðŸ“§"},{value:"webinar_confirmation",label:"Webinar Confirmation",icon:"ðŸŽ“"},{value:"redemption",label:"Redemption",icon:"ðŸ’°"}];l.useEffect(()=>{u(),h(),T()},[]);const u=async()=>{try{const{data:s,error:t}=await i.from("email_logs").select("*").order("created_at",{ascending:!1}).limit(50);if(t)throw t;L(s||[])}catch(s){console.error("Error loading email logs:",s)}finally{$(!1)}},h=async()=>{try{const{data:s,error:t}=await i.rpc("get_email_statistics",{p_days:30});if(t)throw t;O(s||[])}catch(s){console.error("Error loading email stats:",s)}},T=async()=>{var s;try{const t="https://rixmudvtbfkjpwjoefon.supabase.co",{data:a}=await i.auth.getSession(),c=(s=a.session)==null?void 0:s.access_token,g=await(await fetch(`${t}/functions/v1/test-email`,{method:"GET",headers:{Authorization:c?`Bearer ${c}`:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpeG11ZHZ0YmZranB3am9lZm9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1ODk4NzIsImV4cCI6MjA2NjE2NTg3Mn0.PQss75_gbLaiJDFxKvCuHNirUVkKUGrINYGO1oewQGA"}})).json();g!=null&&g.ok?w(g.adminBypass?"bypassed":"connected"):w("failed")}catch{w("failed")}},U=async s=>{var t;if(s.preventDefault(),k==="job_digest"){B();return}b(!0),d(null);try{const a="https://rixmudvtbfkjpwjoefon.supabase.co",{data:c}=await i.auth.getSession(),p=(t=c.session)==null?void 0:t.access_token,y=await(await fetch(`${a}/functions/v1/test-email`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:p?`Bearer ${p}`:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpeG11ZHZ0YmZranB3am9lZm9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1ODk4NzIsImV4cCI6MjA2NjE2NTg3Mn0.PQss75_gbLaiJDFxKvCuHNirUVkKUGrINYGO1oewQGA"},body:JSON.stringify({to:o,emailType:k,testData:{name:"Test User",date:new Date().toLocaleDateString(),time:"10:00 AM",amount:"500.00",method:"Bank Transfer"}})})).json();y.success?(d({success:!0,message:"Test email sent successfully!"}),N(""),setTimeout(()=>{u(),h(),T()},1e3)):d({success:!1,message:y.error||"Failed to send test email"})}catch(a){console.error("Error sending test email:",a),d({success:!1,message:a.message||"An error occurred"})}finally{b(!1)}},Z=async()=>{C(!0),_(null);try{const{data:s,error:t}=await i.functions.invoke("process-daily-job-digest",{body:{}});if(t)throw t;_(s),setTimeout(()=>{u(),h()},1e3)}catch(s){console.error("Error testing digest:",s),_({success:!1,error:s.message||"Failed to send digest emails"})}finally{C(!1)}},B=async()=>{if(!o){d({success:!1,message:"Please enter an email address"});return}b(!0),d(null);try{const{data:s,error:t}=await i.from("job_listings").select("id, company_name, company_logo_url, role_title, domain, application_link, location_type, package_amount, posted_date").eq("is_active",!0).gte("posted_date",new Date(Date.now()-288e5).toISOString()).order("posted_date",{ascending:!1}).limit(10);if(t)throw t;if(!s||s.length===0){d({success:!1,message:"No jobs found in the last 8 hours. Try syncing jobs first."}),b(!1);return}const{data:{user:a}}=await i.auth.getUser(),{data:c}=await i.from("users").select("full_name").eq("id",a==null?void 0:a.id).single(),p=s.map(m=>({job_id:m.id,company_name:m.company_name,company_logo_url:m.company_logo_url,role_title:m.role_title,domain:m.domain,application_link:m.application_link,location_type:m.location_type,package_amount:m.package_amount})),{data:g,error:y}=await i.functions.invoke("send-job-digest-email",{body:{userId:(a==null?void 0:a.id)||"test-user",recipientEmail:o,recipientName:(c==null?void 0:c.full_name)||"Test User",jobs:p,dateRange:"Last 8 hours"}});if(y)throw y;d({success:!0,message:`Job digest sent to ${o} with ${s.length} jobs from last 8 hours!`}),N(""),setTimeout(()=>{u(),h()},1e3)}catch(s){console.error("Error sending single digest:",s),d({success:!1,message:s.message||"Failed to send job digest"})}finally{b(!1)}},G=s=>{switch(s){case"sent":return e.jsx(I,{className:"w-5 h-5 text-green-500"});case"failed":return e.jsx(E,{className:"w-5 h-5 text-red-500"});default:return e.jsx(f,{className:"w-5 h-5 text-yellow-500 animate-spin"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-100 rounded-xl border-2 border-gray-200 dark:border-dark-300 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(H,{className:"w-6 h-6 text-blue-600 dark:text-neon-cyan-400"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text-primary",children:"Email Testing & Monitoring"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"SMTP"}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${x==="connected"?"bg-green-100 text-green-700":x==="bypassed"?"bg-yellow-100 text-yellow-700":x==="failed"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:[x==="connected"&&"Connected",x==="bypassed"&&"Bypassed (Admin)",x==="failed"&&"Disconnected",x==="unknown"&&"Checking..."]})]}),e.jsxs("button",{onClick:()=>{u(),h(),T()},className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 dark:bg-dark-200 rounded-lg hover:bg-gray-200 dark:hover:bg-dark-300 transition-colors",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"Refresh"})]})]}),!n&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(X,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900 dark:text-blue-300",children:[e.jsx("p",{className:"font-semibold mb-1",children:"SMTP Configuration Required"}),e.jsx("p",{children:"Make sure SMTP credentials are configured in Supabase project settings:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"SMTP_HOST (e.g., smtp.gmail.com)"}),e.jsx("li",{children:"SMTP_PORT (587 for TLS, 465 for SSL)"}),e.jsx("li",{children:"SMTP_USER (your email address)"}),e.jsx("li",{children:"SMTP_PASS (your app-specific password)"})]})]})]})}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-dark-text-secondary mb-2",children:"Recipient Email Address"}),e.jsx("input",{type:"email",value:o,onChange:s=>N(s.target.value),required:!0,placeholder:"Enter email address to receive test email",className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 dark:border-dark-300 bg-white dark:bg-dark-200 text-gray-900 dark:text-dark-text-primary focus:border-blue-500 dark:focus:border-neon-cyan-500 focus:outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-dark-text-secondary mb-2",children:"Email Type"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:F.map(s=>e.jsxs("button",{type:"button",onClick:()=>R(s.value),className:`p-4 rounded-lg border-2 transition-all ${k===s.value?"border-blue-600 dark:border-neon-cyan-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-dark-300 hover:border-blue-400 dark:hover:border-neon-cyan-600"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:s.icon}),e.jsx("div",{className:`font-semibold text-sm ${k===s.value?"text-blue-900 dark:text-neon-cyan-300":"text-gray-900 dark:text-dark-text-primary"}`,children:s.label})]},s.value))})]}),j&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center space-x-3 ${j.success?"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-400 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-400 border border-red-200 dark:border-red-800"}`,children:[j.success?e.jsx(I,{className:"w-5 h-5 flex-shrink-0"}):e.jsx(E,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium",children:j.message})]}),e.jsx("button",{type:"submit",disabled:v||!o,className:`w-full py-3 px-6 rounded-lg font-semibold transition-all flex items-center justify-center space-x-2 ${v||!o?"bg-gray-300 dark:bg-dark-300 text-gray-500 cursor-not-allowed":"bg-blue-600 dark:bg-neon-cyan-500 text-white hover:bg-blue-700 dark:hover:bg-neon-cyan-600"}`,children:v?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Sending Test Email..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{children:"Send Test Email"})]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-xl border-2 border-purple-200 dark:border-purple-800 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-dark-text-primary flex items-center space-x-2 mb-2",children:[e.jsx(J,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"}),e.jsx("span",{children:"8-Hour Job Digest System"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Test the automated job digest email system that sends every 8 hours (12am, 8am, 4pm)"})]}),e.jsx("button",{onClick:Z,disabled:S,className:`px-6 py-3 rounded-lg font-semibold transition-all flex items-center space-x-2 ${S?"bg-gray-300 dark:bg-dark-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-blue-600 dark:from-purple-500 dark:to-blue-500 text-white hover:from-purple-700 hover:to-blue-700"}`,children:S?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Testing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{children:"Test 8-Hour Digest"})]})})]}),r&&e.jsx("div",{className:`mt-4 p-4 rounded-lg ${r.success?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[r.success?e.jsx(I,{className:"w-6 h-6 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}):e.jsx(E,{className:"w-6 h-6 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-semibold mb-2 ${r.success?"text-green-900 dark:text-green-300":"text-red-900 dark:text-red-300"}`,children:r.success?"Digest Processed Successfully!":"Digest Processing Failed"}),r.stats&&e.jsx("div",{className:"bg-white dark:bg-dark-200 rounded-lg p-4 mt-3",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Subscribers"}),e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:r.stats.totalSubscribers||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Emails Sent"}),e.jsx("div",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:r.stats.emailsSent||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Jobs"}),e.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:r.stats.totalJobsSent||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Errors"}),e.jsx("div",{className:"text-xl font-bold text-red-600 dark:text-red-400",children:r.stats.errors||0})]})]})}),r.error&&e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-300 mt-2",children:["Error: ",r.error]}),e.jsxs("div",{className:"mt-3 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("p",{children:"âœ“ Emails include company logos with fallback"}),e.jsx("p",{children:'âœ“ "Apply Now" and "View Details" URLs included'}),e.jsx("p",{children:"âœ“ Sends to all users subscribed to job digest"})]})]})]})}),e.jsx("div",{className:"mt-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-300",children:[e.jsx("strong",{children:"â„¹ï¸ What this tests:"})," This triggers the complete digest system that normally runs every 8 hours. It will send job digest emails to all subscribed users with jobs from the last 8 hours, including company logos and application URLs."]})})]}),e.jsxs("div",{className:"bg-white dark:bg-dark-100 rounded-xl border-2 border-gray-200 dark:border-dark-300 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-dark-text-primary mb-4",children:"Email Statistics (Last 30 Days)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:M.map(s=>e.jsxs("div",{className:"bg-gray-50 dark:bg-dark-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:s.email_type}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text-primary mb-1",children:s.total_sent}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Success Rate: ",e.jsxs("span",{className:"font-semibold text-green-600 dark:text-green-400",children:[s.success_rate,"%"]})]}),s.total_failed>0&&e.jsxs("div",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:["Failed: ",s.total_failed]})]},s.email_type))})]}),e.jsxs("div",{className:"bg-white dark:bg-dark-100 rounded-xl border-2 border-gray-200 dark:border-dark-300 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-dark-text-primary mb-4",children:"Recent Email Logs"}),P?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(f,{className:"w-8 h-8 animate-spin text-blue-600 dark:text-neon-cyan-400"})}):D.length===0?e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center py-8",children:"No email logs found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-200 dark:border-dark-300",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-dark-text-secondary",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-dark-text-secondary",children:"Type"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-dark-text-secondary",children:"Recipient"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-dark-text-secondary",children:"Subject"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-dark-text-secondary",children:"Time"})]})}),e.jsx("tbody",{children:D.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-dark-300 hover:bg-gray-50 dark:hover:bg-dark-200",children:[e.jsx("td",{className:"py-3 px-4",children:G(s.status)}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-900 dark:text-dark-text-primary",children:s.email_type}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-900 dark:text-dark-text-primary",children:s.recipient_email}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:s.subject}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:new Date(s.created_at).toLocaleString()})]},s.id))})]})})]})]})};export{ae as EmailTestingPanel};
