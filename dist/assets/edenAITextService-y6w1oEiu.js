import{e as d}from"./aiProxyService-HwcJnoDm.js";const g="openai/gpt-4o-mini";console.log("EdenAI Text Service: Using Supabase Edge Function proxy");const p=async(e,r={})=>{const{provider:o=g,temperature:n=.3,maxTokens:s=4e3}=r;console.log("ü§ñ EdenAI Text Generation Request (via proxy)"),console.log("   Provider:",o),console.log("   Prompt length:",e.length,"chars");const t=await d.chat(e,{provider:o,temperature:n,maxTokens:s});if(!t||t.trim().length===0)throw new Error("Empty response from AI provider");return console.log("‚úÖ EdenAI Response received"),console.log("   Response length:",t.length,"chars"),t},h=async(e,r={})=>{var c;const{provider:o=g,temperature:n=.3,maxTokens:s=4e3}=r,t=((c=e.find(i=>i.role==="system"))==null?void 0:c.content)||"",l=e[e.length-1],a=t?`${t}

${l.content}`:l.content;return await d.chat(a,{provider:o,temperature:n,maxTokens:s})},m=async(e,r={})=>{const{maxRetries:o=3,...n}=r;let s=null,t=1e3;for(let a=1;a<=o;a++)try{return console.log(`üîÑ EdenAI attempt ${a}/${o}...`),await p(e,n)}catch(c){s=c,console.warn(`EdenAI attempt ${a}/${o} failed:`,c),a<o&&(await new Promise(i=>setTimeout(i,t)),t*=2)}if((n.provider||g).includes("openai")){console.log("üîÑ Trying Google as fallback provider...");try{return await p(e,{...n,provider:"google/gemini-1.5-flash"})}catch(a){console.warn("Google fallback also failed:",a)}}throw s||new Error("Failed to generate text after retries")},f=e=>{if(!e||e.trim().length===0)throw console.error("‚ùå Empty response received for JSON parsing"),new Error("Empty response from AI - cannot parse JSON");let r=e.replace(/```json/gi,"").replace(/```/g,"").trim();const o=r.match(/(\{[\s\S]*\}|\[[\s\S]*\])/);o&&(r=o[1]),console.log("üîç Attempting to parse JSON, length:",r.length),console.log("   First 200 chars:",r.slice(0,200));try{return JSON.parse(r)}catch(n){console.error("‚ùå Failed to parse JSON response:",n),console.error("   Raw response:",r.slice(0,500));try{const s=r.replace(/,\s*}/g,"}").replace(/,\s*]/g,"]");return JSON.parse(s)}catch{throw console.error("‚ùå Failed to fix and parse JSON"),new Error("Invalid JSON response from AI")}}},u={generateText:p,generateTextWithRetry:m,chat:h,parseJSONResponse:f};export{u as e};
