import{j as e}from"./vendor-motion-_XdJ9pBm.js";import{r as d,u as T,b as $}from"./vendor-react-B4msnGgW.js";import{u as q,b as B,s as P}from"./vendor-forms-BxTF4-4_.js";import{J as I,a as k,_ as R,$ as S,E as C,L,C as _,s as E,u as V,S as U}from"./index-BbSeE-q4.js";import"./vendor-pdf-B1igRwBP.js";import"./vendor-supabase-B_87WqdG.js";const D=B({password:P().min(8,"Password must be at least 8 characters"),confirmPassword:P().min(8,"Password must be at least 8 characters")}).refine(t=>t.password===t.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),H=({onSuccess:t,onBackToLogin:c})=>{const[g,h]=d.useState(!1),[i,x]=d.useState(null),[n,p]=d.useState(!1),[m,y]=d.useState(!1),{register:u,handleSubmit:b,formState:{errors:o},watch:N}=q({resolver:I(D)}),w=N("password",""),a=w?(r=>{let s=0;return r.length>=8&&s++,r.length>=12&&s++,/[a-z]/.test(r)&&/[A-Z]/.test(r)&&s++,/\d/.test(r)&&s++,/[^a-zA-Z0-9]/.test(r)&&s++,s<=2?{strength:s,label:"Weak",color:"bg-red-500"}:s<=3?{strength:s,label:"Fair",color:"bg-yellow-500"}:s<=4?{strength:s,label:"Good",color:"bg-blue-500"}:{strength:s,label:"Strong",color:"bg-green-500"}})(w):null,f=async r=>{h(!0),x(null);try{console.log("ResetPasswordForm: Attempting to update password...");const{data:s,error:l}=await E.auth.updateUser({password:r.password});if(l)throw console.error("ResetPasswordForm: Password update error:",l),l;console.log("ResetPasswordForm: Password updated successfully",s),t()}catch(s){console.error("ResetPasswordForm: Error:",s);const l=s instanceof Error?s.message:"Failed to reset password. Please try again.";x(l)}finally{h(!1)}};return e.jsxs("div",{className:"space-y-6",children:[i&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl flex items-start dark:bg-red-900/20 dark:border-red-500/50",children:[e.jsx(k,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-3 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm font-medium",children:i})]}),e.jsxs("form",{onSubmit:b(f),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(R,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"})}),e.jsx("input",{type:n?"text":"password",...u("password"),placeholder:"Enter new password",className:`w-full pl-12 pr-12 py-4 border-2 rounded-xl transition-all duration-200 text-gray-900 placeholder-gray-400 dark:bg-dark-200 dark:border-dark-300 dark:text-gray-100 dark:placeholder-gray-500 ${o.password?"border-red-300 bg-red-50 dark:border-red-500 dark:bg-red-900/20":"border-gray-200 bg-gray-50 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:bg-white dark:focus:bg-dark-100"}`}),e.jsx("button",{type:"button",onClick:()=>p(!n),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:n?e.jsx(S,{className:"h-5 w-5"}):e.jsx(C,{className:"h-5 w-5"})})]}),o.password&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400 flex items-center",children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),o.password.message]}),a&&!o.password&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Password strength:"}),e.jsx("span",{className:`text-xs font-semibold ${a.label==="Weak"?"text-red-600 dark:text-red-400":a.label==="Fair"?"text-yellow-600 dark:text-yellow-400":a.label==="Good"?"text-blue-600 dark:text-blue-400":"text-green-600 dark:text-green-400"}`,children:a.label})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2",children:e.jsx("div",{className:`${a.color} h-2 rounded-full transition-all duration-300`,style:{width:`${a.strength/5*100}%`}})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(R,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"})}),e.jsx("input",{type:m?"text":"password",...u("confirmPassword"),placeholder:"Confirm new password",className:`w-full pl-12 pr-12 py-4 border-2 rounded-xl transition-all duration-200 text-gray-900 placeholder-gray-400 dark:bg-dark-200 dark:border-dark-300 dark:text-gray-100 dark:placeholder-gray-500 ${o.confirmPassword?"border-red-300 bg-red-50 dark:border-red-500 dark:bg-red-900/20":"border-gray-200 bg-gray-50 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:bg-white dark:focus:bg-dark-100"}`}),e.jsx("button",{type:"button",onClick:()=>y(!m),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:m?e.jsx(S,{className:"h-5 w-5"}):e.jsx(C,{className:"h-5 w-5"})})]}),o.confirmPassword&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400 flex items-center",children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),o.confirmPassword.message]})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:g,className:`w-full py-4 px-6 rounded-xl font-semibold text-white transition-all duration-300 flex items-center justify-center space-x-2 ${g?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 active:scale-[0.98] shadow-lg hover:shadow-xl"}`,children:g?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Resetting Password..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-5 h-5"}),e.jsx("span",{children:"Reset Password"})]})}),e.jsx("button",{type:"button",onClick:c,className:"w-full bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-dark-200 dark:hover:bg-dark-300 dark:text-gray-300 font-semibold py-3 px-6 rounded-xl transition-colors",children:"Back to Login"})]})]}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-xl dark:bg-blue-900/20 dark:border-blue-500/30",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Password Requirements:"})," At least 8 characters. For better security, use a mix of uppercase, lowercase, numbers, and special characters."]})})]})},Q=()=>{const t=T(),c=$(),{isAuthenticated:g}=V(),[h,i]=d.useState(!0),[x,n]=d.useState(null),[p,m]=d.useState(!1),y="https://res.cloudinary.com/dlkovvlud/image/upload/w_1000,c_fill,ar_1:1,g_auto,r_max,bo_5px_solid_red,b_rgb:262c35/v1751536902/a-modern-logo-design-featuring-primoboos_XhhkS8E_Q5iOwxbAXB4CqQ_HnpCsJn4S1yrhb826jmMDw_nmycqj.jpg";d.useEffect(()=>{(async()=>{console.log("ResetPasswordPage: Full URL:",window.location.href),console.log("ResetPasswordPage: Pathname:",c.pathname),console.log("ResetPasswordPage: Hash:",c.hash);const w=window.location.hash,j=new URLSearchParams(w.substring(1)),a=j.get("type"),f=j.get("access_token");if(console.log("ResetPasswordPage: Hash params - type:",a,"access_token:",f?"present":"missing"),a!=="recovery"||!f){console.log("ResetPasswordPage: No valid recovery link found in URL hash"),n("Invalid or expired password reset link. Please request a new one."),i(!1);return}console.log("ResetPasswordPage: Recovery link detected, waiting for Supabase to process...");let r=null,s=0;const l=5;for(;s<l&&!r;){await new Promise(A=>setTimeout(A,s===0?2e3:1e3));const{data:{session:v},error:F}=await E.auth.getSession();if(console.log(`ResetPasswordPage: Session check attempt ${s+1} - session:`,v?"exists":"null","error:",F),v){r=v;break}s++}r?(console.log("ResetPasswordPage: Valid recovery session detected, user can now reset password"),n(null),i(!1)):(console.log("ResetPasswordPage: No valid session found after multiple attempts"),n("Invalid or expired password reset link. Please request a new one."),i(!1))})()},[c]);const u=()=>{m(!0),setTimeout(()=>{t("/")},2500)},b=()=>{t("/")},o=()=>{t("/",{state:{openAuthModal:!0,view:"forgot-password"}})};return h?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 dark:from-dark-50 dark:via-dark-100 dark:to-dark-200 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-100 rounded-2xl shadow-xl p-8 w-full max-w-md text-center",children:[e.jsx(L,{className:"w-12 h-12 text-blue-600 dark:text-neon-cyan-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Validating your reset link..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm mt-2",children:"Please wait a moment"})]})}):x?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 dark:from-dark-50 dark:via-dark-100 dark:to-dark-200 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-100 rounded-2xl shadow-xl p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-neon-cyan-500 to-neon-blue-500 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg dark:shadow-neon-cyan",children:e.jsx("img",{src:y,alt:"PrimoBoost AI",className:"w-12 h-12 rounded-xl object-cover"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Reset Password"})]}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl flex items-start dark:bg-red-900/20 dark:border-red-500/50 mb-6",children:[e.jsx(k,{className:"w-5 h-5 text-red-600 dark:text-red-400 mr-3 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:x})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:o,className:"w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl",children:"Request New Reset Link"}),e.jsx("button",{onClick:b,className:"w-full bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-dark-200 dark:hover:bg-dark-300 dark:text-gray-300 font-semibold py-3 px-6 rounded-xl transition-colors",children:"Back to Login"})]})]})}):p?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 dark:from-dark-50 dark:via-dark-100 dark:to-dark-200 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-100 rounded-2xl shadow-xl p-8 w-full max-w-md text-center",children:[e.jsx("div",{className:"bg-green-100 dark:bg-green-900/20 w-20 h-20 rounded-3xl flex items-center justify-center mx-auto mb-6",children:e.jsx(_,{className:"w-10 h-10 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-3",children:"Password Reset Successfully!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Your password has been updated. You are now logged in and will be redirected shortly."}),e.jsx("button",{onClick:()=>t("/"),className:"w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl",children:"Continue to Dashboard"})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 dark:from-dark-50 dark:via-dark-100 dark:to-dark-200 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-100 rounded-2xl shadow-xl w-full max-w-md overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-dark-200 dark:to-dark-300 px-6 py-8 border-b border-gray-100 dark:border-dark-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-gradient-to-br from-neon-cyan-500 to-neon-blue-500 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg dark:shadow-neon-cyan",children:e.jsx(U,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Reset Your Password"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:"Enter your new password below"})]})}),e.jsx("div",{className:"p-6",children:e.jsx(H,{onSuccess:u,onBackToLogin:b})})]})})};export{Q as ResetPasswordPage};
