import{j as e,m as x}from"./vendor-motion-_XdJ9pBm.js";import{r as h}from"./vendor-react-B4msnGgW.js";import{u as _,q as p,R as k,C as f}from"./index-BbSeE-q4.js";import{s as o}from"./supabase-DdGTG0kf.js";import{L as N}from"./loader-Bt6ig5Kl.js";import{S as E}from"./send-BNy5p617.js";import{X as S}from"./x-circle-ytsTtMRB.js";import"./vendor-pdf-B1igRwBP.js";import"./vendor-supabase-B_87WqdG.js";import"./vendor-forms-BxTF4-4_.js";const q=()=>{const{user:d}=_(),[r,n]=h.useState(!1),[t,c]=h.useState(null),[b,i]=h.useState(null),y=async()=>{if(!d){i("You must be logged in to test email digest");return}n(!0),i(null),c(null);try{const{data:a,error:s}=await o.functions.invoke("process-daily-job-digest",{body:{}});if(s)throw s;c(a)}catch(a){console.error("Error testing digest:",a),i(a.message||"Failed to send test digest")}finally{n(!1)}},v=async()=>{var a;if(!d){i("You must be logged in to test email");return}n(!0),i(null),c(null);try{const{data:{user:s}}=await o.auth.getUser();if(!(s!=null&&s.email))throw new Error("User email not found");const{data:m,error:u}=await o.from("job_listings").select("id, company_name, company_logo_url, role_title, domain, application_link, location_type, package_amount").eq("is_active",!0).order("posted_date",{ascending:!1}).limit(5);if(u)throw u;if(!m||m.length===0)throw new Error("No active jobs found to include in test email");const j=m.map(l=>({job_id:l.id,company_name:l.company_name,company_logo_url:l.company_logo_url,role_title:l.role_title,domain:l.domain,application_link:l.application_link,location_type:l.location_type,package_amount:l.package_amount})),{data:w,error:g}=await o.functions.invoke("send-job-digest-email",{body:{userId:d.id,recipientEmail:s.email,recipientName:((a=s.user_metadata)==null?void 0:a.full_name)||s.email.split("@")[0],jobs:j,dateRange:"Test Email - Last 24 hours"}});if(g)throw g;c({success:!0,message:"Test email sent successfully!",recipient:s.email,jobCount:j.length,...w})}catch(s){console.error("Error sending test email:",s),i(s.message||"Failed to send test email")}finally{n(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 backdrop-blur-xl rounded-2xl border border-slate-700/50 p-8",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-8",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl",children:e.jsx(p,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Test 8-Hour Email Digest"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Test if job update emails are sending correctly"})]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-xl p-6 border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Test Full Digest System"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Triggers the complete digest processor - sends emails to all subscribed users with jobs from the last 8 hours"})]}),e.jsx("button",{onClick:y,disabled:r,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 transition-all",children:r?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Testing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{children:"Test Full System"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-slate-500",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:"Runs every 8 hours: 12am, 8am, 4pm"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-xl p-6 border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Test Single Email (Quick Test)"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Sends a test email to your account with the latest 5 jobs - no subscription needed"})]}),e.jsx("button",{onClick:v,disabled:r,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg font-semibold hover:from-green-600 hover:to-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 transition-all",children:r?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Sending..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-5 h-5"}),e.jsx("span",{children:"Send Test Email"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-emerald-500",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{children:"Recommended for quick testing"})]})]})]}),t&&e.jsx(x.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-green-500/10 border border-green-500/50 rounded-xl p-6 mb-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(f,{className:"w-6 h-6 text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-green-400 font-semibold mb-2",children:"Success!"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("p",{className:"text-slate-300",children:t.message}),t.recipient&&e.jsxs("p",{className:"text-slate-400",children:[e.jsx("span",{className:"font-medium",children:"Recipient:"})," ",t.recipient]}),t.stats&&e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 mt-3",children:[e.jsx("p",{className:"text-white font-medium mb-2",children:"Email Statistics:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-slate-400",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs",children:"Total Subscribers"}),e.jsx("span",{className:"text-lg font-bold text-white",children:t.stats.totalSubscribers||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs",children:"Emails Sent"}),e.jsx("span",{className:"text-lg font-bold text-green-400",children:t.stats.emailsSent||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs",children:"Total Jobs Sent"}),e.jsx("span",{className:"text-lg font-bold text-blue-400",children:t.stats.totalJobsSent||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs",children:"Errors"}),e.jsx("span",{className:"text-lg font-bold text-red-400",children:t.stats.errors||0})]})]})]}),t.jobCount&&e.jsxs("p",{className:"text-slate-400",children:[e.jsx("span",{className:"font-medium",children:"Jobs Included:"})," ",t.jobCount]}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 mt-3",children:e.jsxs("p",{className:"text-blue-400 text-xs",children:["✓ Check your email inbox for the job digest",e.jsx("br",{}),"✓ If not in inbox, check spam folder",e.jsx("br",{}),"✓ Email includes company logos and all job URLs"]})})]})]})]})}),b&&e.jsx(x.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-red-500/10 border border-red-500/50 rounded-xl p-6 mb-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(S,{className:"w-6 h-6 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-400 font-semibold mb-2",children:"Error"}),e.jsx("p",{className:"text-slate-300 text-sm",children:b}),e.jsxs("div",{className:"mt-3 text-xs text-slate-400",children:[e.jsx("p",{className:"font-medium mb-1",children:"Common issues:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Edge functions not deployed"}),e.jsx("li",{children:"No active job listings in database"}),e.jsx("li",{children:"SMTP credentials not configured"}),e.jsx("li",{children:"No email subscription found"})]})]})]})]})}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-6",children:[e.jsxs("h4",{className:"text-blue-400 font-semibold mb-3 flex items-center space-x-2",children:[e.jsx(p,{className:"w-5 h-5"}),e.jsx("span",{children:"What This Tests"})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-slate-300",children:[e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-400 mt-1",children:"•"}),e.jsx("span",{children:"8-hour job digest email system"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-400 mt-1",children:"•"}),e.jsx("span",{children:"Company logos in emails (with gradient fallback)"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-400 mt-1",children:"•"}),e.jsx("span",{children:'Job application URLs and "Apply Now" buttons'})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-400 mt-1",children:"•"}),e.jsx("span",{children:"Plain text version for better inbox delivery"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-400 mt-1",children:"•"}),e.jsx("span",{children:"Anti-spam headers and professional formatting"})]})]})]}),e.jsxs("div",{className:"mt-6 bg-purple-500/10 border border-purple-500/30 rounded-xl p-6",children:[e.jsx("h4",{className:"text-purple-400 font-semibold mb-3",children:"After Testing"}),e.jsxs("ol",{className:"space-y-2 text-sm text-slate-300 list-decimal list-inside",children:[e.jsx("li",{children:"Check your email inbox (or spam folder)"}),e.jsx("li",{children:"Verify company logos are displaying"}),e.jsx("li",{children:'Click "Apply Now" to test job URLs'}),e.jsx("li",{children:"If satisfied, the system will run automatically every 8 hours"}),e.jsxs("li",{children:["Monitor email logs in database: ",e.jsx("code",{className:"text-xs bg-slate-900 px-2 py-1 rounded",children:"email_logs"})," table"]})]})]})]})})})};export{q as TestEmailDigest};
