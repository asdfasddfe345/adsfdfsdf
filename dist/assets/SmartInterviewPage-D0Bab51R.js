import{j as e}from"./vendor-motion-_XdJ9pBm.js";import{r as a,u as dt}from"./vendor-react-B4msnGgW.js";import{s as v,g as ut,L as mt,C as pt,V as xt,u as gt,k as ht,S as ft}from"./index-BbSeE-q4.js";import{deepseekService as ge}from"./deepseekService-BJOuo5BV.js";import{c as ne}from"./codeCompilerService-Fc1MZoaD.js";import{u as wt,a as vt,s as V,t as k,b as q,S as yt,V as Ve,c as bt,M as _t,d as St,I as jt}from"./InterviewSummaryReport-DvnPzzAF.js";import{C as Nt}from"./code-GxPtUTRK.js";import{P as kt}from"./play-BW95sg1B.js";import{S as $e}from"./send-BNy5p617.js";import{X as qt}from"./x-circle-ytsTtMRB.js";import{I as Rt,R as Ct,C as Tt,D as Et}from"./DurationConfigScreen-BsbmgIDc.js";import"./vendor-pdf-B1igRwBP.js";import"./vendor-supabase-B_87WqdG.js";import"./vendor-forms-BxTF4-4_.js";import"./geminiServiceWrapper-tvm4MzT7.js";import"./edenAITextService-y6w1oEiu.js";import"./aiProxyService-HwcJnoDm.js";import"./pause-C7_k2ztz.js";import"./trophy-D8agcnr9.js";import"./lightbulb-ZFvDqHVp.js";import"./rotate-ccw-BQdMKeUh.js";import"./building-2-B7dH_DvY.js";import"./cloud-DgR56UEK.js";import"./database-BUKIZYYv.js";import"./chevron-right-CPxmRku4.js";class It{async createSession(n,r){const{data:s,error:i}=await v.from("smart_interview_sessions").insert({user_id:r,session_type:n.sessionType,interview_category:n.interviewCategory,company_name:n.companyName,target_role:n.targetRole,domain:n.domain,duration_minutes:n.durationMinutes,status:"in_progress",total_questions:0,questions_answered:0,questions_skipped:0,tab_switches_count:0,fullscreen_exits_count:0,total_violation_time:0,violations_log:[]}).select().single();if(i)throw console.error("Error creating smart interview session:",i),new Error("Failed to create interview session");return s}async selectQuestions(n,r=10){let s=v.from("smart_interview_questions").select("*").eq("is_active",!0);n.companyName&&(s=s.eq("company_name",n.companyName)),n.targetRole&&(s=s.eq("role",n.targetRole)),n.domain&&(s=s.eq("domain",n.domain));const{data:i,error:d}=await s.limit(r);if(d)throw console.error("Error fetching questions:",d),new Error("Failed to fetch questions");return!i||i.length===0?this.generateDefaultQuestions(n,r):this.shuffleAndMixQuestions(i,r)}async generateDefaultQuestions(n,r){const s=[{id:"default-1",question_type:"introduction",question_text:"Please introduce yourself. Tell me about your background, current role, and what you're looking for in your next opportunity.",category:"Behavioral",difficulty:"Easy",requires_coding:!1,expected_answer_points:["Professional background","Current role and responsibilities","Career goals","Relevant skills"]},{id:"default-2",question_type:"behavioral",question_text:"Tell me about a challenging project you worked on. What was your role, what obstacles did you face, and how did you overcome them?",category:"Behavioral",difficulty:"Medium",requires_coding:!1,expected_answer_points:["Project context","Specific challenges","Your actions","Results achieved"]},{id:"default-3",question_type:"technical",question_text:"Explain the difference between REST and GraphQL APIs. When would you choose one over the other?",category:"Technical",difficulty:"Medium",requires_coding:!1,expected_answer_points:["REST characteristics","GraphQL characteristics","Use cases for each","Trade-offs"]},{id:"default-4",question_type:"coding",question_text:"Write a function to check if a given string is a palindrome. The function should ignore spaces and be case-insensitive.",category:"Coding",difficulty:"Easy",requires_coding:!0,default_language:"Python",programming_languages:["Python","JavaScript","Java","C++"],test_case_template:{cases:[{input:'"racecar"',expectedOutput:"true"},{input:'"A man a plan a canal Panama"',expectedOutput:"true"},{input:'"hello"',expectedOutput:"false"}]},expected_complexity:{time:"O(n)",space:"O(1)"}},{id:"default-5",question_type:"coding",question_text:"Implement a function to reverse a linked list. Return the head of the reversed list.",category:"Coding",difficulty:"Medium",requires_coding:!0,default_language:"Python",programming_languages:["Python","JavaScript","Java","C++"],test_case_template:{cases:[{input:"[1, 2, 3, 4, 5]",expectedOutput:"[5, 4, 3, 2, 1]"},{input:"[1, 2]",expectedOutput:"[2, 1]"},{input:"[1]",expectedOutput:"[1]"}]},expected_complexity:{time:"O(n)",space:"O(1)"}}];return s.slice(0,Math.min(r,s.length))}shuffleAndMixQuestions(n,r){const s=n.filter(g=>g.question_type==="introduction"),i=n.filter(g=>g.question_type==="behavioral"),d=n.filter(g=>g.question_type==="technical"),c=n.filter(g=>g.question_type==="coding"),o=[];s.length>0&&o.push(s[0]);const u=r-o.length,m=Math.floor(u*.3),h=Math.floor(u*.3),x=u-m-h;return o.push(...this.shuffle(i).slice(0,m)),o.push(...this.shuffle(d).slice(0,h)),o.push(...this.shuffle(c).slice(0,x)),o}shuffle(n){const r=[...n];for(let s=r.length-1;s>0;s--){const i=Math.floor(Math.random()*(s+1));[r[s],r[i]]=[r[i],r[s]]}return r}async saveResponse(n,r,s,i){const{data:d,error:c}=await v.from("smart_interview_responses").insert({session_id:n,question_id:r,question_order:s,answer_type:i.answerType,text_answer:i.textAnswer,code_answer:i.codeAnswer,programming_language:i.programmingLanguage,audio_transcript:i.audioTranscript,ai_feedback:i.aiFeedback,individual_score:i.individualScore,strengths:i.strengths,improvements:i.improvements,response_duration_seconds:i.responseDuration,auto_submitted:i.autoSubmitted||!1,silence_duration:i.silenceDuration||0,was_skipped:i.wasSkipped||!1}).select().single();if(c)throw console.error("Error saving response:",c),new Error("Failed to save response");return d}async evaluateTextAnswer(n,r,s){try{const i=`You are an expert interview evaluator. Evaluate this interview answer.

Question: ${n}

Expected Answer Points:
${s.map((o,u)=>`${u+1}. ${o}`).join(`
`)}

Candidate's Answer: ${r}

Provide a JSON response with:
{
  "score": <number 0-100>,
  "strengths": [<array of what was done well>],
  "improvements": [<array of areas to improve>],
  "feedback": "<detailed feedback paragraph>"
}`,d=await ge.generateText(i,{maxTokens:500}),c=JSON.parse(d);return{score:c.score,feedback:c,strengths:c.strengths||[],improvements:c.improvements||[]}}catch(i){return console.error("Error evaluating answer:",i),{score:50,feedback:{feedback:"Unable to evaluate answer automatically."},strengths:[],improvements:[]}}}async updateSessionProgress(n,r,s){const{error:i}=await v.from("smart_interview_sessions").update({questions_answered:r,questions_skipped:s}).eq("id",n);i&&console.error("Error updating session progress:",i)}async completeSession(n,r,s){const i=await this.calculateOverallScore(n),d=this.calculateSecurityScore(s),{error:c}=await v.from("smart_interview_sessions").update({status:"completed",completed_at:new Date().toISOString(),actual_duration_seconds:r,overall_score:i,security_score:d,tab_switches_count:s.tabSwitchCount,fullscreen_exits_count:s.fullScreenExits,total_violation_time:s.totalViolationTime,violations_log:s.violationsLog}).eq("id",n);c&&console.error("Error completing session:",c)}async calculateOverallScore(n){const{data:r,error:s}=await v.from("smart_interview_responses").select("individual_score").eq("session_id",n).not("was_skipped","eq",!0);if(s||!r||r.length===0)return 0;const i=r.reduce((d,c)=>d+(c.individual_score||0),0);return Math.round(i/r.length)}calculateSecurityScore(n){let r=100;return r-=n.tabSwitchCount*5,r-=n.fullScreenExits*10,r-=Math.floor(n.totalViolationTime/10)*2,Math.max(0,Math.min(100,r))}async getSession(n){const{data:r,error:s}=await v.from("smart_interview_sessions").select("*").eq("id",n).maybeSingle();return s?(console.error("Error fetching session:",s),null):r}async getSessionResponses(n){const{data:r,error:s}=await v.from("smart_interview_responses").select("*").eq("session_id",n).order("question_order",{ascending:!0});return s?(console.error("Error fetching responses:",s),[]):r||[]}}const R=new It;class At{async generateReviewQuestions(n,r,s,i,d,c){try{const o=`You are an expert coding interviewer conducting a code review. The candidate has submitted the following code:

Original Question: ${s}

Programming Language: ${r}

Code Submitted:
\`\`\`${r.toLowerCase()}
${n}
\`\`\`

Generate 3 follow-up questions to assess the candidate's understanding of their code. Focus on:
1. Time and space complexity analysis
2. Logic explanation and approach
3. Edge cases and potential improvements

Return a JSON array of questions in this format:
[
  {
    "question_type": "complexity" | "logic" | "edge_cases" | "optimization",
    "question_text": "<the question to ask>",
    "code_section_reference": "<specific part of code this refers to, if applicable>",
    "expected_concepts": ["<concept1>", "<concept2>"]
  }
]`,u=await ge.generateText(o,{maxTokens:800}),m=JSON.parse(u),h=[];for(let x=0;x<m.length&&x<3;x++){const g=m[x],{data:$,error:W}=await v.from("code_logic_review_questions").insert({response_id:i,session_id:d,original_question_id:c,review_question_number:x+1,question_type:g.question_type,question_text:g.question_text,code_section_reference:g.code_section_reference,expected_concepts:g.expected_concepts||[]}).select().single();!W&&$&&h.push($)}return h}catch(o){return console.error("Error generating review questions:",o),this.generateDefaultReviewQuestions(n,r,i,d,c)}}async generateDefaultReviewQuestions(n,r,s,i,d){const c=[{review_question_number:1,question_type:"complexity",question_text:"What is the time complexity of your solution? Can you explain how you determined this?",expected_concepts:["Time complexity","Big O notation","Algorithm analysis"]},{review_question_number:2,question_type:"logic",question_text:"Walk me through your approach. Why did you choose this particular method to solve the problem?",expected_concepts:["Problem-solving approach","Algorithm choice","Trade-offs"]},{review_question_number:3,question_type:"edge_cases",question_text:"What edge cases did you consider? Are there any scenarios where your code might fail?",expected_concepts:["Edge cases","Input validation","Error handling"]}],o=[];for(const u of c){const{data:m,error:h}=await v.from("code_logic_review_questions").insert({response_id:s,session_id:i,original_question_id:d,...u}).select().single();!h&&m&&o.push(m)}return o}async saveReviewResponse(n,r,s,i,d,c){const o=await this.getReviewQuestion(n);if(!o)throw new Error("Review question not found");const u=await this.evaluateExplanation(o.question_text,i,o.expected_concepts),{data:m,error:h}=await v.from("code_logic_review_responses").insert({review_question_id:n,response_id:r,session_id:s,explanation_text:i,audio_transcript:d,understanding_score:u.score,ai_feedback:u.feedback,concepts_covered:u.conceptsCovered,concepts_missed:u.conceptsMissed,response_duration_seconds:c}).select().single();if(h)throw console.error("Error saving review response:",h),new Error("Failed to save review response");return m}async getReviewQuestion(n){const{data:r,error:s}=await v.from("code_logic_review_questions").select("*").eq("id",n).maybeSingle();return s?(console.error("Error fetching review question:",s),null):r}async evaluateExplanation(n,r,s){try{const i=`You are an expert coding interviewer evaluating a candidate's explanation of their code.

Review Question: ${n}

Expected Concepts: ${s.join(", ")}

Candidate's Explanation: ${r}

Evaluate the explanation and return JSON:
{
  "score": <number 0-100>,
  "conceptsCovered": [<concepts they explained well>],
  "conceptsMissed": [<concepts they didn't cover>],
  "feedback": "<detailed feedback on their understanding>"
}`,d=await ge.generateText(i,{maxTokens:500}),c=JSON.parse(d);return{score:c.score,feedback:c,conceptsCovered:c.conceptsCovered||[],conceptsMissed:c.conceptsMissed||[]}}catch(i){return console.error("Error evaluating explanation:",i),{score:60,feedback:{feedback:"Unable to evaluate explanation automatically."},conceptsCovered:[],conceptsMissed:s}}}async getReviewQuestions(n){const{data:r,error:s}=await v.from("code_logic_review_questions").select("*").eq("response_id",n).order("review_question_number",{ascending:!0});return s?(console.error("Error fetching review questions:",s),[]):r||[]}async getReviewResponses(n){const{data:r,error:s}=await v.from("code_logic_review_responses").select("*").eq("response_id",n);return s?(console.error("Error fetching review responses:",s),[]):r||[]}async calculateAverageReviewScore(n){const r=await this.getReviewResponses(n);if(r.length===0)return 0;const s=r.reduce((i,d)=>i+(d.understanding_score||0),0);return Math.round(s/r.length)}}const ze=new At,Mt=({config:T,userId:n,userName:r,onInterviewComplete:s,onBack:i})=>{const[d,c]=a.useState("loading"),[o,u]=a.useState(null),[m,h]=a.useState([]),[x,g]=a.useState(0),[$,W]=a.useState(T.durationMinutes*60),[E,G]=a.useState(!1),[Y,z]=a.useState(""),[y,J]=a.useState(""),[S,b]=a.useState("Python"),[M,I]=a.useState(""),[Be,ie]=a.useState(!1),[ae,he]=a.useState(!1),[Qt,Pt]=a.useState(!0),[oe,ce]=a.useState(!1),[fe,le]=a.useState(""),[We,we]=a.useState(!1),[de,ve]=a.useState([]),[H,ye]=a.useState([]),[Ye,be]=a.useState(!1),[_e,Se]=a.useState(!1),[Q,je]=a.useState([]),[P,Ne]=a.useState(0),[U,X]=a.useState(""),[K,Je]=a.useState(0),[ue,ke]=a.useState(!1),[me,qe]=a.useState(!1),[Ge,Z]=a.useState(!1),[He,pe]=a.useState(""),[Re,Ce]=a.useState(0),[Te,w]=a.useState("Initializing interview..."),[Ee,Ue]=a.useState(0),[Ie,Xe]=a.useState(0),N=a.useRef(null),f=a.useRef(null),C=a.useRef(null),Ae=a.useRef([]),F=a.useRef(null),j=a.useRef(null),B=a.useRef(0),Me=a.useRef(Date.now()),O=a.useRef(!1),ee=a.useRef(null),L=wt({onFullScreenExit:()=>{pe("‚ö†Ô∏è You exited full-screen mode. Please return to full-screen to continue."),Z(!0),Ce(t=>t+1),re()},onViolation:t=>{console.log("Full-screen violation:",t)}}),te=vt({onTabSwitch:()=>{pe("‚ö†Ô∏è You switched tabs. Please stay on this page during the interview."),Z(!0),Ce(t=>t+1),re()},onWindowBlur:()=>{pe("‚ö†Ô∏è You switched to another application. Please stay focused on the interview."),Z(!0),re()},onViolation:(t,l)=>{console.log(`Violation: ${t}, Duration: ${l}s`)}}),p=m[x];a.useEffect(()=>(Ke(),()=>{Le()}),[]),a.useEffect(()=>(!E&&(d==="listening"||d==="coding")?F.current=setInterval(()=>{W(t=>t<=1?(xe(),0):t-1)},1e3):F.current&&clearInterval(F.current),()=>{F.current&&clearInterval(F.current)}),[E,d]),a.useEffect(()=>(d==="listening"&&!E?j.current=setInterval(()=>{if(V.isInitialized()){const t=V.getCurrentSilenceDuration();t>0&&we(!1);const l=Math.max(0,5-t);Je(l),l===0&&!ue&&(ke(!0),at())}},100):j.current&&(clearInterval(j.current),j.current=null),()=>{j.current&&clearInterval(j.current)}),[d,E,ue]),a.useEffect(()=>{(async()=>{if(f.current&&N.current){f.current.srcObject!==N.current&&(f.current.srcObject=N.current);try{f.current.readyState>=2?await f.current.play():(await new Promise(l=>{if(!f.current)return l();f.current.onloadedmetadata=()=>l()}),f.current&&await f.current.play())}catch(l){console.error("Error ensuring video playback:",l)}}})()},[d]);const Ke=async()=>{try{w("Setting up interview session...");const t=await R.createSession(T,n);u(t.id),w("Selecting personalized questions...");const l=await R.selectQuestions(T,10);h(l),await R.updateSessionProgress(t.id,0,0),w("Requesting camera and microphone access..."),await Ze(),c("ready"),w("Ready to start interview"),Me.current=Date.now()}catch(t){console.error("Error initializing interview:",t),alert(`Failed to initialize interview: ${t.message}`),i()}},Ze=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});if(N.current=t,he(!0),f.current){f.current.srcObject=t,await new Promise(l=>{f.current&&(f.current.onloadedmetadata=()=>l())}),await new Promise(l=>setTimeout(l,100));try{await f.current.play()}catch(l){console.error("Error playing video:",l)}}}catch(t){console.error("Error accessing media devices:",t),he(!1),alert("Camera/microphone access denied. You can continue, but responses will not be recorded.")}},Qe=async()=>{if(await L.requestFullScreen(),!!p){if(c("question"),w(`Question ${x+1} of ${m.length}`),z(""),J(""),I(""),ke(!1),k.isSupported())try{await k.speak(p.question_text,(t,l)=>{ce(l),le(l?t:"")},{rate:.9,pitch:1})}catch(t){console.error("Error with text-to-speech:",t)}setTimeout(()=>{O.current||(p.requires_coding?tt():et())},500)}},et=async()=>{if(!O.current){if(c("listening"),w("Listening to your answer..."),B.current=Date.now(),ae&&N.current)try{Ae.current=[];const t={mimeType:"video/webm;codecs=vp8,opus"};MediaRecorder.isTypeSupported(t.mimeType)||(t.mimeType="video/webm");const l=new MediaRecorder(N.current,t);l.ondataavailable=_=>{_.data.size>0&&Ae.current.push(_.data)},l.start(1e3),C.current=l,ie(!0)}catch(t){console.error("Error starting media recorder:",t)}if(q.isSupported())try{await q.startListening(t=>{I(t),z(t)},t=>{I(t),z(t)},t=>console.error("Speech recognition error:",t))}catch(t){console.error("Failed to start speech recognition:",t)}if(N.current)try{await V.initialize(N.current,{silenceThreshold:5e3,adaptive:!0,calibrationMs:1e3,minSpeechMs:250,hangoverMs:300,rmsMultiplier:2.8,absoluteRmsFloor:.035}),V.start(t=>{console.log("Silence detected for",t,"seconds")},()=>{we(!0)})}catch(t){console.error("Failed to start silence detection:",t)}}},tt=()=>{c("coding"),w("Write your code solution..."),B.current=Date.now(),p.default_language&&b(p.default_language)},st=async()=>{if(!y.trim()){alert("Please write some code first");return}Se(!0),be(!0),c("executing");try{if(de.length===0){const l=await ne.generateTestCases(p.question_text,S);ve(l)}const t=await ne.executeCode(y,S,de);t.success&&t.executionResults?ye(t.executionResults):alert(t.error||"Execution failed")}catch(t){console.error("Execution error:",t),alert("Failed to execute code")}finally{Se(!1),c("coding")}},rt=async()=>{if(!y.trim()){alert("Please write your code before submitting");return}c("processing"),w("Analyzing your code...");const t=Math.floor((Date.now()-B.current)/1e3);try{if(!o||!p)return;const l=await ne.analyzeCodeQuality(y,S,p.question_text),_=await R.saveResponse(o,p.id,x+1,{answerType:"code",codeAnswer:y,programmingLanguage:S,individualScore:l.overallScore,responseDuration:t,autoSubmitted:!1,wasSkipped:!1});ee.current=_.id;const D=await ne.saveExecutionResult(_.id,o,y,S,de,H);w("Generating code review questions...");const A=await ze.generateReviewQuestions(y,S,p.question_text,_.id,o,p.id);A.length>0?(je(A),Ne(0),X(""),c("code_review"),w("Code review questions..."),k.isSupported()&&await k.speak(A[0].question_text,(lt,De)=>{ce(De),le(De?lt:"")},{rate:.9,pitch:1})):se()}catch(l){console.error("Error submitting code:",l),alert("Failed to submit code")}},nt=async()=>{if(!U.trim()){alert("Please provide an answer");return}w("Evaluating your explanation...");try{if(!o||!ee.current)return;const t=Q[P],l=Math.floor((Date.now()-B.current)/1e3);if(await ze.saveReviewResponse(t.id,ee.current,o,U,void 0,l),P<Q.length-1){Ne(P+1),X(""),B.current=Date.now();const _=Q[P+1];k.isSupported()&&await k.speak(_.question_text,(D,A)=>{ce(A),le(A?D:"")},{rate:.9,pitch:1})}else se()}catch(t){console.error("Error submitting review answer:",t),alert("Failed to submit answer")}},Pe=async(t=!1)=>{const l=Math.floor((Date.now()-B.current)/1e3);C.current&&C.current.state!=="inactive"&&(C.current.stop(),ie(!1)),q.isSupported()&&q.stopListening(),V.stop(),j.current&&(clearInterval(j.current),j.current=null),c("processing"),w(t?"Auto-submitting your answer...":"Processing your answer..."),await it(l,t)},it=async(t,l)=>{try{if(!o||!p)return;const _=Y||M||"No answer provided",D=await R.evaluateTextAnswer(p.question_text,_,p.expected_answer_points||[]);await R.saveResponse(o,p.id,x+1,{answerType:l?"voice":"text",textAnswer:_,audioTranscript:M,aiFeedback:D.feedback,individualScore:D.score,strengths:D.strengths,improvements:D.improvements,responseDuration:t,autoSubmitted:l,silenceDuration:l?5:0,wasSkipped:!1}),Ue(A=>A+1),await R.updateSessionProgress(o,Ee+1,Ie),setTimeout(()=>{O.current||se()},1e3)}catch(_){console.error("Error processing answer:",_),alert("Failed to process answer")}},at=async()=>{await Pe(!0)},ot=async()=>{if(!me){if(qe(!0),w("Skipping question..."),C.current&&C.current.state!=="inactive"&&(C.current.stop(),ie(!1)),q.isSupported()&&q.stopListening(),V.stop(),o&&p)try{await R.saveResponse(o,p.id,x+1,{answerType:"text",textAnswer:"[Question Skipped]",aiFeedback:{feedback:"Question was skipped by the user."},individualScore:0,responseDuration:0,wasSkipped:!0}),Xe(t=>t+1),await R.updateSessionProgress(o,Ee,Ie+1)}catch(t){console.error("Error saving skipped question:",t)}setTimeout(()=>{qe(!1),se()},1e3)}},se=async()=>{O.current||(q.reset(),z(""),J(""),I(""),ye([]),be(!1),ve([]),je([]),X(""),ee.current=null,x+1<m.length?(g(t=>t+1),setTimeout(()=>{O.current||Qe()},500)):Fe())},Fe=async()=>{if(!o)return;O.current=!0,c("completed"),w("Completing interview...");const t=Math.floor((Date.now()-Me.current)/1e3);await R.completeSession(o,t,{tabSwitchCount:te.tabSwitchCount,fullScreenExits:L.violations,totalViolationTime:te.totalTimeAway,violationsLog:te.violations}),L.exitFullScreen(),s(o)},re=()=>{G(!0),d==="listening"&&q.isSupported()&&q.stopListening(),k.pause()},Oe=()=>{G(!1),Z(!1),k.resume(),L.isFullScreen||L.requestFullScreen()},ct=()=>{E?Oe():re()},xe=async()=>{window.confirm("End interview now and view your report? Your progress so far will be analyzed.")&&(O.current=!0,Le(),await Fe())},Le=()=>{C.current&&C.current.stop(),N.current&&N.current.getTracks().forEach(t=>t.stop()),F.current&&clearInterval(F.current),j.current&&clearInterval(j.current),V.cleanup(),k.stop(),q.reset()};return d==="loading"?e.jsx("div",{className:"min-h-screen bg-dark-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-300 text-lg",children:Te})]})}):d==="ready"?e.jsx("div",{className:"min-h-screen bg-dark-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-dark-200 rounded-2xl p-8 max-w-2xl w-full text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-100 mb-4",children:"Ready to Start?"}),e.jsxs("p",{className:"text-gray-400 mb-6",children:["You will answer ",m.length," questions in ",T.durationMinutes," minutes. Questions include introductory, behavioral, technical, and coding challenges."]}),e.jsxs("div",{className:"bg-dark-300 rounded-lg p-4 mb-6 space-y-2",children:[e.jsx("p",{className:"text-gray-300 text-sm",children:ae?"‚úì Camera and microphone are ready":"‚ö† Media devices not available"}),e.jsx("p",{className:"text-gray-300 text-sm",children:k.isSupported()?"‚úì AI voice enabled":"‚ö† Text-to-speech not available"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"‚úì Full-screen security mode will be enabled"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"‚úì Auto code compiler for coding questions"})]}),e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-700 rounded-lg p-4 mb-6 text-left",children:[e.jsx("h3",{className:"text-yellow-400 font-semibold mb-2",children:"‚ö†Ô∏è Important Guidelines:"}),e.jsxs("ul",{className:"text-gray-300 text-sm space-y-1",children:[e.jsx("li",{children:"‚Ä¢ The interview will run in full-screen mode"}),e.jsx("li",{children:"‚Ä¢ Coding questions will open an integrated compiler automatically"}),e.jsx("li",{children:"‚Ä¢ After code passes tests, AI will ask follow-up logic questions"}),e.jsx("li",{children:"‚Ä¢ Voice answers auto-submit after 5 seconds of silence"}),e.jsx("li",{children:"‚Ä¢ Violations will be tracked and reported"})]})]}),e.jsx("button",{onClick:Qe,className:"btn-primary px-8 py-4 text-lg",children:"Start Interview"})]})}):e.jsxs("div",{className:"min-h-screen bg-dark-100 flex flex-col",children:[Ge&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-dark-200 rounded-2xl p-8 max-w-md w-full border-2 border-red-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ut,{className:"w-8 h-8 text-red-500"}),e.jsx("h3",{className:"text-xl font-bold text-red-400",children:"Interview Paused"})]}),e.jsx("p",{className:"text-gray-300 mb-6",children:He}),e.jsxs("div",{className:"bg-red-900/20 border border-red-700 rounded-lg p-4 mb-6",children:[e.jsxs("p",{className:"text-red-300 text-sm",children:[e.jsx("strong",{children:"Violations Detected:"})," ",Re]}),e.jsxs("p",{className:"text-red-300 text-sm mt-1",children:[e.jsx("strong",{children:"Time Away:"})," ",te.totalTimeAway,"s"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("button",{onClick:Oe,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-colors",children:"Return to Interview"}),e.jsx("button",{onClick:xe,className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition-colors",children:"End Interview & View Report"})]})]})}),e.jsx(yt,{userName:r,timeRemaining:$,currentQuestionIndex:x,totalQuestions:m.length,isPaused:E,totalViolations:Re,isFullScreen:L.isFullScreen,onPause:ct,onEnd:xe,onEnterFullScreen:L.requestFullScreen}),e.jsx("div",{className:"flex-1 mt-20 pt-8 pb-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-2 md:px-4 grid md:grid-cols-[300px_1fr_350px] gap-6 h-full",children:[e.jsx("div",{className:"bg-dark-200 rounded-xl p-6 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`w-32 h-32 rounded-full mx-auto mb-4 flex items-center justify-center transition-all ${oe?"bg-gradient-to-br from-blue-500 to-purple-600 animate-pulse":"bg-gradient-to-br from-blue-500/50 to-purple-600/50"}`,children:e.jsx("span",{className:"text-4xl",children:"ü§ñ"})}),e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"AI Interviewer"}),oe&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-400",children:[e.jsx(Ve,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{className:"text-xs",children:"Speaking..."})]})]})}),e.jsx("div",{className:"bg-dark-200 rounded-xl p-8 flex flex-col justify-center max-h-[calc(100vh-200px)] overflow-y-auto",children:p&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-blue-400 mb-4",children:[p.category," ‚Ä¢ ",p.difficulty,p.requires_coding&&" ‚Ä¢ Coding"]}),e.jsx("h3",{className:"text-3xl font-bold text-gray-100 mb-6 leading-relaxed",children:p.question_text}),oe&&fe&&e.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-blue-400 text-sm",children:"AI is speaking:"})]}),e.jsx("p",{className:"text-gray-300 text-sm italic",children:fe})]}),d==="listening"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-dark-300 rounded-lg p-4 min-h-[100px] max-h-[200px] overflow-y-auto",children:e.jsx("p",{className:"text-gray-300 text-sm",children:Y||M||"Start speaking..."})}),K<=5&&K>0&&e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-yellow-400 text-sm",children:"Auto-submitting in:"}),e.jsxs("span",{className:"text-yellow-400 font-mono font-bold text-lg",children:[K,"s"]})]}),e.jsx("div",{className:"mt-2 w-full bg-dark-400 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-yellow-400 h-full transition-all duration-1000",style:{width:`${K/5*100}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Pe(!1),className:"flex-1 btn-primary py-3",disabled:ue,children:"Submit Answer"}),e.jsx("button",{onClick:ot,className:"flex items-center justify-center gap-2 px-4 py-3 bg-gray-700 hover:bg-gray-600 text-gray-200 rounded-lg transition-colors",disabled:me,children:me?e.jsxs(e.Fragment,{children:[e.jsx(mt,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Skipping..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Skip"})]})})]}),e.jsx("div",{className:"flex items-center justify-center gap-3 py-2",children:We?e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm font-semibold",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{children:"üé§ Speaking..."})]}):e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded-full"}),e.jsx("span",{children:"Waiting for speech..."})]})})]}),(d==="coding"||d==="executing")&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(Nt,{className:"w-4 h-4"}),"Write Your Code"]}),e.jsx("select",{value:S,onChange:t=>b(t.target.value),className:"px-3 py-1 bg-dark-300 border border-gray-600 rounded text-sm text-white",children:(p.programming_languages||["Python","JavaScript","Java","C++"]).map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx("textarea",{value:y,onChange:t=>J(t.target.value),className:"w-full h-80 px-4 py-3 bg-dark-300 text-green-400 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none font-mono text-sm",placeholder:`Write your ${S} code here...`})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:st,disabled:_e||!y.trim(),className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-all disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(kt,{className:"w-5 h-5"}),_e?"Running...":"Run & Test Code"]}),e.jsxs("button",{onClick:rt,disabled:!y.trim()||H.length===0,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition-all disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx($e,{className:"w-5 h-5"}),"Submit Code"]})]}),Ye&&H.length>0&&e.jsxs("div",{className:"bg-dark-300 rounded-lg p-4 border border-gray-700",children:[e.jsx("h3",{className:"font-semibold text-gray-100 mb-3 flex items-center gap-2",children:"Test Results"}),e.jsx("div",{className:"space-y-3",children:H.map((t,l)=>e.jsxs("div",{className:`p-3 rounded border ${t.passed?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-medium text-sm",children:["Test Case ",l+1]}),t.passed?e.jsx(pt,{className:"w-5 h-5 text-green-500"}):e.jsx(qt,{className:"w-5 h-5 text-red-500"})]}),e.jsxs("div",{className:"text-xs space-y-1 text-gray-300",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Input:"})," ",t.testCase.input]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Expected:"})," ",t.testCase.expectedOutput]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Got:"})," ",t.actualOutput]})]})]},l))})]})]}),d==="code_review"&&Q.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("span",{className:"text-blue-400 font-semibold",children:["Code Review ",P+1,"/",Q.length]})}),e.jsx("p",{className:"text-gray-100 text-lg",children:Q[P].question_text})]}),e.jsxs("div",{className:"bg-dark-300 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Your Code:"}),e.jsx("pre",{className:"text-sm text-gray-300 overflow-x-auto font-mono max-h-40 overflow-y-auto",children:y})]}),e.jsx("textarea",{value:U,onChange:t=>X(t.target.value),className:"w-full h-40 px-4 py-3 bg-dark-300 text-white border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Explain your code and reasoning..."}),e.jsxs("button",{onClick:nt,disabled:!U.trim(),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx($e,{className:"w-5 h-5"}),P<Q.length-1?"Next Review Question":"Complete Code Review"]})]}),d==="processing"&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-pulse text-blue-400 mb-2",children:"Processing..."}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Analyzing your response"})]})]})}),e.jsxs("div",{className:"bg-dark-200 rounded-xl p-6 flex flex-col",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-4",children:"Your Camera"}),e.jsxs("div",{className:"flex-1 bg-dark-300 rounded-lg overflow-hidden relative",style:{minHeight:"400px"},children:[e.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover min-h-[400px]"}),!ae&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-dark-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(xt,{className:"w-12 h-12 text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Camera not available"})]})})]}),e.jsx("div",{className:"mt-4 flex items-center justify-center gap-2",children:Be?e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"w-5 h-5 text-red-500 animate-pulse"}),e.jsx("span",{className:"text-red-500 text-sm font-semibold",children:"Recording"})]}):e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"Not Recording"})]})})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-dark-200 border-t border-dark-300 py-3",children:e.jsx("div",{className:"max-w-7xl mx-auto px-2 md:px-4 text-center text-sm text-gray-400",children:Te})})]})},cs=({isAuthenticated:T,onShowAuth:n})=>{const{user:r}=gt(),s=dt(),{isChristmasMode:i,colors:d}=ht(),[c,o]=a.useState("type_selection"),[u,m]=a.useState({}),[h,x]=a.useState(null);if(!T)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-dark-100 dark:via-dark-50 dark:to-dark-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-purple-600 p-6 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center",children:e.jsx(ft,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-3xl font-bold text-secondary-900 dark:text-gray-100 mb-4",children:"Smart AI Interview"}),e.jsx("p",{className:"text-secondary-600 dark:text-gray-400 mb-8",children:"Experience intelligent interview practice with automatic code compilation, dynamic follow-up questions, and AI-powered feedback."}),e.jsx("button",{onClick:n,className:"btn-primary px-8 py-3 text-lg",children:"Sign In to Start"})]})});const g=b=>{m({...u,sessionType:b}),o(b==="general"?"role_selection":"company_selection")},$=(b,M,I)=>{m({...u,targetRole:b,domain:M,interviewCategory:I}),o("duration_selection")},W=(b,M,I)=>{m({...u,companyName:b,targetRole:M,interviewCategory:I}),o("duration_selection")},E=b=>{m({...u,durationMinutes:b}),o("interview")},G=b=>{x(b),o("summary")},Y=()=>{o("type_selection"),m({})},z=()=>{u.sessionType==="general"?o("role_selection"):o("company_selection")},y=()=>{o("duration_selection")},J=()=>{o("type_selection"),m({}),x(null)},S=()=>{s("/")};return c==="type_selection"?e.jsx(Rt,{onTypeSelected:g,onBack:S}):c==="role_selection"?e.jsx(Ct,{onRoleSelected:$,onBack:Y}):c==="company_selection"?e.jsx(Tt,{onCompanySelected:W,onBack:Y}):c==="duration_selection"?e.jsx(Et,{onDurationSelected:E,onBack:z}):c==="interview"&&r?e.jsx(Mt,{config:u,userId:r.id,userName:r.email||"Candidate",onInterviewComplete:G,onBack:y}):c==="summary"&&h?e.jsx(jt,{sessionId:h,onStartNewInterview:J,onBackToHome:S}):e.jsx("div",{className:"min-h-screen bg-dark-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-300 text-lg",children:"Loading..."})]})})};export{cs as SmartInterviewPage};
