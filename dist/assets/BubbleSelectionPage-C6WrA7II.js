import{j as e,m as D,A as X}from"./vendor-motion-_XdJ9pBm.js";import{r as x,u as Z}from"./vendor-react-B4msnGgW.js";import{s as _,e as F,a as ee,n as V,C as L,T as O,u as te}from"./index-BbSeE-q4.js";import{A as q}from"./award-BwmFe92M.js";import{X as se}from"./x-circle-ytsTtMRB.js";import{T as A}from"./trophy-D8agcnr9.js";import{B as re}from"./bar-chart-3-Da2kizNa.js";import{R as ae}from"./rotate-ccw-BQdMKeUh.js";import"./vendor-pdf-B1igRwBP.js";import"./vendor-supabase-B_87WqdG.js";import"./vendor-forms-BxTF4-4_.js";class ne{generateId(){return`expr_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getRandomInt(s,a){return Math.floor(Math.random()*(a-s+1))+s}getRandomDecimal(s,a,t=1){const r=Math.random()*(a-s)+s;return Number(r.toFixed(t))}getRandomOperation(s){if(s.includes("mixed")){const a=["addition","subtraction","multiplication","division"];return a[Math.floor(Math.random()*a.length)]}return s[Math.floor(Math.random()*s.length)]}generateSquareRoot(s){const a=[4,9,16,25,36,49,64,81,100,121,144,169,196,225],t=a[Math.floor(Math.random()*a.length)],r=Math.sqrt(t);return{id:this.generateId(),expression:`âˆš${t}`,result:r,operationType:"mixed",hasDecimals:!1,complexityScore:6}}generateAddition(s){if(s.allowDecimals&&Math.random()>.5){const t=this.getRandomDecimal(s.valueRange.min,s.valueRange.max),r=this.getRandomDecimal(s.valueRange.min,s.valueRange.max),n=Number((t+r).toFixed(1));return{id:this.generateId(),expression:`${t}+${r}`,result:n,operationType:"addition",hasDecimals:!0,complexityScore:4}}else{const t=this.getRandomInt(s.valueRange.min,s.valueRange.max),r=this.getRandomInt(s.valueRange.min,s.valueRange.max),n=t+r;return{id:this.generateId(),expression:`${t}+${r}`,result:n,operationType:"addition",hasDecimals:!1,complexityScore:2}}}generateSubtraction(s){if(s.allowDecimals&&Math.random()>.5){const t=this.getRandomDecimal(s.valueRange.min,s.valueRange.max),r=this.getRandomDecimal(s.valueRange.min,Math.min(t,s.valueRange.max)),n=Number((t-r).toFixed(1));return{id:this.generateId(),expression:`${t}-${r}`,result:n,operationType:"subtraction",hasDecimals:!0,complexityScore:5}}else{const t=this.getRandomInt(s.valueRange.min,s.valueRange.max),r=this.getRandomInt(s.valueRange.min,t),n=t-r;return{id:this.generateId(),expression:`${t}-${r}`,result:n,operationType:"subtraction",hasDecimals:!1,complexityScore:3}}}generateMultiplication(s){if(s.allowDecimals&&Math.random()>.6){const t=this.getRandomDecimal(2,6,1),r=this.getRandomDecimal(1,4,1),n=Number((t*r).toFixed(1));return{id:this.generateId(),expression:`${t}Ã—${r}`,result:n,operationType:"multiplication",hasDecimals:!0,complexityScore:7}}else{const t=this.getRandomInt(2,12),r=this.getRandomInt(2,12),n=t*r;return{id:this.generateId(),expression:`${t}Ã—${r}`,result:n,operationType:"multiplication",hasDecimals:!1,complexityScore:5}}}generateDivision(s){if(s.allowDecimals&&Math.random()>.5){const t=this.getRandomDecimal(1.5,4.5,1),r=this.getRandomDecimal(2,8,1),n=Number((t*r).toFixed(1));return{id:this.generateId(),expression:`${n}Ã·${t}`,result:Number(r.toFixed(1)),operationType:"division",hasDecimals:!0,complexityScore:8}}else{const t=this.getRandomInt(2,12),r=this.getRandomInt(2,12),n=t*r;return{id:this.generateId(),expression:`${n}Ã·${t}`,result:r,operationType:"division",hasDecimals:!1,complexityScore:6}}}generateMixed(s){const a=s.allowDecimals&&Math.random()>.5,t=Math.floor(Math.random()*3);if(a)if(t===0){const r=this.getRandomDecimal(1,5,1),n=this.getRandomDecimal(1,3,1),o=this.getRandomDecimal(1.5,3,1),i=Number((r+n).toFixed(1)),l=Number((i*o).toFixed(1));return{id:this.generateId(),expression:`(${r}+${n})Ã—${o}`,result:l,operationType:"mixed",hasDecimals:!0,complexityScore:9}}else if(t===1){const r=this.getRandomDecimal(2,4,1),n=this.getRandomDecimal(2,4,1),o=Number((r*n).toFixed(1)),i=this.getRandomDecimal(1,o-1,1),l=Number((o-i).toFixed(1));return{id:this.generateId(),expression:`${r}Ã—${n}-${i}`,result:l,operationType:"mixed",hasDecimals:!0,complexityScore:10}}else{const r=this.getRandomDecimal(2,4,1),n=this.getRandomDecimal(3,6,1),o=Number((r*n).toFixed(1)),i=this.getRandomDecimal(1,5,1),l=Number((n+i).toFixed(1));return{id:this.generateId(),expression:`${o}Ã·${r}+${i}`,result:l,operationType:"mixed",hasDecimals:!0,complexityScore:11}}else if(t===0){const r=this.getRandomInt(2,8),n=this.getRandomInt(2,8),o=this.getRandomInt(2,5),l=(r+n)*o;return{id:this.generateId(),expression:`(${r}+${n})Ã—${o}`,result:l,operationType:"mixed",hasDecimals:!1,complexityScore:7}}else if(t===1){const r=this.getRandomInt(3,8),n=this.getRandomInt(3,8),o=r*n,i=this.getRandomInt(5,o-5),l=o-i;return{id:this.generateId(),expression:`${r}Ã—${n}-${i}`,result:l,operationType:"mixed",hasDecimals:!1,complexityScore:8}}else{const r=this.getRandomInt(3,6),n=this.getRandomInt(4,10),o=r*n,i=this.getRandomInt(2,8),l=n+i;return{id:this.generateId(),expression:`${o}Ã·${r}+${i}`,result:l,operationType:"mixed",hasDecimals:!1,complexityScore:9}}}generateExpression(s,a=!1){if(a&&Math.random()>.7)return this.generateSquareRoot(s);switch(this.getRandomOperation(s.operationTypes)){case"addition":return this.generateAddition(s);case"subtraction":return this.generateSubtraction(s);case"multiplication":return this.generateMultiplication(s);case"division":return this.generateDivision(s);case"mixed":return this.generateMixed(s);default:return this.generateAddition(s)}}generateExpressions(s,a=!1){const t=[],r=new Set;let n=0;const o=s.count*30;for(;t.length<s.count&&n<o;){n++;const i=this.generateExpression(s,a),l=Math.round(i.result*10);r.has(l)||(t.push(i),r.add(l))}if(t.length<s.count)for(;t.length<s.count;){const i=this.generateExpression(s,a);t.push(i)}return t}generateQuestionSet(s,a,t,r=3){let n,o=!1;return s<=8?n={difficultyLevel:"easy",allowDecimals:!1,operationTypes:s<=4?["addition"]:["addition","subtraction"],valueRange:{min:1,max:15},count:3}:s<=16?n={difficultyLevel:"medium",allowDecimals:s>12,operationTypes:s<=12?["addition","subtraction","multiplication"]:["multiplication","division","addition"],valueRange:{min:2,max:20},count:3}:(n={difficultyLevel:"hard",allowDecimals:!0,operationTypes:["mixed","multiplication","division"],valueRange:{min:2,max:25},count:3},o=s>=20),this.generateExpressions(n,o)}}const ie=new ne;class oe{getDifficultyForQuestion(s,a){const t=Math.ceil(s/2);let r;const n=3;let o=14,i,l,f;const p=this.calculateRecentAccuracy(a,3);return s<=8?(r="easy",i=!1,l=s<=4?["addition"]:["addition","subtraction"],f={min:1,max:15}):s<=16?(r="medium",i=s>12,s<=12?l=["addition","subtraction","multiplication"]:l=["multiplication","division","addition","subtraction"],f={min:2,max:20},p<50&&s>10&&(i=!1,l=["addition","subtraction","multiplication"])):(r="hard",i=!0,l=["multiplication","division","mixed"],f={min:2,max:25},s>=22&&(o=16),p<40&&(r="medium",l=["multiplication","division","addition"],i=!1)),p>90&&s>8&&(r==="easy"?r="medium":r==="medium"&&s>12&&(r="hard",i=!0)),{sectionNumber:t,questionNumber:s,difficultyLevel:r,bubbleCount:n,timeLimit:o,allowDecimals:i,operationTypes:l,valueRange:f}}calculateRecentAccuracy(s,a){if(s.length===0)return 100;const t=s.slice(-a);return t.filter(n=>n.is_correct).length/t.length*100}getSectionDescription(s){return s<=4?"Warm-up: Basic addition and subtraction":s<=8?"Building: Multiplication enters the game":s<=10?"Challenge: Division and decimals":s<=12?"Advanced: Complex mixed operations":"Expert: Master level with square roots"}getProgressPercentage(s,a=24){return Math.round(s/a*100)}shouldShowEncouragement(s,a){const t=a/s*100;return s===8&&t>=75?{show:!0,message:"Excellent start! You're crushing it!"}:s===16&&t>=70?{show:!0,message:"Amazing progress! Keep it up!"}:s===24?t>=90?{show:!0,message:"Outstanding performance! You're a math wizard!"}:t>=70?{show:!0,message:"Great job! You completed all questions!"}:{show:!0,message:"Well done! Practice makes perfect!"}:{show:!1,message:""}}getPerformanceRating(s,a){return s>=90&&a<=8?{rating:"Exceptional",color:"text-yellow-600",message:"You have outstanding mental math skills!"}:s>=80&&a<=10?{rating:"Excellent",color:"text-green-600",message:"You performed exceptionally well!"}:s>=70&&a<=12?{rating:"Very Good",color:"text-blue-600",message:"Great job! Your skills are impressive!"}:s>=60?{rating:"Good",color:"text-indigo-600",message:"Well done! Keep practicing to improve further."}:{rating:"Needs Practice",color:"text-gray-600",message:"Keep practicing! You'll improve with time."}}}const Y=new oe;class le{async createSession(s){const{data:a,error:t}=await _.from("bubble_selection_sessions").insert({user_id:s,difficulty_level:"adaptive",total_questions:24,current_section:1,questions_answered:0,correct_answers:0,start_time:new Date().toISOString(),total_time_seconds:0,final_score:0,is_completed:!1}).select().single();if(t)throw console.error("Error creating bubble selection session:",t),t;return a}async getSession(s){const{data:a,error:t}=await _.from("bubble_selection_sessions").select("*").eq("id",s).maybeSingle();if(t)throw console.error("Error fetching session:",t),t;return a}async updateSession(s,a){const{error:t}=await _.from("bubble_selection_sessions").update(a).eq("id",s);if(t)throw console.error("Error updating session:",t),t}async generateQuestion(s,a,t){if(!await this.getSession(s))throw new Error("Session not found");const n=await this.getSessionQuestions(s),o=Y.getDifficultyForQuestion(a,n),i=ie.generateQuestionSet(a,o.sectionNumber,o.difficultyLevel,o.bubbleCount),l=[...i].sort((g,h)=>g.result-h.result),f=i.map(g=>l.findIndex(h=>h.id===g.id)),{data:p,error:w}=await _.from("bubble_selection_questions").insert({session_id:s,question_number:a,section_number:o.sectionNumber,difficulty_level:o.difficultyLevel,expressions:i,correct_sequence:f,user_sequence:[],time_limit_seconds:o.timeLimit,time_taken_seconds:0,is_correct:!1,score_earned:0}).select().single();if(w)throw console.error("Error generating question:",w),w;return p}async submitAnswer(s,a,t){const{data:r,error:n}=await _.from("bubble_selection_questions").select("*").eq("id",s).single();if(n||!r)throw console.error("Error fetching question:",n),n;const o=JSON.stringify(a)===JSON.stringify(r.correct_sequence),{data:i}=await _.rpc("calculate_bubble_score",{p_time_taken:t,p_time_limit:r.time_limit_seconds,p_is_correct:o,p_difficulty_level:r.difficulty_level}),l=i||0,{error:f}=await _.from("bubble_selection_questions").update({user_sequence:a,time_taken_seconds:t,is_correct:o,score_earned:l}).eq("id",s);if(f)throw console.error("Error updating question:",f),f;const p=await this.getSession(r.session_id);return p&&await this.updateSession(r.session_id,{questions_answered:p.questions_answered+1,correct_answers:p.correct_answers+(o?1:0),final_score:p.final_score+l,total_time_seconds:p.total_time_seconds+Math.floor(t),current_section:Math.ceil((p.questions_answered+1)/2)}),{isCorrect:o,scoreEarned:l}}async completeSession(s,a){await this.updateSession(s,{is_completed:!0,end_time:new Date().toISOString()}),await _.rpc("update_bubble_leaderboard",{p_user_id:a,p_session_id:s})}async getSessionQuestions(s){const{data:a,error:t}=await _.from("bubble_selection_questions").select("*").eq("session_id",s).order("question_number",{ascending:!0});if(t)throw console.error("Error fetching session questions:",t),t;return a||[]}async getLeaderboard(s="all_time",a=10){const{data:t,error:r}=await _.from("bubble_selection_leaderboard").select(`
        *,
        user_profiles!inner(full_name)
      `).eq("period",s).order("best_score",{ascending:!1}).limit(a);if(r)throw console.error("Error fetching leaderboard:",r),r;return(t||[]).map((n,o)=>{var i;return{...n,rank:o+1,user_name:((i=n.user_profiles)==null?void 0:i.full_name)||"Anonymous"}})}async getUserLeaderboardEntry(s,a="all_time"){var n;const{data:t,error:r}=await _.from("bubble_selection_leaderboard").select(`
        *,
        user_profiles!inner(full_name)
      `).eq("user_id",s).eq("period",a).maybeSingle();return r?(console.error("Error fetching user leaderboard entry:",r),null):t?{...t,user_name:((n=t.user_profiles)==null?void 0:n.full_name)||"Anonymous"}:null}async getPerformanceMetrics(s){const a=await this.getSession(s),t=await this.getSessionQuestions(s);if(!a)throw new Error("Session not found");const r=a.total_time_seconds,n=t.length>0?r/t.length:0,o=a.questions_answered>0?a.correct_answers/a.questions_answered*100:0;let i=0,l=0;t.forEach(g=>{g.is_correct?(i++,l=Math.max(l,i)):i=0});const f=t.reduce((g,h)=>h.is_correct?g+100:g,0),p=t.reduce((g,h)=>h.is_correct&&h.time_taken_seconds<h.time_limit_seconds?g+Math.floor((h.time_limit_seconds-h.time_taken_seconds)*5):g,0),w=t.reduce((g,h)=>{if(h.is_correct){const j=h.difficulty_level==="hard"?2:h.difficulty_level==="medium"?1.5:1;return g+Math.floor(100*(j-1))}return g},0);return{totalTime:r,averageTimePerQuestion:n,accuracy:o,correctAnswers:a.correct_answers,totalQuestions:a.questions_answered,bestStreak:l,scoreBreakdown:{totalScore:a.final_score,baseScore:f,timeBonus:p,difficultyBonus:w}}}calculateScore(s,a,t,r){let o=0,i=1;if(t)switch(s<=3?o=50:s<=5?o=30:s<=7?o=15:s<a&&(o=5),r){case"easy":i=1;break;case"medium":i=1.5;break;case"hard":i=2;break}const l=t?Math.floor((100+o)*i):0;return{baseScore:t?100:0,timeBonus:t?o:0,difficultyMultiplier:i,finalScore:l,accuracy:t?100:0}}}const E=new le,ce=({userId:k,onGameComplete:s,onGameExit:a})=>{const[t,r]=x.useState({status:"idle",currentQuestion:null,questionNumber:0,sectionNumber:1,totalQuestions:24,score:0,correctAnswers:0,streak:0,timeRemaining:14,selectedBubbles:[],isValidating:!1}),[n,o]=x.useState(null),[i,l]=x.useState(null),[f,p]=x.useState(0),[w,g]=x.useState({show:!1,isCorrect:!1,message:""}),[h,j]=x.useState(!0),d=x.useRef(null),b=x.useRef(!1),T=x.useRef(null),Q=x.useRef(null),I=x.useRef(t),M=x.useRef(0);x.useEffect(()=>{T.current=n},[n]),x.useEffect(()=>{Q.current=i},[i]),x.useEffect(()=>{I.current=t},[t]),x.useEffect(()=>{M.current=f},[f]),x.useEffect(()=>(d.current&&(clearInterval(d.current),d.current=null),t.status==="playing"&&!t.isValidating&&t.timeRemaining>0&&(d.current=setInterval(()=>{r(c=>{if(c.isValidating||c.status!=="playing")return d.current&&(clearInterval(d.current),d.current=null),c;const u=c.timeRemaining-1;return u<=0?(d.current&&(clearInterval(d.current),d.current=null),b.current||(b.current=!0,Promise.resolve().then(()=>G())),{...c,timeRemaining:0,isValidating:!0}):{...c,timeRemaining:u}})},1e3)),()=>{d.current&&(clearInterval(d.current),d.current=null)}),[t.status,t.isValidating,t.questionNumber]),x.useEffect(()=>{t.timeRemaining===0&&t.status==="playing"&&!t.isValidating&&!b.current&&(console.log("Safety timeout trigger activated!"),b.current=!0,G())},[t.timeRemaining,t.status,t.isValidating]);const H=async()=>{try{const c=await E.createSession(k);o(c),T.current=c,j(!1),await P(c.id,1)}catch(c){console.error("Error starting game:",c)}},P=async(c,u)=>{try{d.current&&(clearInterval(d.current),d.current=null),b.current=!1,g({show:!1,isCorrect:!1,message:""});const m=await E.generateQuestion(c,u,k);l(m.id),Q.current=m.id;const R=Date.now();p(R),M.current=R;const y=m.expressions.map((S,$)=>({id:S.id,expression:S,index:$,isSelected:!1,selectionOrder:void 0})),v={questionNumber:m.question_number,sectionNumber:m.section_number,difficultyLevel:m.difficulty_level,bubbles:y,correctSequence:m.correct_sequence,timeLimit:m.time_limit_seconds,timeTaken:0,userSequence:[],isCorrect:!1,scoreEarned:0};r(S=>({...S,status:"playing",currentQuestion:v,questionNumber:u,sectionNumber:m.section_number,timeRemaining:m.time_limit_seconds,selectedBubbles:[],isValidating:!1}))}catch(m){console.error("Error loading question:",m),b.current=!1}},U=c=>{if(t.status!=="playing"||t.isValidating||t.selectedBubbles.includes(c)||t.timeRemaining<=0)return;const u=[...t.selectedBubbles,c];r(m=>{const R=m.currentQuestion?{...m.currentQuestion,bubbles:m.currentQuestion.bubbles.map(y=>y.index===c?{...y,isSelected:!0,selectionOrder:u.length}:y)}:null;return{...m,selectedBubbles:u,currentQuestion:R}}),t.currentQuestion&&u.length===t.currentQuestion.bubbles.length&&setTimeout(()=>W(u),100)},W=async c=>{const u=Q.current,m=T.current;if(!u||!m||b.current){console.log("Validation blocked:",{questionId:u,hasSession:!!m,isProcessing:b.current});return}b.current=!0,r(y=>({...y,isValidating:!0})),d.current&&(clearInterval(d.current),d.current=null);const R=(Date.now()-M.current)/1e3;try{const{isCorrect:y,scoreEarned:v}=await E.submitAnswer(u,c,R),S=I.current.currentQuestion;if(!S){b.current=!1;return}const $=[...S.bubbles].sort((N,C)=>N.expression.result-C.expression.result);r(N=>({...N,score:N.score+v,correctAnswers:N.correctAnswers+(y?1:0),streak:y?N.streak+1:0})),g({show:!0,isCorrect:y,message:y?`Correct! +${v} points`:`Incorrect! The correct order was: ${$.map(N=>N.expression.result).join(" < ")}`}),setTimeout(()=>{g({show:!1,isCorrect:!1,message:""}),b.current=!1,B()},2500)}catch(y){console.error("Error validating answer:",y),r(v=>({...v,isValidating:!1})),b.current=!1}},G=async()=>{var R;console.log("=== TIMEOUT TRIGGERED ===");const c=Q.current,u=T.current,m=I.current;if(console.log("Timeout state:",{questionId:c,hasSession:!!u,isProcessing:b.current,timeRemaining:m.timeRemaining}),!c||!u){console.error("Missing questionId or session!"),b.current=!1;return}d.current&&(clearInterval(d.current),d.current=null);try{const y=((R=m.currentQuestion)==null?void 0:R.timeLimit)||14;console.log("Submitting timeout answer..."),await E.submitAnswer(c,m.selectedBubbles,y),console.log("Timeout answer submitted successfully");const v=m.currentQuestion;let S="Time's up! Question missed.";v&&(S=`Time's up! Correct order: ${[...v.bubbles].sort((N,C)=>N.expression.result-C.expression.result).map(N=>N.expression.result).join(" < ")}`),r($=>({...$,streak:0,isValidating:!0})),g({show:!0,isCorrect:!1,message:S}),setTimeout(()=>{console.log("Moving to next question after timeout"),g({show:!1,isCorrect:!1,message:""}),b.current=!1,B()},2500)}catch(y){console.error("Error handling timeout:",y),b.current=!1,r(v=>({...v,isValidating:!1})),setTimeout(()=>{console.log("Force moving to next question after error"),B()},1e3)}},B=()=>{const c=T.current;if(!c){console.log("No session found in proceedToNextQuestion");return}const u=I.current.questionNumber+1;console.log("Proceeding to question:",u),u>I.current.totalQuestions?K():setTimeout(()=>{P(c.id,u)},300)},K=async()=>{const c=T.current;if(c){d.current&&(clearInterval(d.current),d.current=null);try{await E.completeSession(c.id,k),r(u=>({...u,status:"completed"})),s(c.id)}catch(u){console.error("Error completing game:",u)}}},z=()=>t.timeRemaining<=3?"text-red-600":t.timeRemaining<=7?"text-orange-500":"text-blue-600",J=c=>{switch(c){case"easy":return"bg-green-100 text-green-700";case"medium":return"bg-yellow-100 text-yellow-700";case"hard":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}};return h?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-dark-50 dark:via-dark-100 dark:to-dark-200 flex items-center justify-center p-4",children:e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"max-w-2xl w-full bg-white dark:bg-dark-100 rounded-3xl shadow-2xl p-8 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(F,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Bubble Selection Game"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Test Your Mental Math Speed"})]}),e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center",children:[e.jsx(ee,{className:"w-5 h-5 mr-2 text-blue-600"}),"How to Play"]}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-gray-700 dark:text-gray-300",children:[e.jsx("li",{children:"You'll see 3 mathematical expressions in bubbles"}),e.jsx("li",{children:"Calculate each expression mentally"}),e.jsx("li",{children:"Click the bubbles in order from LOWEST to HIGHEST value"}),e.jsx("li",{children:"Complete each question within 14 seconds"}),e.jsx("li",{children:"Answer 24 questions with increasing difficulty"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Questions 1-8"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Addition & Subtraction"})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Questions 9-16"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Multiplication & Division"})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Questions 17-24"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Complex operations & Square roots"})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Challenge"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Always 3 bubbles, 14 seconds"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:H,className:"flex-1 px-6 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-bold text-lg hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg",children:"Start Game"}),e.jsx("button",{onClick:a,className:"px-6 py-4 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Exit"})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-dark-50 dark:via-dark-100 dark:to-dark-200 py-8 px-4",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-dark-100 rounded-3xl shadow-2xl p-6 md:p-8 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Question"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[t.questionNumber," / ",t.totalQuestions]})]}),t.currentQuestion&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${J(t.currentQuestion.difficultyLevel)}`,children:t.currentQuestion.difficultyLevel.toUpperCase()})]}),e.jsxs("div",{className:`flex items-center space-x-2 text-2xl font-bold ${z()}`,children:[e.jsx(V,{className:"w-6 h-6"}),e.jsxs("span",{children:[t.timeRemaining,"s"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-300",style:{width:`${t.questionNumber/t.totalQuestions*100}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(q,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Score"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:t.score})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(L,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Correct"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:t.correctAnswers})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(O,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Streak"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:t.streak})]})]}),e.jsx("div",{className:"mb-6 text-center",children:e.jsxs("p",{className:"text-lg font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Select the bubbles in order from the ",e.jsx("span",{className:"text-blue-600 font-bold",children:"LOWEST"})," to the ",e.jsx("span",{className:"text-purple-600 font-bold",children:"HIGHEST"})," value"]})}),t.currentQuestion&&e.jsx("div",{className:"flex flex-wrap items-center justify-center gap-6 min-h-[300px]",children:t.currentQuestion.bubbles.map((c,u)=>e.jsxs(D.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:u*.1},whileHover:{scale:c.isSelected?1:1.05},whileTap:{scale:.95},onClick:()=>U(c.index),disabled:c.isSelected||t.isValidating||t.timeRemaining<=0,className:`relative w-32 h-32 rounded-full flex items-center justify-center text-2xl font-bold transition-all shadow-lg ${c.isSelected?"bg-gradient-to-br from-blue-400 to-purple-500 text-white cursor-not-allowed":"bg-gradient-to-br from-white to-blue-50 dark:from-dark-200 dark:to-dark-300 text-gray-900 dark:text-gray-100 hover:shadow-xl cursor-pointer border-2 border-blue-200 dark:border-blue-700"}`,children:[e.jsx("span",{children:c.expression.expression}),c.isSelected&&c.selectionOrder&&e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center text-sm font-bold text-gray-900",children:c.selectionOrder})]},`q${t.questionNumber}-${c.id}`))}),e.jsx(X,{children:w.show&&e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`mt-6 p-4 rounded-xl ${w.isCorrect?"bg-green-50 dark:bg-green-900/20 border-2 border-green-500":"bg-red-50 dark:bg-red-900/20 border-2 border-red-500"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[w.isCorrect?e.jsx(L,{className:"w-6 h-6 text-green-600"}):e.jsx(se,{className:"w-6 h-6 text-red-600"}),e.jsx("p",{className:`text-lg font-semibold ${w.isCorrect?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:w.message})]})})})]})})})},de=({sessionId:k,userId:s,onPlayAgain:a,onExit:t})=>{const[r,n]=x.useState(null),[o,i]=x.useState([]),[l,f]=x.useState(null),[p,w]=x.useState(!0);x.useEffect(()=>{g()},[k,s]);const g=async()=>{try{w(!0);const j=await E.getPerformanceMetrics(k);n(j);const d=await E.getLeaderboard("all_time",10);i(d);const b=await E.getUserLeaderboardEntry(s,"all_time");f(b)}catch(j){console.error("Error loading results:",j)}finally{w(!1)}};if(p||!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-dark-50 dark:via-dark-100 dark:to-dark-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading results..."})]})});const h=Y.getPerformanceRating(r.accuracy,r.averageTimePerQuestion);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-dark-50 dark:via-dark-100 dark:to-dark-200 py-8 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-xl",children:e.jsx(A,{className:"w-12 h-12 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Game Complete!"}),e.jsx("p",{className:`text-2xl font-semibold ${h.color}`,children:h.rating}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400 mt-2",children:h.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs(D.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"bg-white dark:bg-dark-100 rounded-2xl shadow-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-6 flex items-center",children:[e.jsx(re,{className:"w-6 h-6 mr-2 text-blue-600"}),"Performance Overview"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Total Score"})]}),e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:r.scoreBreakdown.totalScore})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 dark:bg-green-900/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(F,{className:"w-6 h-6 text-green-600"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Accuracy"})]}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[r.accuracy.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-purple-50 dark:bg-purple-900/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{className:"w-6 h-6 text-purple-600"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Avg Time"})]}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[r.averageTimePerQuestion.toFixed(1),"s"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(O,{className:"w-6 h-6 text-yellow-600"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Best Streak"})]}),e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:r.bestStreak})]})]})]}),e.jsxs(D.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},className:"bg-white dark:bg-dark-100 rounded-2xl shadow-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-6 flex items-center",children:[e.jsx(q,{className:"w-6 h-6 mr-2 text-purple-600"}),"Score Breakdown"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Base Score"}),e.jsx("span",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:r.scoreBreakdown.baseScore})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${r.scoreBreakdown.baseScore/r.scoreBreakdown.totalScore*100}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Time Bonus"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:["+",r.scoreBreakdown.timeBonus]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${r.scoreBreakdown.timeBonus/r.scoreBreakdown.totalScore*100}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Difficulty Bonus"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:["+",r.scoreBreakdown.difficultyBonus]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-500 h-2 rounded-full",style:{width:`${r.scoreBreakdown.difficultyBonus/r.scoreBreakdown.totalScore*100}%`}})})]}),e.jsx("div",{className:"pt-4 border-t-2 border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:"Total Score"}),e.jsx("span",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:r.scoreBreakdown.totalScore})]})}),e.jsx("div",{className:"mt-4 p-4 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-xl",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center",children:[r.correctAnswers," out of ",r.totalQuestions," questions answered correctly"]})})]})]})]}),l&&e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-dark-100 rounded-2xl shadow-xl p-6 mb-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-4 flex items-center",children:[e.jsx(A,{className:"w-6 h-6 mr-2 text-yellow-600"}),"Your All-Time Stats"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-dark-200 rounded-xl",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Best Score"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:l.best_score})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-dark-200 rounded-xl",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Avg Score"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:Math.round(l.average_score)})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-dark-200 rounded-xl",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Games Played"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:l.total_games_played})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-dark-200 rounded-xl",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Best Accuracy"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[l.best_accuracy_percentage.toFixed(0),"%"]})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-dark-200 rounded-xl",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Best Streak"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:l.highest_streak})]})]})]}),e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white dark:bg-dark-100 rounded-2xl shadow-xl p-6 mb-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-6 flex items-center",children:[e.jsx(A,{className:"w-6 h-6 mr-2 text-yellow-600"}),"Global Leaderboard"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"py-3 px-4 text-left text-sm font-semibold text-gray-600 dark:text-gray-400",children:"Rank"}),e.jsx("th",{className:"py-3 px-4 text-left text-sm font-semibold text-gray-600 dark:text-gray-400",children:"Player"}),e.jsx("th",{className:"py-3 px-4 text-right text-sm font-semibold text-gray-600 dark:text-gray-400",children:"Score"}),e.jsx("th",{className:"py-3 px-4 text-right text-sm font-semibold text-gray-600 dark:text-gray-400",children:"Accuracy"}),e.jsx("th",{className:"py-3 px-4 text-right text-sm font-semibold text-gray-600 dark:text-gray-400",children:"Games"})]})}),e.jsx("tbody",{children:o.map((j,d)=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${j.user_id===s?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center",children:[d===0&&e.jsx("span",{className:"text-2xl mr-2",children:"ðŸ¥‡"}),d===1&&e.jsx("span",{className:"text-2xl mr-2",children:"ðŸ¥ˆ"}),d===2&&e.jsx("span",{className:"text-2xl mr-2",children:"ðŸ¥‰"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:["#",d+1]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:[j.user_name,j.user_id===s&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 dark:text-blue-400",children:"(You)"})]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"font-bold text-gray-900 dark:text-gray-100",children:j.best_score})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[j.best_accuracy_percentage.toFixed(0),"%"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:j.total_games_played})})]},j.id))})]})})]}),e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("button",{onClick:a,className:"flex-1 px-6 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-bold text-lg hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2",children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{children:"Play Again"})]}),e.jsx("button",{onClick:t,className:"px-6 py-4 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Exit to Menu"})]})]})})},ke=()=>{const k=Z(),{user:s}=te(),[a,t]=x.useState("playing"),[r,n]=x.useState(null);if(!s)return k("/gaming"),null;const o=f=>{n(f),t("results")},i=()=>{n(null),t("playing")},l=()=>{k("/gaming")};return a==="results"&&r?e.jsx(de,{sessionId:r,userId:s.id,onPlayAgain:i,onExit:l}):e.jsx(ce,{userId:s.id,onGameComplete:o,onGameExit:l})};export{ke as BubbleSelectionPage,ke as default};
