import{s as n}from"./index-BbSeE-q4.js";class c{async getUserPreferences(e){try{const{data:r,error:t}=await n.from("user_job_preferences").select("*").eq("user_id",e).maybeSingle();if(t)throw t;return r}catch(r){return console.error("Error fetching user preferences:",r),null}}async savePreferences(e){try{const{error:r}=await n.from("user_job_preferences").upsert({...e,last_updated:new Date().toISOString()},{onConflict:"user_id"});if(r)throw r;return!0}catch(r){return console.error("Error saving preferences:",r),!1}}async uploadResume(e,r){try{const t=r.name.split(".").pop(),o=`${e}/${Date.now()}.${t}`,{data:s,error:a}=await n.storage.from("user-resumes").upload(o,r,{cacheControl:"3600",upsert:!0});if(a)throw a;const{data:i}=n.storage.from("user-resumes").getPublicUrl(o);return i.publicUrl}catch(t){return console.error("Error uploading resume:",t),null}}async deleteResume(e,r){try{const t=r.split("/user-resumes/")[1];if(!t)return!1;const{error:o}=await n.storage.from("user-resumes").remove([t]);if(o)throw o;return!0}catch(t){return console.error("Error deleting resume:",t),!1}}async hasCompletedOnboarding(e){try{const{data:r,error:t}=await n.from("user_job_preferences").select("onboarding_completed").eq("user_id",e).maybeSingle();if(t)throw t;return(r==null?void 0:r.onboarding_completed)||!1}catch(r){return console.error("Error checking onboarding status:",r),!1}}async completeOnboarding(e){try{const{error:r}=await n.from("user_job_preferences").update({onboarding_completed:!0}).eq("user_id",e);if(r)throw r;return!0}catch(r){return console.error("Error completing onboarding:",r),!1}}async updatePreferenceField(e,r,t){try{const{error:o}=await n.from("user_job_preferences").update({[r]:t,last_updated:new Date().toISOString()}).eq("user_id",e);if(o)throw o;return!0}catch(o){return console.error("Error updating preference field:",o),!1}}async deletePreferences(e){try{const{error:r}=await n.from("user_job_preferences").delete().eq("user_id",e);if(r)throw r;return!0}catch(r){return console.error("Error deleting preferences:",r),!1}}async getNotificationSubscription(e){try{const{data:r,error:t}=await n.from("job_notification_subscriptions").select("*").eq("user_id",e).maybeSingle();if(t)throw t;return r}catch(r){return console.error("Error fetching notification subscription:",r),null}}async updateNotificationSubscription(e,r,t=!0,o="daily"){try{const{error:s}=await n.from("job_notification_subscriptions").upsert({user_id:e,is_subscribed:t,preferred_domains:r,notification_frequency:o,updated_at:new Date().toISOString()},{onConflict:"user_id"});if(s)throw s;return!0}catch(s){return console.error("Error updating notification subscription:",s),!1}}async unsubscribeFromNotifications(e){try{const{error:r}=await n.from("job_notification_subscriptions").update({is_subscribed:!1,updated_at:new Date().toISOString()}).eq("user_id",e);if(r)throw r;return!0}catch(r){return console.error("Error unsubscribing from notifications:",r),!1}}async getNotificationStats(e){try{const{data:r,error:t}=await n.from("job_notification_logs").select("*",{count:"exact",head:!0}).eq("user_id",e);if(t)throw t;const{count:o}=r,{data:s}=await n.from("job_notification_logs").select("sent_at").eq("user_id",e).order("sent_at",{ascending:!1}).limit(1).maybeSingle();return{totalNotifications:o||0,lastNotificationDate:(s==null?void 0:s.sent_at)||null}}catch(r){return console.error("Error fetching notification stats:",r),{totalNotifications:0,lastNotificationDate:null}}}async getAvailableDomains(){try{const{data:e,error:r}=await n.from("job_listings").select("domain").eq("is_active",!0);if(r)throw r;return[...new Set((e==null?void 0:e.map(o=>o.domain))||[])].filter(Boolean).sort()}catch(e){return console.error("Error fetching available domains:",e),[]}}}const f=new c;export{f as u};
