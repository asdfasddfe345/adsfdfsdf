import{j as e,A as q,m as b}from"./vendor-motion-_XdJ9pBm.js";import{u as z,r as m}from"./vendor-react-B4msnGgW.js";import{u as G,L as w,i as J,V as N,r as y,s as Q,n as R,C as p,g as T}from"./index-BbSeE-q4.js";import{s as u}from"./sessionBookingService-DouAmnnK.js";import{w as Z}from"./webinarService-DXJAyzaf.js";import{U as ee}from"./user-check-BwtIKeEV.js";import{C as se}from"./calendar-plus-DnXxx5sQ.js";import{H as te}from"./hash-Cu1sPzkK.js";import{C as ae}from"./chevron-right-CPxmRku4.js";import{X as ie}from"./x-circle-ytsTtMRB.js";import"./vendor-pdf-B1igRwBP.js";import"./vendor-supabase-B_87WqdG.js";import"./vendor-forms-BxTF4-4_.js";const D={confirmed:{label:"Confirmed",color:"bg-emerald-500/10 text-emerald-400 border-emerald-500/30",icon:e.jsx(p,{className:"w-3.5 h-3.5"})},completed:{label:"Completed",color:"bg-blue-500/10 text-blue-400 border-blue-500/30",icon:e.jsx(p,{className:"w-3.5 h-3.5"})},cancelled:{label:"Cancelled",color:"bg-red-500/10 text-red-400 border-red-500/30",icon:e.jsx(ie,{className:"w-3.5 h-3.5"})},no_show:{label:"No Show",color:"bg-amber-500/10 text-amber-400 border-amber-500/30",icon:e.jsx(T,{className:"w-3.5 h-3.5"})}},U=s=>new Date(s+"T00:00:00").toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),we=()=>{const s=z(),{user:a,isAuthenticated:t,isLoading:l}=G(),[n,r]=m.useState("sessions"),[c,h]=m.useState([]),[d,g]=m.useState([]),[x,v]=m.useState(!0),[P,C]=m.useState(!0),[F,k]=m.useState(null),[I,S]=m.useState(null);m.useEffect(()=>{if(!l&&!t){s("/session");return}a&&H()},[a,t,l]);const H=async()=>{a&&(_(),M())},_=async()=>{if(a){v(!0);try{const i=await u.getUserBookings(a.id);h(i)}catch(i){console.error("Error loading session bookings:",i)}finally{v(!1)}}},M=async()=>{if(a){C(!0);try{const i=await Z.getUserRegistrations(a.id);g(i)}catch(i){console.error("Error loading webinar registrations:",i)}finally{C(!1)}}},V=async i=>{var W;k(i);const o=c.find(j=>j.id===i);if((await u.cancelBooking(i)).success){if(o&&a)try{await Q.functions.invoke("send-session-cancellation-email",{body:{bookingId:o.id,recipientEmail:a.email,recipientName:a.name,serviceTitle:((W=o.session_services)==null?void 0:W.title)||"Resume Session",bookingDate:U(o.booking_date),slotLabel:u.getSlotLabel(o.time_slot),bookingCode:o.booking_code}})}catch(j){console.error("Failed to send cancellation email:",j)}await _()}k(null),S(null)},f=new Date().toISOString().split("T")[0],X=c.filter(i=>i.status==="confirmed"&&i.booking_date>=f),Y=c.filter(i=>i.status!=="confirmed"||i.booking_date<f),K=d.filter(i=>{var o;return(o=i.webinar)!=null&&o.scheduled_at?new Date(i.webinar.scheduled_at)>=new Date:!1}),O=d.filter(i=>{var o;return(o=i.webinar)!=null&&o.scheduled_at?new Date(i.webinar.scheduled_at)<new Date:!0}),L=c.length,B=d.length;return l?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(w,{className:"w-8 h-8 text-emerald-400 animate-spin"})}):e.jsx("div",{className:"min-h-screen pb-24 md:pl-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 pt-8 sm:pt-12",children:[e.jsxs("button",{onClick:()=>s(-1),className:"flex items-center gap-1.5 text-slate-400 hover:text-white text-sm mb-6 transition-colors",children:[e.jsx(J,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white mb-1",children:"My Bookings"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Your webinar registrations and 1:1 session history"})]}),e.jsxs("div",{className:"flex gap-2 mb-8 bg-slate-800/60 p-1 rounded-xl border border-slate-700/50",children:[e.jsxs("button",{onClick:()=>r("sessions"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium transition-all ${n==="sessions"?"bg-emerald-500/15 text-emerald-400 border border-emerald-500/30 shadow-sm":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/40"}`,children:[e.jsx(ee,{className:"w-4 h-4"}),"1:1 Sessions",L>0&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${n==="sessions"?"bg-emerald-500/20 text-emerald-300":"bg-slate-700 text-slate-400"}`,children:L})]}),e.jsxs("button",{onClick:()=>r("webinars"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium transition-all ${n==="webinars"?"bg-emerald-500/15 text-emerald-400 border border-emerald-500/30 shadow-sm":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/40"}`,children:[e.jsx(N,{className:"w-4 h-4"}),"Webinars",B>0&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${n==="webinars"?"bg-emerald-500/20 text-emerald-300":"bg-slate-700 text-slate-400"}`,children:B})]})]}),e.jsx(q,{mode:"wait",children:n==="sessions"?e.jsx(le,{loading:x,upcoming:X,past:Y,today:f,cancellingId:F,showCancelConfirm:I,onCancel:V,onShowCancelConfirm:S,onNavigate:s},"sessions"):e.jsx(ne,{loading:P,upcoming:K,past:O,onNavigate:s},"webinars")})]})})},le=({loading:s,upcoming:a,past:t,today:l,cancellingId:n,showCancelConfirm:r,onCancel:c,onShowCancelConfirm:h,onNavigate:d})=>{if(s)return e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center py-16",children:e.jsx(w,{className:"w-6 h-6 text-emerald-400 animate-spin"})});const g=a.length===0&&t.length===0;return e.jsx(b.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},transition:{duration:.2},children:g?e.jsx($,{icon:e.jsx(y,{className:"w-12 h-12 text-slate-600"}),title:"No sessions yet",description:"Book a 1-on-1 resume session with our experts",actionLabel:"Book a Session",onAction:()=>d("/session")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>d("/session"),className:"flex items-center gap-1.5 px-4 py-2 rounded-lg bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-sm font-medium hover:bg-emerald-500/20 transition-colors",children:[e.jsx(se,{className:"w-4 h-4"}),"Book New"]})}),a.length>0&&e.jsxs("section",{className:"mb-10",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-400"}),"Upcoming Sessions"]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(x=>e.jsx(A,{booking:x,isUpcoming:!0,today:l,cancellingId:n,showCancelConfirm:r,onCancel:c,onShowCancelConfirm:h},x.id))})]}),t.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-slate-500"}),"Past Sessions"]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:t.map(x=>e.jsx(A,{booking:x,isUpcoming:!1,today:l,cancellingId:n,showCancelConfirm:r,onCancel:c,onShowCancelConfirm:h},x.id))})]})]})})},A=({booking:s,isUpcoming:a,cancellingId:t,showCancelConfirm:l,onCancel:n,onShowCancelConfirm:r})=>{var d;const c=D[s.status]||D.confirmed,h=u.getSlotLabel(s.time_slot);return e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-slate-800/40 border border-slate-700/50 rounded-xl p-5 hover:border-slate-600/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-white font-semibold text-sm line-clamp-1",children:((d=s.session_services)==null?void 0:d.title)||"Resume Session"}),e.jsxs("span",{className:`inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full border ${c.color}`,children:[c.icon,c.label]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(y,{className:"w-4 h-4 text-slate-500"}),U(s.booking_date)]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(R,{className:"w-4 h-4 text-slate-500"}),h]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(te,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"font-mono text-xs",children:s.booking_code})]})]}),a&&e.jsx("div",{className:"mt-4 pt-3 border-t border-slate-700/50",children:l===s.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-amber-400 text-xs",children:"Are you sure you want to cancel?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n(s.id),disabled:t===s.id,className:"flex-1 px-3 py-2 rounded-lg bg-red-500/20 text-red-400 text-xs font-medium hover:bg-red-500/30 disabled:opacity-50 transition-colors",children:t===s.id?"Cancelling...":"Yes, Cancel"}),e.jsx("button",{onClick:()=>r(null),className:"flex-1 px-3 py-2 rounded-lg border border-slate-700 text-slate-300 text-xs font-medium hover:bg-slate-800/60 transition-colors",children:"Keep Booking"})]})]}):e.jsx("button",{onClick:()=>r(s.id),className:"text-xs text-red-400/70 hover:text-red-400 transition-colors",children:"Cancel Booking"})})]})},ne=({loading:s,upcoming:a,past:t,onNavigate:l})=>{if(s)return e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center py-16",children:e.jsx(w,{className:"w-6 h-6 text-emerald-400 animate-spin"})});const n=a.length===0&&t.length===0;return e.jsx(b.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},children:n?e.jsx($,{icon:e.jsx(N,{className:"w-12 h-12 text-slate-600"}),title:"No webinars yet",description:"Register for a webinar to see it here",actionLabel:"Browse Webinars",onAction:()=>l("/webinars")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>l("/webinars"),className:"flex items-center gap-1.5 px-4 py-2 rounded-lg bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-sm font-medium hover:bg-emerald-500/20 transition-colors",children:[e.jsx(N,{className:"w-4 h-4"}),"Browse Webinars"]})}),a.length>0&&e.jsxs("section",{className:"mb-10",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-400"}),"Upcoming Webinars"]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(r=>e.jsx(E,{registration:r,onNavigate:l},r.id))})]}),t.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-slate-500"}),"Past Webinars"]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:t.map(r=>e.jsx(E,{registration:r,onNavigate:l},r.id))})]})]})})},E=({registration:s,onNavigate:a})=>{const t=s.webinar,l=t!=null&&t.scheduled_at?new Date(t.scheduled_at):null,n=s.payment_status==="completed"?"bg-emerald-500/10 text-emerald-400 border-emerald-500/30":s.payment_status==="failed"?"bg-red-500/10 text-red-400 border-red-500/30":"bg-amber-500/10 text-amber-400 border-amber-500/30";return e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},onClick:()=>a(`/webinar-details/${s.id}`),className:"bg-slate-800/40 border border-slate-700/50 rounded-xl overflow-hidden hover:border-slate-600/50 transition-colors cursor-pointer group",children:[(t==null?void 0:t.thumbnail_url)&&e.jsxs("div",{className:"relative h-32 overflow-hidden",children:[e.jsx("img",{src:t.thumbnail_url,alt:t.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/80 to-transparent"})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-white font-semibold text-sm line-clamp-2 flex-1 mr-2",children:(t==null?void 0:t.title)||"Webinar"}),e.jsx(ae,{className:"w-4 h-4 text-slate-500 group-hover:text-emerald-400 transition-colors flex-shrink-0 mt-0.5"})]}),e.jsx("div",{className:"space-y-2 text-sm mb-3",children:l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(y,{className:"w-4 h-4 text-slate-500"}),l.toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short",year:"numeric"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(R,{className:"w-4 h-4 text-slate-500"}),l.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full border ${n}`,children:[s.payment_status==="completed"?e.jsx(p,{className:"w-3 h-3"}):e.jsx(T,{className:"w-3 h-3"}),s.payment_status]}),s.attendance_marked&&e.jsxs("span",{className:"text-xs text-emerald-400 flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"}),"Attended"]})]})]})]})},$=({icon:s,title:a,description:t,actionLabel:l,onAction:n})=>e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"mx-auto mb-4",children:s}),e.jsx("h3",{className:"text-white font-semibold text-lg mb-2",children:a}),e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:t}),e.jsx("button",{onClick:n,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-semibold hover:shadow-lg hover:shadow-emerald-500/25 transition-all",children:l})]});export{we as MyBookingsPage};
