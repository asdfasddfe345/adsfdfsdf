import{s as l}from"./index-BbSeE-q4.js";class u{async getSlotsByDate(n,e){const{data:s}=await l.from("session_services").select("time_slots").eq("id",n).maybeSingle();if(!s)return[];const d=s.time_slots,{data:c}=await l.from("session_slots").select("id, slot_date, time_slot, status, booked_by, booking_id").eq("service_id",n).eq("slot_date",e),i={};(c||[]).forEach(a=>{i[a.time_slot]=a});const t=(c||[]).filter(a=>a.booking_id).map(a=>a.booking_id);let _={};if(t.length>0){const{data:a}=await l.from("session_bookings").select("*").in("id",t);(a||[]).forEach(r=>{_[r.id]=r})}return d.map(a=>{const r=i[a],o=r!=null&&r.booking_id?_[r.booking_id]:null;return{id:(r==null?void 0:r.id)||"",slot_date:e,time_slot:a,status:(r==null?void 0:r.status)||"available",user_name:(o==null?void 0:o.user_name)||null,user_email:(o==null?void 0:o.user_email)||null,user_phone:(o==null?void 0:o.user_phone)||null,booking_code:(o==null?void 0:o.booking_code)||null,booking_status:(o==null?void 0:o.status)||null}})}async toggleSlotBlock(n,e,s,d){const{data:c}=await l.from("session_slots").select("id, status").eq("service_id",n).eq("slot_date",e).eq("time_slot",s).maybeSingle();if(c){if(c.status==="booked")return{success:!1,error:"Cannot block a booked slot."};const{error:i}=await l.from("session_slots").update({status:d?"blocked":"available",updated_at:new Date().toISOString()}).eq("id",c.id);if(i)return{success:!1,error:i.message}}else if(d){const{error:i}=await l.from("session_slots").insert({service_id:n,slot_date:e,time_slot:s,status:"blocked"});if(i)return{success:!1,error:i.message}}return{success:!0}}async getBookingStats(){const{data:n}=await l.from("session_bookings").select("status, session_services(price)"),e=n||[];let s=0,d=0,c=0,i=0;return e.forEach(t=>{var _,a;t.status==="confirmed"&&(d++,s+=(((_=t.session_services)==null?void 0:_.price)||0)/100),t.status==="completed"&&(c++,s+=(((a=t.session_services)==null?void 0:a.price)||0)/100),t.status==="cancelled"&&i++}),{total_bookings:e.length,confirmed:d,completed:c,cancelled:i,total_revenue:s}}async getServiceForEditing(n){const{data:e,error:s}=await l.from("session_services").select("*").eq("id",n).maybeSingle();return s||!e?null:{id:e.id,title:e.title,description:e.description,price:e.price,currency:e.currency,highlights:e.highlights,bonus_credits:e.bonus_credits,max_slots_per_day:e.max_slots_per_day,time_slots:e.time_slots,is_active:e.is_active,created_at:e.created_at,updated_at:e.updated_at}}async updateService(n,e){const{error:s}=await l.from("session_services").update({...e,updated_at:new Date().toISOString()}).eq("id",n);return s?{success:!1,error:s.message}:{success:!0}}async exportBookingsCSV(n,e){const{data:s}=await l.from("session_bookings").select("*").gte("booking_date",n).lte("booking_date",e).order("booking_date",{ascending:!0}),d=s||[],i=[["Booking Code","Date","Time Slot","Name","Email","Phone","Status"].join(",")];return d.forEach(t=>{i.push([t.booking_code,t.booking_date,t.time_slot,`"${t.user_name}"`,t.user_email,t.user_phone||"",t.status].join(","))}),i.join(`
`)}}const f=new u;export{f as a};
