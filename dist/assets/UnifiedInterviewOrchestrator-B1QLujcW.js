var $t=Object.defineProperty;var zt=(l,t,r)=>t in l?$t(l,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[t]=r;var Ze=(l,t,r)=>zt(l,typeof t!="symbol"?t+"":t,r);import{j as e}from"./vendor-motion-_XdJ9pBm.js";import{r as a,u as Pt}from"./vendor-react-B4msnGgW.js";import{c as Ot,u as nt,i as Lt,L as _e,a as Ce,F as Ut,C as Se,S as Vt,s as O,n as ke,b as Yt,y as ae,R as et,X as Wt,g as Bt,V as Ht}from"./index-BbSeE-q4.js";import{I as Jt,R as Gt,C as Kt,D as Xt}from"./DurationConfigScreen-BsbmgIDc.js";import{a as tt}from"./resumeAnalysisService-CK8PLPdm.js";import{U as Zt}from"./upload-CurydzNZ.js";import{g as ve}from"./geminiServiceWrapper-tvm4MzT7.js";import{c as je}from"./codeCompilerService-Fc1MZoaD.js";import{M as Re,u as es,a as ts,s as z,t as P,b as T,S as ss,V as st,c as rs,d as ns,I as as}from"./InterviewSummaryReport-DvnPzzAF.js";import{C as is}from"./check-BiYzalIN.js";import{C as os}from"./copy-Cl8vstA9.js";import{M as ls}from"./maximize-2-jpotZCLP.js";import{X as cs}from"./x-circle-ytsTtMRB.js";import{C as ds}from"./chevron-up-n5SsRS4Y.js";import{Z as us}from"./zap-BGmE2sY4.js";import{C as qe}from"./code-GxPtUTRK.js";import{P as ms}from"./play-BW95sg1B.js";import"./vendor-pdf-B1igRwBP.js";import"./vendor-supabase-B_87WqdG.js";import"./vendor-forms-BxTF4-4_.js";import"./building-2-B7dH_DvY.js";import"./cloud-DgR56UEK.js";import"./database-BUKIZYYv.js";import"./chevron-right-CPxmRku4.js";import"./index-4HxsnF8w.js";import"./edenAITextService-y6w1oEiu.js";import"./aiProxyService-HwcJnoDm.js";import"./pause-C7_k2ztz.js";import"./trophy-D8agcnr9.js";import"./lightbulb-ZFvDqHVp.js";import"./rotate-ccw-BQdMKeUh.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=Ot("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),ps=({interviewType:l,selectedRole:t,selectedCompany:r,onResumeUploaded:s,onBack:o})=>{const{user:c}=nt(),[i,u]=a.useState(null),[d,y]=a.useState(!1),[h,b]=a.useState(null),[p,m]=a.useState(null),[g,w]=a.useState(!1),N=R=>{var _;const j=(_=R.target.files)==null?void 0:_[0];if(!j)return;if(j.size>5242880){b("File size must be less than 5MB");return}if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(j.type)){b("Only PDF and DOCX files are allowed");return}u(j),b(null),M(j)},M=async R=>{if(c){y(!0),w(!0),b(null);try{const j=await tt.uploadAndAnalyzeResume(R,c.id);m(j);const E=await tt.waitForAnalysis(j.id,20);m(E),w(!1),setTimeout(()=>{s(E)},1500)}catch(j){console.error("Resume upload error:",j),b(j.message||"Failed to upload and analyze resume"),w(!1)}finally{y(!1)}}},C=()=>p?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl p-6 border-2 border-blue-500 dark:border-blue-400",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ut,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-gray-900 dark:text-gray-100 text-lg mb-2",children:p.file_name}),g?e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300",children:[e.jsx(_e,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Analyzing your resume with AI..."})]}):e.jsxs("div",{className:"flex items-center gap-2 text-green-700 dark:text-green-300",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Analysis Complete!"})]})]})]})}),p.analysis_completed&&e.jsxs("div",{className:"bg-white dark:bg-dark-200 rounded-xl p-6 border border-gray-200 dark:border-dark-300",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-gray-100 mb-4 flex items-center gap-2",children:[e.jsx(Vt,{className:"w-5 h-5 text-yellow-500"}),"Resume Analysis Results"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Experience Level"}),e.jsx("p",{className:"font-bold text-gray-900 dark:text-gray-100 text-lg capitalize",children:p.experience_level||"Not Detected"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/30 dark:to-purple-800/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Skills Detected"}),e.jsx("p",{className:"font-bold text-gray-900 dark:text-gray-100 text-lg",children:p.skills_detected.length})]})]}),p.skills_detected.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Key Skills Found:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.skills_detected.slice(0,12).map((R,j)=>e.jsx("span",{className:"px-3 py-1 bg-gradient-to-r from-blue-100 to-purple-100 dark:from-blue-900/30 dark:to-purple-900/30 text-blue-700 dark:text-blue-300 rounded-full text-sm font-medium",children:R},j))})]}),e.jsx("div",{className:"mt-6 bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[e.jsx(Se,{className:"w-4 h-4 inline mr-2"}),"Your interview questions will be personalized based on these skills and your experience level."]})})]})]}):null;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-dark-100 dark:via-dark-50 dark:to-dark-100",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[e.jsxs("button",{onClick:o,className:"flex items-center gap-2 text-secondary-600 hover:text-secondary-900 dark:text-gray-400 dark:hover:text-gray-200 mb-8 transition-colors",children:[e.jsx(Lt,{className:"w-5 h-5"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-secondary-900 dark:text-gray-100 mb-4",children:"Upload Your Resume"}),e.jsx("p",{className:"text-lg text-secondary-600 dark:text-gray-400 mb-2",children:l==="company-based"&&r?`Preparing for ${r} - ${t}`:`Preparing for ${t}`}),e.jsx("p",{className:"text-sm text-secondary-500 dark:text-gray-500",children:"We'll analyze your resume to create personalized interview questions"})]}),p?C():e.jsxs("div",{className:"bg-white dark:bg-dark-200 rounded-xl shadow-lg p-8 border border-gray-200 dark:border-dark-300",children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-12 hover:border-blue-500 dark:hover:border-blue-400 transition-colors",children:e.jsxs("label",{className:"cursor-pointer block",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Zt,{className:"w-20 h-20 mx-auto mb-6 text-gray-400 dark:text-gray-500"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:i?i.name:"Click to upload your resume"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Supported formats: PDF, DOCX (max 5MB)"}),d&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-600 dark:text-blue-400",children:[e.jsx(_e,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Uploading and analyzing..."})]})]}),e.jsx("input",{type:"file",accept:".pdf,.docx,.doc",onChange:N,className:"hidden",disabled:d})]})}),h&&e.jsx("div",{className:"mt-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:h})]})}),e.jsxs("div",{className:"mt-6 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-700",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Why do we need your resume?"}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[e.jsx("li",{children:"Generate questions based on your actual experience and skills"}),e.jsx("li",{children:"Ask about specific projects mentioned in your resume"}),e.jsx("li",{children:"Tailor difficulty level to match your experience"}),e.jsx("li",{children:"Create realistic follow-up questions based on your background"}),e.jsx("li",{children:"Provide personalized feedback relevant to your career level"})]})]})]})]})})};class hs{async generateInterviewQuestions(t,r){const s=[];let o=1;if(s.push(this.createIntroductionQuestion(o++)),r.projects_list&&r.projects_list.length>0){const i=await this.generateProjectQuestions(r,o,t);s.push(...i),o+=i.length}const c=await this.generateTechnicalQuestions(t,r,o);if(s.push(...c),o+=c.length,t.interviewCategory==="mixed"||t.interviewCategory==="hr"){const i=await this.generateHRQuestions(t,r,o);s.push(...i)}return s}createIntroductionQuestion(t){return{id:`intro-${Date.now()}`,question_number:t,question_type:"introduction",question_text:"Please introduce yourself. Tell me about your background, current role, and what you're looking for in your next opportunity.",requires_coding:!1,difficulty_level:"easy",expected_duration_minutes:3,related_skills:[],context:{is_introduction:!0,listen_for:["background","experience","goals","motivation"]}}}async generateProjectQuestions(t,r,s){const o=[],c=t.projects_list||[],i=Math.min(2,c.length);for(let u=0;u<i;u++){const d=c[u],y={id:`project-${u}-${Date.now()}`,question_number:r+u*2,question_type:"project",question_text:`I see you worked on "${d.title||d.name||`Project ${u+1}`}". Can you walk me through this project? What problem were you solving, and what was your role?`,requires_coding:!1,difficulty_level:"medium",expected_duration_minutes:4,related_skills:d.technologies||[],related_project:d.title||d.name,context:{project_details:d,expect_topics:["problem_statement","role","technologies","challenges","outcomes"]}};o.push(y);const h={id:`project-tech-${u}-${Date.now()}`,question_number:r+u*2+1,question_type:"project",question_text:"What were the biggest technical challenges you faced in this project, and how did you overcome them?",requires_coding:!1,difficulty_level:"medium",expected_duration_minutes:3,related_skills:d.technologies||[],related_project:d.title||d.name,context:{project_details:d,expect_topics:["challenges","problem_solving","technical_decisions"]}};o.push(h)}return o}async generateTechnicalQuestions(t,r,s){const o=[],i=(r.skills_detected||[]).slice(0,5);if(i.length===0)return[];const u=`Generate 3-4 realistic technical interview questions for a ${t.targetRole} position${t.companyName?` at ${t.companyName}`:""}.

Resume Skills: ${i.join(", ")}
Experience Level: ${r.experience_level||"Mid-level"}
Interview Category: ${t.interviewCategory}

Requirements:
1. First question should be a conceptual/theoretical question about their main skill
2. Second question should be a coding problem (medium difficulty)
3. Third question should be about system design or architecture
4. Questions should feel natural and conversational, not robotic

Return ONLY a valid JSON array with this exact structure:
[
  {
    "question_text": "the question",
    "question_type": "technical" or "coding",
    "requires_coding": true/false,
    "programming_language": "Python" (if coding required),
    "difficulty_level": "easy/medium/hard",
    "expected_duration_minutes": 3-5,
    "related_skills": ["skill1", "skill2"]
  }
]`;try{const y=(await ve.chat([{role:"user",content:u}])).match(/\[[\s\S]*\]/);if(!y)throw new Error("No JSON array found in response");JSON.parse(y[0]).forEach((b,p)=>{o.push({id:`tech-${p}-${Date.now()}`,question_number:s+p,question_type:b.requires_coding?"coding":"technical",question_text:b.question_text,requires_coding:b.requires_coding||!1,programming_language:b.programming_language,difficulty_level:b.difficulty_level||"medium",expected_duration_minutes:b.expected_duration_minutes||4,related_skills:b.related_skills||i.slice(0,2),context:{generated_for_skills:i,company:t.companyName}})})}catch(d){console.error("Error generating technical questions:",d)}return o}async generateHRQuestions(t,r,s){return[{id:`hr-1-${Date.now()}`,question_number:s,question_type:"behavioral",question_text:"Tell me about a time when you had to work under tight deadlines. How did you manage your time and priorities?",requires_coding:!1,difficulty_level:"medium",expected_duration_minutes:3,related_skills:["time management","prioritization"],context:{behavioral_type:"time_management",star_expected:!0}},{id:`hr-2-${Date.now()}`,question_number:s+1,question_type:"hr",question_text:t.companyName?`Why do you want to work at ${t.companyName}? What do you know about our company culture?`:"What are you looking for in your next role? What kind of work environment helps you thrive?",requires_coding:!1,difficulty_level:"easy",expected_duration_minutes:2,related_skills:["communication","cultural fit"],context:{company_specific:!!t.companyName}}]}async analyzeAnswerAndGenerateFollowUp(t,r,s){if(!r.answer_text||r.answer_text.length<50)return{question_text:"Can you elaborate more on that? I'd like to understand your thought process better.",reason:"incomplete_answer",context:{original_question:t.question_text}};if(t.question_type==="project"){const o=`Analyze this interview response and determine if a follow-up question is needed.

Original Question: ${t.question_text}
Candidate's Answer: ${r.answer_text}
Project: ${t.related_project}
Skills: ${t.related_skills.join(", ")}

Does the answer:
1. Explain the technical approach clearly?
2. Mention specific technologies used?
3. Discuss challenges or results?

If the answer is vague or misses key technical details, generate ONE specific follow-up question that digs deeper into the technical implementation.

Return ONLY valid JSON:
{
  "needs_followup": true/false,
  "follow_up_question": "the question" (if needed),
  "reason": "why followup is needed"
}`;try{const i=(await ve.chat([{role:"user",content:o}])).match(/\{[\s\S]*\}/);if(!i)return null;const u=JSON.parse(i[0]);if(u.needs_followup&&u.follow_up_question)return{question_text:u.follow_up_question,reason:u.reason||"clarification_needed",context:{original_question:t.question_text,original_answer:r.answer_text}}}catch(c){console.error("Error analyzing answer:",c)}}return t.question_type==="coding"&&r.code_answer?{question_text:"Can you explain your code line by line? Walk me through your logic and any optimizations you made.",reason:"code_explanation",context:{code:r.code_answer,language:r.programming_language}}:null}async generateCodeReviewQuestions(t,r,s){const o=`You are an experienced technical interviewer reviewing code during a live interview.

Problem: ${s}
Language: ${r}
Code:
\`\`\`${r}
${t}
\`\`\`

Generate 2-3 specific, realistic questions an interviewer would ask about this code:
1. Ask about a specific line or section and its purpose
2. Ask about potential edge cases or optimization
3. Ask why they chose a particular approach

Make questions conversational and natural. Return ONLY a JSON array of strings.`;try{const i=(await ve.chat([{role:"user",content:o}])).match(/\[[\s\S]*\]/);return i?JSON.parse(i[0]):["Can you explain your approach to solving this problem?","What edge cases did you consider?","How would you optimize this solution?"]}catch(c){return console.error("Error generating code review questions:",c),["Walk me through your solution step by step.","What's the time and space complexity?","How would you handle invalid inputs?"]}}async createInterviewSession(t,r,s){try{console.log("Creating realistic interview session for user:",t);const o={user_id:t,session_type:r.sessionType,interview_category:r.interviewCategory,company_name:r.companyName,target_role:r.targetRole,duration_minutes:r.durationMinutes,resume_id:s,status:"in_progress",started_at:new Date().toISOString()},{data:c,error:i}=await O.from("realistic_interview_sessions").insert(o).select().single();if(i)throw console.error("Error creating interview session:",i),new Error(`Failed to create interview session: ${i.message}`);if(!c||!c.id)throw console.error("Session created but no ID returned:",c),new Error("Session was created but no ID was returned");return console.log("Interview session created successfully with ID:",c.id),localStorage.setItem(`interview_session_${c.id}`,JSON.stringify({sessionId:c.id,userId:t,config:r,createdAt:Date.now()})),c.id}catch(o){throw console.error("Failed to create interview session:",o),o}}async saveQuestionResponse(t,r,s){if(!t)throw console.error("Cannot save response: sessionId is null or undefined"),new Error("Session ID is required to save response");try{console.log("Saving response for session:",t,"question:",r.question_number);const{error:o}=await O.from("realistic_interview_responses").insert({session_id:t,question_number:r.question_number,question_type:r.question_type,question_text:r.question_text,answer_text:s.answer_text,code_answer:s.code_answer,programming_language:s.programming_language,time_spent_seconds:s.time_spent_seconds,quality_score:s.quality_score});if(o)throw console.error("Error saving question response:",o),new Error(`Failed to save response: ${o.message}`);console.log("Response saved successfully")}catch(o){throw console.error("Failed to save question response:",o),o}}async saveFollowUpResponse(t,r,s,o,c){if(!t)throw console.error("Cannot save follow-up: sessionId is null or undefined"),new Error("Session ID is required to save follow-up response");try{console.log("Saving follow-up response for session:",t);const{error:i}=await O.from("realistic_interview_followups").insert({session_id:t,parent_question_number:r,follow_up_question:s,answer:o,time_spent_seconds:c});if(i)throw console.error("Error saving follow-up response:",i),new Error(`Failed to save follow-up: ${i.message}`);console.log("Follow-up response saved successfully")}catch(i){throw console.error("Failed to save follow-up response:",i),i}}async completeSession(t,r){if(!t)throw console.error("Cannot complete session: sessionId is null or undefined"),new Error("Session ID is required to complete session");try{console.log("Completing interview session:",t);const{error:s}=await O.from("realistic_interview_sessions").update({status:"completed",completed_at:new Date().toISOString(),actual_duration_seconds:r}).eq("id",t);if(s)throw console.error("Error completing session:",s),new Error(`Failed to complete session: ${s.message}`);console.log("Session completed successfully"),localStorage.removeItem(`interview_session_${t}`)}catch(s){throw console.error("Failed to complete session:",s),s}}}const A=new hs,gs=({value:l,onChange:t,language:r,placeholder:s="Write your code here...",height:o="400px"})=>{const[c,i]=a.useState(!1),[u,d]=a.useState(!1),y=async()=>{await navigator.clipboard.writeText(l),d(!0),setTimeout(()=>d(!1),2e3)},h=m=>{if(m.key==="Tab"){m.preventDefault();const g=m.target,w=g.selectionStart,N=g.selectionEnd,M=l.substring(0,w)+"  "+l.substring(N);t(M),setTimeout(()=>{g.selectionStart=g.selectionEnd=w+2},0)}},b=l.split(`
`).length,p=Array.from({length:Math.max(b,20)},(m,g)=>g+1);return e.jsxs("div",{className:`${c?"fixed inset-0 z-50 bg-dark-100 p-6":"relative"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:["Code Editor - ",r]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:y,className:"p-2 bg-dark-300 hover:bg-dark-400 text-gray-400 hover:text-gray-200 rounded transition-colors",title:"Copy code",children:u?e.jsx(is,{className:"w-4 h-4 text-green-500"}):e.jsx(os,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i(!c),className:"p-2 bg-dark-300 hover:bg-dark-400 text-gray-400 hover:text-gray-200 rounded transition-colors",title:c?"Exit fullscreen":"Enter fullscreen",children:c?e.jsx(xs,{className:"w-4 h-4"}):e.jsx(ls,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"bg-dark-400 rounded-lg border border-gray-700 overflow-hidden flex",children:[e.jsx("div",{className:"bg-dark-500 px-3 py-4 text-right select-none",children:p.map(m=>e.jsx("div",{className:"text-gray-500 text-sm font-mono leading-6",style:{height:"24px"},children:m},m))}),e.jsx("textarea",{value:l,onChange:m=>t(m.target.value),onKeyDown:h,className:"flex-1 px-4 py-4 bg-dark-400 text-green-400 font-mono text-sm leading-6 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none overflow-auto",placeholder:s,style:{height:c?"calc(100vh - 120px)":o},spellCheck:!1})]}),c&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>i(!1),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Exit Fullscreen"})})]})},fs=({testCases:l,executionResults:t,isExecuting:r})=>{const[s,o]=a.useState(new Set([0])),c=m=>{const g=new Set(s);g.has(m)?g.delete(m):g.add(m),o(g)},i=()=>{o(new Set(l.map((m,g)=>g)))},u=()=>{o(new Set)};if(l.length===0)return null;const d=m=>`${m.input}__${m.expectedOutput}`,y=new Map;for(const m of t)y.set(d(m.testCase),m);const b=l.map(m=>y.get(d(m))).filter(Boolean).filter(m=>m.passed).length,p=l.length;return e.jsxs("div",{className:"bg-dark-300 rounded-lg border border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"bg-dark-400 px-4 py-3 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-blue-400"}),e.jsxs("h3",{className:"font-semibold text-gray-100",children:["Test Cases ",p>0&&`(${b}/${p} passed)`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-400 text-sm",children:[e.jsx(ke,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Running tests..."})]}),s.size>0?e.jsx("button",{onClick:u,className:"text-xs text-blue-400 hover:text-blue-300 transition-colors",children:"Collapse All"}):e.jsx("button",{onClick:i,className:"text-xs text-blue-400 hover:text-blue-300 transition-colors",children:"Expand All"})]})]}),e.jsx("div",{className:"divide-y divide-gray-700",children:l.map((m,g)=>{const w=y.get(d(m)),N=s.has(g);return e.jsxs("div",{className:"bg-dark-300",children:[e.jsxs("button",{onClick:()=>c(g),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-dark-400 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[w?w.passed?e.jsx(Se,{className:"w-5 h-5 text-green-500"}):e.jsx(cs,{className:"w-5 h-5 text-red-500"}):e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-gray-600"}),e.jsxs("span",{className:"font-medium text-gray-200",children:["Test Case ",g+1]}),w&&e.jsx("span",{className:`text-xs px-2 py-1 rounded ${w.passed?"bg-green-900/30 text-green-400":"bg-red-900/30 text-red-400"}`,children:w.passed?"Passed":"Failed"})]}),N?e.jsx(ds,{className:"w-5 h-5 text-gray-400"}):e.jsx(Yt,{className:"w-5 h-5 text-gray-400"})]}),N&&e.jsxs("div",{className:"px-4 pb-4 space-y-3 bg-dark-400",children:[e.jsxs("div",{className:"bg-dark-500 rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1 font-semibold",children:"Input:"}),e.jsx("pre",{className:"text-sm text-gray-300 font-mono whitespace-pre-wrap break-words",children:m.input})]}),e.jsxs("div",{className:"bg-dark-500 rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1 font-semibold",children:"Expected Output:"}),e.jsx("pre",{className:"text-sm text-gray-300 font-mono whitespace-pre-wrap break-words",children:m.expectedOutput})]}),w&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded p-3 ${w.passed?"bg-green-900/20":"bg-red-900/20"}`,children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1 font-semibold",children:"Your Output:"}),e.jsx("pre",{className:"text-sm text-gray-300 font-mono whitespace-pre-wrap break-words",children:w.actualOutput})]}),w.error&&e.jsxs("div",{className:"bg-red-900/20 rounded p-3 border border-red-700",children:[e.jsx("div",{className:"text-xs text-red-400 mb-1 font-semibold",children:"Error:"}),e.jsx("pre",{className:"text-sm text-red-300 font-mono whitespace-pre-wrap break-words",children:w.error})]}),w.executionTime&&e.jsx("div",{className:"flex items-center gap-4 text-xs text-gray-400",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"}),e.jsxs("span",{children:["Execution: ",w.executionTime,"ms"]})]})})]})]})]},g)})})]})},ws=({isSpeaking:l,isListening:t,silenceCountdown:r=0})=>e.jsx("div",{className:"space-y-4",children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center gap-4 py-4",children:l?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-full flex items-center justify-center animate-pulse",children:e.jsx(Re,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"absolute inset-0 w-12 h-12 bg-green-500 rounded-full animate-ping opacity-75"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-green-400 text-lg font-semibold",children:"Speaking Detected"}),e.jsx("span",{className:"text-gray-400 text-sm",children:"Your voice is being recorded"})]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-600 rounded-full flex items-center justify-center",children:e.jsx(Re,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-400 text-lg font-semibold",children:"Listening..."}),e.jsx("span",{className:"text-gray-500 text-sm",children:"Start speaking to begin"})]})]})}),e.jsx("div",{className:"flex items-center justify-center gap-1",children:[...Array(5)].map((s,o)=>e.jsx("div",{className:`w-1 rounded-full transition-all duration-150 ${l?"bg-green-500 h-8 animate-pulse":"bg-gray-600 h-4"}`,style:{animationDelay:`${o*100}ms`,height:l?`${Math.random()*20+16}px`:"16px"}},o))}),r>0&&r<=5&&e.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-yellow-400 font-semibold",children:["Auto-submitting in ",r,"s"]}),e.jsx("span",{className:"text-yellow-300 text-2xl font-bold font-mono",children:r})]}),e.jsx("div",{className:"w-full bg-dark-400 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-orange-500 h-full transition-all duration-1000 ease-linear",style:{width:`${r/5*100}%`}})}),e.jsx("p",{className:"text-gray-400 text-xs mt-2",children:"Continue speaking to prevent auto-submission"})]})]})}),rt=({transcript:l,isListening:t,placeholder:r="Start speaking..."})=>{const s=a.useRef(null);return a.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[l]),e.jsxs("div",{className:"bg-dark-300 rounded-lg border border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"bg-dark-400 px-4 py-3 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-400"}),e.jsx("h3",{className:"font-semibold text-gray-100",children:"Your Response"})]}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-red-400 text-sm font-medium",children:"Recording"})]})]}),e.jsx("div",{ref:s,className:"p-4 min-h-[120px] max-h-[240px] overflow-y-auto scroll-smooth",children:l?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-gray-200 text-base leading-relaxed whitespace-pre-wrap",children:l}),t&&e.jsx("span",{className:"inline-block w-2 h-5 bg-blue-400 animate-pulse ml-1"})]}):e.jsx("div",{className:"flex items-center justify-center h-[104px]",children:e.jsx("p",{className:"text-gray-500 text-sm italic",children:r})})}),l&&e.jsx("div",{className:"bg-dark-400 px-4 py-2 border-t border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[e.jsxs("span",{children:["Word count: ",l.trim().split(/\s+/).length]}),e.jsxs("span",{children:["Characters: ",l.length]})]})})]})},bs=({questionNumber:l,totalQuestions:t,questionText:r,questionType:s,difficulty:o,requiresCoding:c,relatedSkills:i=[],expectedDuration:u})=>{const d=h=>{switch(h.toLowerCase()){case"easy":return"bg-green-600 text-white";case"medium":return"bg-yellow-600 text-white";case"hard":return"bg-red-600 text-white";default:return"bg-blue-600 text-white"}},y=()=>c?e.jsx(qe,{className:"w-4 h-4"}):e.jsx(ae,{className:"w-4 h-4"});return e.jsxs("div",{className:"bg-dark-200 rounded-xl border border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-white text-2xl font-bold",children:["Question ",l," of ",t]}),e.jsx("p",{className:"text-blue-100 text-sm mt-1",children:s.replace(/_/g," ").replace(/\b\w/g,h=>h.toUpperCase())})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 bg-white/20 px-3 py-2 rounded-lg",children:[e.jsx(ke,{className:"w-4 h-4 text-white"}),e.jsxs("span",{className:"text-white font-semibold",children:[u," min"]})]})]})}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[e.jsxs("span",{className:`px-3 py-1.5 rounded-full text-xs font-semibold flex items-center gap-1.5 ${d(o)}`,children:[e.jsx(us,{className:"w-3.5 h-3.5"}),o.toUpperCase()]}),c&&e.jsxs("span",{className:"px-3 py-1.5 rounded-full text-xs font-semibold flex items-center gap-1.5 bg-purple-600 text-white",children:[y(),"CODING"]}),i.slice(0,3).map((h,b)=>e.jsx("span",{className:"px-3 py-1.5 bg-gray-700 text-gray-200 rounded-full text-xs font-medium",children:h},b)),i.length>3&&e.jsxs("span",{className:"px-3 py-1.5 bg-gray-700 text-gray-400 rounded-full text-xs font-medium",children:["+",i.length-3," more"]})]})}),e.jsx("div",{className:"px-6 py-6",children:e.jsx("p",{className:"text-gray-100 text-lg leading-relaxed font-medium",children:r})})]})},ys=({sessionData:l,onRecover:t,onStartNew:r})=>{const s=o=>{const c=Math.floor(o/60),i=o%60;return`${c}:${i.toString().padStart(2,"0")}`};return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-dark-200 rounded-2xl p-8 max-w-md w-full border-2 border-blue-500 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(et,{className:"w-8 h-8 text-blue-400"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-100",children:"Resume Interview?"})]}),e.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-blue-400 mt-0.5"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"We found a previous interview session that was interrupted. You can resume from where you left off."})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsx("span",{children:"Progress:"}),e.jsxs("span",{className:"text-gray-200 font-semibold",children:["Question ",l.questionIndex+1," of ",l.totalQuestions]})]}),e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsx("span",{children:"Time Remaining:"}),e.jsx("span",{className:"text-gray-200 font-semibold",children:s(l.timeRemaining)})]}),e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsx("span",{children:"Last Saved:"}),e.jsx("span",{className:"text-gray-200 font-semibold",children:l.lastSaved})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:t,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(et,{className:"w-5 h-5"}),"Resume Interview"]}),e.jsxs("button",{onClick:r,className:"w-full bg-gray-700 hover:bg-gray-600 text-gray-200 font-semibold py-3 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(Wt,{className:"w-5 h-5"}),"Start New Session"]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"Starting a new session will discard your previous progress"})]})})},Ne="interview_session_state",vs=3e4;class js{constructor(){Ze(this,"autoSaveTimer",null)}async saveSessionState(t){try{localStorage.setItem(Ne,JSON.stringify({...t,lastSaved:new Date().toISOString()}));const{error:r}=await O.from("interview_session_backups").upsert({session_id:t.sessionId,user_id:t.userId,current_question_index:t.currentQuestionIndex,total_questions:t.totalQuestions,time_remaining:t.timeRemaining,current_transcript:t.currentTranscript,text_answer:t.textAnswer,code_answer:t.codeAnswer,selected_language:t.selectedLanguage,questions_answered:t.questionsAnswered,questions_skipped:t.questionsSkipped,interview_type:t.interviewType,last_saved:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"session_id"});r&&console.error("Error saving session to database:",r)}catch(r){console.error("Error saving session state:",r)}}async loadSessionState(t){try{const r=localStorage.getItem(Ne);if(r){const c=JSON.parse(r);if(c.sessionId===t)return c}const{data:s,error:o}=await O.from("interview_session_backups").select("*").eq("session_id",t).single();return o||!s?null:{sessionId:s.session_id,userId:s.user_id,currentQuestionIndex:s.current_question_index,totalQuestions:s.total_questions,timeRemaining:s.time_remaining,currentTranscript:s.current_transcript||"",textAnswer:s.text_answer||"",codeAnswer:s.code_answer||"",selectedLanguage:s.selected_language||"Python",questionsAnswered:s.questions_answered||0,questionsSkipped:s.questions_skipped||0,lastSaved:s.last_saved,interviewType:s.interview_type}}catch(r){return console.error("Error loading session state:",r),null}}async clearSessionState(t){try{localStorage.removeItem(Ne),await O.from("interview_session_backups").delete().eq("session_id",t)}catch(r){console.error("Error clearing session state:",r)}}startAutoSave(t){this.stopAutoSave(),this.autoSaveTimer=setInterval(()=>{const r=t();this.saveSessionState(r)},vs)}stopAutoSave(){this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null)}async checkForRecoverableSession(t,r){try{const{data:s,error:o}=await O.from("interview_session_backups").select("*").eq("user_id",t).eq("interview_type",r).order("last_saved",{ascending:!1}).limit(1).single();if(o||!s)return null;const c=new Date(s.last_saved);return(new Date().getTime()-c.getTime())/(1e3*60*60)>24?(await this.clearSessionState(s.session_id),null):{sessionId:s.session_id,userId:s.user_id,currentQuestionIndex:s.current_question_index,totalQuestions:s.total_questions,timeRemaining:s.time_remaining,currentTranscript:s.current_transcript||"",textAnswer:s.text_answer||"",codeAnswer:s.code_answer||"",selectedLanguage:s.selected_language||"Python",questionsAnswered:s.questions_answered||0,questionsSkipped:s.questions_skipped||0,lastSaved:s.last_saved,interviewType:s.interview_type}}catch(s){return console.error("Error checking for recoverable session:",s),null}}}const J=new js,Ns=({config:l,resume:t,userId:r,userName:s,onInterviewComplete:o,onBack:c})=>{const[i,u]=a.useState("loading"),[d,y]=a.useState(null),[h,b]=a.useState([]),[p,m]=a.useState(0),[g,w]=a.useState(0),[N,M]=a.useState(!1),[C,R]=a.useState(""),[j,E]=a.useState(""),[_,D]=a.useState(""),[v,G]=a.useState("Python"),[at,ie]=a.useState(!1),[oe,Ie]=a.useState(!1),[le,Te]=a.useState(!1),[Ae,Ee]=a.useState(""),[it,K]=a.useState(!1),[ot,ce]=a.useState(""),[De,Fe]=a.useState(0),[lt,ct]=a.useState(0),[dt,Qe]=a.useState(!1),[de,Me]=a.useState(!1),[ut,$e]=a.useState(!1),[mt,xt]=a.useState(!0),[pt,ue]=a.useState(!1),[S,ht]=a.useState(null),[gt,ze]=a.useState(!1),[ft,Pe]=a.useState(!1),[X,Oe]=a.useState(null),[Z,Le]=a.useState(""),[ee,wt]=a.useState([]),[bt,yt]=a.useState([]),[_s,vt]=a.useState(!1),[me,Ue]=a.useState(!1),[jt,Ve]=a.useState(!1),[B,Ye]=a.useState([]),[U,xe]=a.useState(0),[te,pe]=a.useState(""),F=a.useRef(null),We=a.useRef([]),I=a.useRef(null),k=a.useRef(null),se=a.useRef(0),L=a.useRef(null),q=a.useRef(null),he=a.useRef(!1),V=a.useRef(!1),Q=a.useRef(null),Y=a.useRef(null),Nt=a.useRef(Date.now()),W=es({onFullScreenExit:()=>{ce("⚠️ You exited full-screen mode. Please return to full-screen to continue."),K(!0),Fe(n=>n+1),re()},onViolation:n=>{console.log("Full-screen violation:",n)}}),_t=ts({onTabSwitch:()=>{ce("⚠️ You switched tabs. Please stay on this page during the interview."),K(!0),Fe(n=>n+1),re()},onWindowBlur:()=>{ce("⚠️ You switched to another application. Please stay focused on the interview."),K(!0),re()},onViolation:(n,x)=>{console.log(`Violation: ${n}, Duration: ${x}s`)}}),f=h[p];a.useEffect(()=>(St(),()=>{Ge()}),[]),a.useEffect(()=>{if(d&&i!=="loading"&&i!=="ready"){const n=()=>({sessionId:d,userId:r,currentQuestionIndex:p,totalQuestions:h.length,timeRemaining:g,currentTranscript:C,textAnswer:j,codeAnswer:_,selectedLanguage:v,questionsAnswered:p,questionsSkipped:0,lastSaved:new Date().toISOString(),interviewType:"realistic"});return J.startAutoSave(n),()=>{J.stopAutoSave()}}},[d,i,p,g,C,j,_]),a.useEffect(()=>(i==="listening"&&!N&&!(f!=null&&f.requires_coding)?q.current=setInterval(()=>{if(z.isInitialized()){const n=z.getCurrentSilenceDuration();n>0&&Qe(!1);const x=Math.max(0,5-n);ct(x),x===0&&!he.current&&(he.current=!0,Ct())}},100):q.current&&(clearInterval(q.current),q.current=null),()=>{q.current&&clearInterval(q.current)}),[i,N,f]),a.useEffect(()=>{(async()=>{if(k.current&&I.current){k.current.srcObject!==I.current&&(k.current.srcObject=I.current);try{k.current.readyState>=2?await k.current.play():(await new Promise(x=>{if(!k.current)return x();k.current.onloadedmetadata=()=>x()}),k.current&&await k.current.play())}catch(x){console.error("Error ensuring video playback:",x)}}})()},[i]),a.useEffect(()=>(!N&&i==="listening"?L.current=setInterval(()=>{w(n=>n<=1?(be(),0):n-1)},1e3):L.current&&clearInterval(L.current),()=>{L.current&&clearInterval(L.current)}),[N,i]);const St=async()=>{const n=await J.checkForRecoverableSession(r,"realistic");n?(ht(n),ue(!0)):ge()},kt=async()=>{if(S)try{ue(!1),u("loading");const n=await A.generateInterviewQuestions(l,t);b(n),y(S.sessionId),m(S.currentQuestionIndex),w(S.timeRemaining),R(S.currentTranscript),E(S.textAnswer),D(S.codeAnswer),G(S.selectedLanguage),await Be(),u("question"),setTimeout(()=>fe(),1e3)}catch(n){console.error("Error recovering session:",n),ge()}},Rt=()=>{S&&J.clearSessionState(S.sessionId),ue(!1),ge()},ge=async()=>{try{u("loading");const n=await A.generateInterviewQuestions(l,t);if(n.length===0)throw new Error("No questions available for this configuration");b(n);const x=await A.createInterviewSession(r,l,t.id);y(x),w(l.durationMinutes*60),await Be(),u("ready")}catch(n){console.error("Error initializing interview:",n),alert(`Failed to initialize interview: ${n.message}`),c()}},Be=async()=>{try{const n=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});if(I.current=n,Ie(!0),k.current){k.current.srcObject=n,await new Promise(x=>{k.current&&(k.current.onloadedmetadata=()=>{x()})}),await new Promise(x=>setTimeout(x,100));try{await k.current.play()}catch(x){console.error("Error playing video:",x)}}}catch(n){console.error("Error accessing media devices:",n),Ie(!1),alert("Camera/microphone access denied. You can continue, but your responses will not be recorded.")}},qt=async()=>{if(await W.requestFullScreen(),u("question"),R(""),f&&P.isSupported())try{await P.speak(f.question_text,(n,x)=>{Te(x),Ee(x?n:"")},{rate:.9,pitch:1})}catch(n){console.error("Error with text-to-speech:",n)}Q.current&&clearTimeout(Q.current),Q.current=setTimeout(()=>{V.current||fe()},500)},fe=async()=>{if(!V.current){if(u("listening"),se.current=Date.now(),oe&&I.current)try{We.current=[];const n={mimeType:"video/webm;codecs=vp8,opus"};MediaRecorder.isTypeSupported(n.mimeType)||(n.mimeType="video/webm");const x=new MediaRecorder(I.current,n);x.ondataavailable=$=>{$.data.size>0&&We.current.push($.data)},x.start(1e3),F.current=x,ie(!0)}catch(n){console.error("Error starting media recorder:",n)}if(T.isSupported())try{await T.startListening(n=>R(n),n=>R(n),n=>console.error("Speech recognition error:",n))}catch(n){console.error("Failed to start speech recognition:",n)}if(I.current&&!(f!=null&&f.requires_coding))try{await z.initialize(I.current,{silenceThreshold:5e3,adaptive:!0,calibrationMs:1e3,minSpeechMs:250,hangoverMs:300,rmsMultiplier:2.8,absoluteRmsFloor:.035}),z.start(n=>{console.log("Silence detected for",n,"seconds")},()=>{Qe(!0),gt||ze(!0)})}catch(n){console.error("Failed to start silence detection:",n)}he.current=!1,$e(!1),ze(!1)}},we=async(n=!1)=>{const x=Math.floor((Date.now()-se.current)/1e3),$=n?z.getCurrentSilenceDuration():0;F.current&&F.current.state!=="inactive"&&(F.current.stop(),ie(!1)),T.isSupported()&&T.stopListening(),z.stop(),q.current&&(clearInterval(q.current),q.current=null),u("processing"),E(C),await At(x,n,$)},Ct=async()=>{$e(!0),await we(!0)},It=async()=>{if(!de){if(Me(!0),F.current&&F.current.state!=="inactive"&&(F.current.stop(),ie(!1)),T.isSupported()&&T.stopListening(),z.stop(),d&&f)try{await A.saveQuestionResponse(d,f,{question_id:f.id,answer_text:"[Question Skipped]",time_spent_seconds:0})}catch(n){console.error("Error saving skipped question:",n)}setTimeout(()=>{Me(!1),H()},1e3)}},Tt=async()=>{if(!_.trim()){alert("Please write some code first");return}Ue(!0),vt(!0);try{if(ee.length===0){const x=await je.generateTestCases(f.question_text,v);wt(x)}const n=await je.executeCode(_,v,ee);n.success&&n.executionResults?yt(n.executionResults):alert(n.error||"Execution failed")}catch(n){console.error("Execution error:",n),alert("Failed to execute code")}finally{Ue(!1)}},At=async(n,x=!1,$=0)=>{try{if(!d||!f)return;const ne=C||"No answer provided",Qt=ne.length>0,ye=_.trim().length>0,Ke={question_id:f.id,answer_text:Qt?ne:void 0,code_answer:ye?_:void 0,programming_language:ye?v:void 0,time_spent_seconds:n};if(await A.saveQuestionResponse(d,f,Ke),ye&&f.requires_coding){Ve(!0);const Mt=await A.generateCodeReviewQuestions(_,v,f.question_text);Ye(Mt),xe(0),u("code_review");return}const Xe=await A.analyzeAnswerAndGenerateFollowUp(f,Ke,t);if(Xe){Oe(Xe),Pe(!0),u("follow_up");return}u("feedback"),Y.current&&clearTimeout(Y.current),Y.current=setTimeout(()=>{V.current||H()},1200)}catch(ne){console.error("Error processing answer:",ne),alert("Failed to process answer. Moving to next question."),H()}},Et=async()=>{!te.trim()||!d||(await A.saveFollowUpResponse(d,f.question_number,B[U],te,Math.floor((Date.now()-se.current)/1e3)),U<B.length-1?(xe(U+1),pe("")):(Ve(!1),Ye([]),xe(0),pe(""),H()))},Dt=async()=>{if(!(!Z.trim()||!d))try{await A.saveFollowUpResponse(d,f.question_number,X.question_text,Z,Math.floor((Date.now()-se.current)/1e3)),Pe(!1),Oe(null),Le(""),H()}catch(n){console.error("Error submitting follow-up:",n)}},H=async()=>{if(!V.current)if(T.reset(),R(""),E(""),D(""),p+1<h.length){m(x=>x+1),u("question");const n=h[p+1];if(n&&P.isSupported())try{await P.speak(n.question_text,(x,$)=>{Te($),Ee($?x:"")},{rate:.9,pitch:1})}catch(x){console.error("Error with text-to-speech:",x)}Q.current&&clearTimeout(Q.current),Q.current=setTimeout(()=>{V.current||fe()},500)}else He()},He=async()=>{if(!d)return;const n=Math.floor((Date.now()-Nt.current)/1e3);await A.completeSession(d,n),await J.clearSessionState(d),W.exitFullScreen(),o(d)},re=()=>{M(!0),i==="listening"&&T.isSupported()&&T.stopListening(),P.pause()},Je=()=>{M(!1),K(!1),P.resume(),W.isFullScreen||W.requestFullScreen()},Ft=()=>{N?Je():re()},be=async()=>{window.confirm("End interview now and view your report? Your progress so far will be analyzed.")&&(V.current=!0,Ge(),await He())},Ge=()=>{F.current&&F.current.stop(),I.current&&I.current.getTracks().forEach(n=>n.stop()),L.current&&clearInterval(L.current),q.current&&clearInterval(q.current),Q.current&&(clearTimeout(Q.current),Q.current=null),Y.current&&(clearTimeout(Y.current),Y.current=null),z.cleanup(),P.stop(),T.reset()};return i==="loading"?e.jsx("div",{className:"min-h-screen bg-dark-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-300 text-lg",children:"Initializing interview..."})]})}):i==="ready"?e.jsx("div",{className:"min-h-screen bg-dark-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-dark-200 rounded-2xl p-8 max-w-2xl w-full text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-100 mb-4",children:"Ready to Start?"}),e.jsxs("p",{className:"text-gray-400 mb-6",children:["You will answer ",h.length," questions in ",l.durationMinutes," minutes. Speak clearly for verbal questions, and you can type code for coding challenges."]}),e.jsxs("div",{className:"bg-dark-300 rounded-lg p-4 mb-6 space-y-2",children:[e.jsx("p",{className:"text-gray-300 text-sm",children:oe?"✓ Camera and microphone are ready":"⚠ Media devices not available"}),e.jsx("p",{className:"text-gray-300 text-sm",children:P.isSupported()?"✓ AI voice enabled":"⚠ Text-to-speech not available"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"✓ Full-screen security mode will be enabled"})]}),e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-700 rounded-lg p-4 mb-6 text-left",children:[e.jsx("h3",{className:"text-yellow-400 font-semibold mb-2",children:"⚠️ Important Guidelines:"}),e.jsxs("ul",{className:"text-gray-300 text-sm space-y-1",children:[e.jsx("li",{children:"• The interview will run in full-screen mode"}),e.jsx("li",{children:"• Do not switch tabs or minimize the window"}),e.jsx("li",{children:"• Do not open other applications"}),e.jsx("li",{children:"• Violations will be tracked and reported"}),e.jsx("li",{children:"• Verbal answers auto-submit after 5 seconds of silence"}),e.jsx("li",{children:"• Code questions allow typing and testing your code"})]})]}),e.jsx("button",{onClick:qt,className:"btn-primary px-8 py-4 text-lg",children:"Start Interview"})]})}):jt&&i==="code_review"?e.jsx("div",{className:"min-h-screen bg-dark-100 text-white p-6",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"bg-dark-200 rounded-xl shadow-2xl p-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(qe,{className:"w-6 h-6 text-blue-400"}),"Code Review Question ",U+1,"/",B.length]})}),e.jsx("div",{className:"bg-dark-300 rounded-lg p-6 mb-6",children:e.jsx("p",{className:"text-lg text-gray-100",children:B[U]})}),e.jsxs("div",{className:"bg-dark-400 rounded-lg p-4 mb-6",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Your Code:"}),e.jsx("pre",{className:"text-sm text-gray-300 overflow-x-auto font-mono",children:_})]}),e.jsx("textarea",{value:te,onChange:n=>pe(n.target.value),className:"w-full h-40 px-4 py-3 bg-dark-300 text-white border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Explain your code and reasoning..."}),e.jsx("button",{onClick:Et,disabled:!te.trim(),className:"w-full mt-6 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-4 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:U<B.length-1?"Next Review Question":"Complete Code Review"})]})})}):ft&&X&&i==="follow_up"?e.jsx("div",{className:"min-h-screen bg-dark-100 text-white p-6",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"bg-dark-200 rounded-xl shadow-2xl p-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ae,{className:"w-6 h-6 text-yellow-400"}),"Follow-up Question"]})}),e.jsxs("div",{className:"bg-blue-900/30 border-l-4 border-blue-500 rounded-lg p-6 mb-6",children:[e.jsx("p",{className:"text-lg text-gray-100 mb-2",children:X.question_text}),e.jsxs("p",{className:"text-sm text-blue-300",children:["Reason: ",X.reason.replace("_"," ")]})]}),e.jsx("textarea",{value:Z,onChange:n=>Le(n.target.value),className:"w-full h-48 px-4 py-3 bg-dark-300 text-white border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Provide a detailed answer..."}),e.jsx("button",{onClick:Dt,disabled:!Z.trim(),className:"w-full mt-6 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-4 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Submit Answer & Continue"})]})})}):pt&&S?e.jsx(ys,{sessionData:{questionIndex:S.currentQuestionIndex,totalQuestions:S.totalQuestions,timeRemaining:S.timeRemaining,lastSaved:new Date(S.lastSaved).toLocaleString()},onRecover:kt,onStartNew:Rt}):e.jsxs("div",{className:"min-h-screen bg-dark-100 flex flex-col",children:[it&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[100] p-4",children:e.jsxs("div",{className:"bg-dark-200 rounded-2xl p-8 max-w-md w-full border-2 border-red-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Bt,{className:"w-8 h-8 text-red-500"}),e.jsx("h3",{className:"text-xl font-bold text-red-400",children:"Interview Paused"})]}),e.jsx("p",{className:"text-gray-300 mb-6",children:ot}),e.jsxs("div",{className:"bg-red-900/20 border border-red-700 rounded-lg p-4 mb-6",children:[e.jsxs("p",{className:"text-red-300 text-sm",children:[e.jsx("strong",{children:"Violations Detected:"})," ",De]}),e.jsxs("p",{className:"text-red-300 text-sm mt-1",children:[e.jsx("strong",{children:"Time Away:"})," ",_t.totalTimeAway,"s"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("button",{onClick:Je,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-colors",children:"Return to Interview"}),e.jsx("button",{onClick:be,className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition-colors",children:"End Interview & View Report"})]})]})}),e.jsx(ss,{userName:s,timeRemaining:g,currentQuestionIndex:p,totalQuestions:h.length,isPaused:N,totalViolations:De,isFullScreen:W.isFullScreen,onPause:Ft,onEnd:be,onEnterFullScreen:W.requestFullScreen}),e.jsx("div",{className:"flex-1 mt-20 pt-8 pb-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-2 md:px-4 grid lg:grid-cols-[280px_1fr_320px] gap-6 h-full",children:[e.jsx("div",{className:"bg-dark-200 rounded-xl p-6 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`w-32 h-32 rounded-full mx-auto mb-4 flex items-center justify-center transition-all ${le?"bg-gradient-to-br from-blue-500 to-purple-600 animate-pulse":"bg-gradient-to-br from-blue-500/50 to-purple-600/50"}`,children:e.jsx("span",{className:"text-4xl",children:"🤖"})}),e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"AI Interviewer"}),le&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-400",children:[e.jsx(st,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{className:"text-xs",children:"Speaking..."})]})]})}),e.jsx("div",{className:"bg-dark-200 rounded-xl p-6 flex flex-col justify-center max-h-[calc(100vh-180px)] overflow-y-auto",children:f&&e.jsxs("div",{children:[e.jsx(bs,{questionNumber:p+1,totalQuestions:h.length,questionText:f.question_text,questionType:f.question_type,difficulty:f.difficulty_level,requiresCoding:f.requires_coding,relatedSkills:[]}),le&&Ae&&e.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(st,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-blue-400 text-sm",children:"AI is speaking:"})]}),e.jsx("p",{className:"text-gray-300 text-sm italic",children:Ae})]}),f.requires_coding?e.jsxs("div",{className:"space-y-4 mt-6",children:[i==="listening"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Explain Your Approach (Voice)"]}),e.jsx(rt,{transcript:C,isListening:!0,placeholder:"Start speaking to explain your approach..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Write Your Code"]}),e.jsx("select",{value:v,onChange:n=>G(n.target.value),className:"px-3 py-1 bg-dark-300 border border-gray-600 rounded text-sm text-white",children:je.getSupportedLanguages().map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsx(gs,{value:_,onChange:D,language:v,placeholder:`Write your ${v} code here...`,height:"400px"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Tt,disabled:me||!_.trim(),className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-all disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(ms,{className:"w-5 h-5"}),me?"Running...":"Run & Test Code"]}),e.jsx("button",{onClick:()=>we(!1),disabled:i!=="listening"&&i!=="question",className:"flex-1 btn-primary py-3",children:"Submit Answer"})]}),ee.length>0&&e.jsx(fs,{testCases:ee,executionResults:bt,isExecuting:me})]}):e.jsxs("div",{className:"mt-6",children:[i==="listening"&&e.jsxs("div",{className:"space-y-4",children:[mt&&e.jsx("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"text-blue-300 text-sm flex-1",children:[e.jsx("strong",{className:"text-blue-200 text-base",children:"📌 Auto-Submit Info:"}),e.jsxs("p",{className:"mt-1",children:["Your answer will automatically submit after ",e.jsx("strong",{children:"5 seconds"})," of silence."]})]}),e.jsx("button",{onClick:()=>xt(!1),className:"text-blue-400 hover:text-blue-300 text-lg font-bold leading-none",children:"✕"})]})}),e.jsx(rt,{transcript:C,isListening:!0,placeholder:"Start speaking..."}),e.jsx(ws,{isSpeaking:dt,isListening:!0,silenceCountdown:lt}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>we(!1),className:"flex-1 btn-primary py-3",disabled:ut,children:"Submit Answer"}),e.jsx("button",{onClick:It,className:"flex items-center justify-center gap-2 px-4 py-3 bg-gray-700 hover:bg-gray-600 text-gray-200 rounded-lg transition-colors",disabled:de,children:de?e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Skipping..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Skip"})]})})]})]}),i==="processing"&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-pulse text-blue-400 mb-2",children:"Processing..."}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Analyzing your response"})]}),i==="feedback"&&e.jsxs("div",{className:"bg-green-900/20 border border-green-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-green-400",children:"✓ Answer recorded successfully!"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Moving to next question..."})]})]})]})}),e.jsxs("div",{className:"bg-dark-200 rounded-xl p-6 flex flex-col",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-4",children:"Your Camera"}),e.jsxs("div",{className:"flex-1 bg-dark-300 rounded-lg overflow-hidden relative",style:{minHeight:"400px"},children:[e.jsx("video",{ref:k,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover min-h-[400px]"}),!oe&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-dark-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ht,{className:"w-12 h-12 text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Camera not available"})]})})]}),e.jsx("div",{className:"mt-4 flex items-center justify-center gap-2",children:at?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-5 h-5 text-red-500 animate-pulse"}),e.jsx("span",{className:"text-red-500 text-sm font-semibold",children:"Recording"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"Not Recording"})]})})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-dark-200 border-t border-dark-300 py-3",children:e.jsx("div",{className:"max-w-7xl mx-auto px-2 md:px-4 text-center text-sm text-gray-400",children:i==="listening"?"Listening to your answer...":i==="processing"?"Processing your answer...":i==="question"?"AI is asking the question...":"Ready to continue"})})]})},rr=()=>{const l=Pt(),{user:t}=nt(),[r,s]=a.useState("type-selection"),[o,c]=a.useState("general"),[i,u]=a.useState(""),[d,y]=a.useState(""),[h,b]=a.useState(null),[p,m]=a.useState(null),[g,w]=a.useState(null),N=v=>{c(v),s(v==="general"?"role-selection":"company-role-selection")},M=v=>{u(v),s("resume-upload")},C=(v,G)=>{y(v),u(G),s("resume-upload")},R=v=>{b(v),s("duration-config")},j=v=>{m(v),s("interview")},E=v=>{w(v),s("summary")},_=()=>{s("type-selection"),c("general"),u(""),y(""),b(null),m(null),w(null)},D=()=>{r==="role-selection"||r==="company-role-selection"?s("type-selection"):r==="resume-upload"?s(o==="general"?"role-selection":"company-role-selection"):r==="duration-config"?s("resume-upload"):r==="interview"?s("duration-config"):l(-1)};return t?e.jsxs(e.Fragment,{children:[r==="type-selection"&&e.jsx(Jt,{onTypeSelected:N,onBack:()=>l(-1)}),r==="role-selection"&&e.jsx(Gt,{onRoleSelected:M,onBack:D}),r==="company-role-selection"&&e.jsx(Kt,{onCompanyRoleSelected:C,onBack:D}),r==="resume-upload"&&e.jsx(ps,{interviewType:o,selectedRole:i,selectedCompany:d,onResumeUploaded:R,onBack:D}),r==="duration-config"&&h&&e.jsx(Xt,{interviewType:o,selectedRole:i,selectedCompany:d,resume:h,onConfigComplete:j,onBack:D}),r==="interview"&&p&&h&&e.jsx(Ns,{config:p,resume:h,userId:t.id,userName:t.name,onInterviewComplete:E,onBack:D}),r==="summary"&&g&&e.jsx(as,{sessionId:g,onRetake:_,onBackHome:()=>l("/")})]}):(l("/"),null)};export{rr as UnifiedInterviewOrchestrator};
