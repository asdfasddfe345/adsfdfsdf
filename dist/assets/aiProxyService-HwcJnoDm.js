const m="https://rixmudvtbfkjpwjoefon.supabase.co",h="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpeG11ZHZ0YmZranB3am9lZm9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1ODk4NzIsImV4cCI6MjA2NjE2NTg3Mn0.PQss75_gbLaiJDFxKvCuHNirUVkKUGrINYGO1oewQGA",p=`${m}/functions/v1/ai-proxy`,l="",u=l.length>10;console.log("ðŸ”§ AI Proxy Mode:",u?"LOCAL (using .env keys)":"PROXY (using Supabase Edge Function)");const c=async(e,t,o={})=>{const r=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({service:e,action:t,...o})}),s=await r.json();if(!r.ok)throw new Error(s.error||`Proxy request failed: ${r.status}`);return s},g=e=>new Promise((t,o)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=()=>{const s=r.result;t(s.split(",")[1])},r.onerror=o}),y={async extractText(e){return u?this.extractTextLocal(e):this.extractTextViaProxy(e)},async extractTextLocal(e){console.log("ðŸ“„ Starting OCR with LOCAL API key...",e.name,e.type);const t=new FormData;t.append("file",e,e.name),t.append("providers","mistral"),t.append("language","en");const r=await(await fetch("https://api.edenai.run/v2/ocr/ocr_async",{method:"POST",headers:{Authorization:`Bearer ${l}`},body:t})).json();return console.log("ðŸ“„ OCR job started:",r.public_id?"async":"sync",r),r.public_id?await this.pollOCRLocal(r.public_id):this.extractTextFromResult(r)},async pollOCRLocal(e,t=30){console.log("ðŸ“„ Polling OCR job (local):",e);for(let o=0;o<t;o++){await new Promise(a=>setTimeout(a,2e3));const s=await(await fetch(`https://api.edenai.run/v2/ocr/ocr_async/${e}`,{headers:{Authorization:`Bearer ${l}`}})).json();if(console.log(`ðŸ“„ Poll ${o+1}/${t}: status=${s.status}`),s.status==="finished"){console.log("ðŸ“„ OCR finished!");const a=s.results||s;return this.extractTextFromResult(a)}if(s.status==="failed")throw console.error("ðŸ“„ OCR failed:",s),new Error(`OCR failed: ${s.error||"Unknown error"}`)}throw new Error("OCR timeout - job did not complete in time")},async extractTextViaProxy(e){console.log("ðŸ“„ Starting OCR via Supabase proxy...",e.name,e.type);const t=await g(e);console.log("ðŸ“„ File converted to base64, length:",t.length);const o=await c("edenai","ocr_async",{fileBase64:t,fileName:e.name,fileType:e.type});return console.log("ðŸ“„ OCR job started:",o.public_id?"async":"sync",o),o.public_id?await this.pollOCR(o.public_id):this.extractTextFromResult(o)},async pollOCR(e,t=30){console.log("ðŸ“„ Polling OCR job:",e);for(let o=0;o<t;o++){await new Promise(s=>setTimeout(s,2e3));const r=await c("edenai","ocr_status",{jobId:e});if(console.log(`ðŸ“„ Poll ${o+1}/${t}: status=${r.status}`),r.status==="finished"){console.log("ðŸ“„ OCR finished! Full result:",JSON.stringify(r).slice(0,1e3));const s=r.results||r;return this.extractTextFromResult(s)}if(r.status==="failed")throw console.error("ðŸ“„ OCR failed:",r),new Error(`OCR failed: ${r.error||"Unknown error"}`)}throw new Error("OCR timeout - job did not complete in time")},extractTextFromResult(e){var o,r,s,a;console.log("ðŸ“„ Extracting text from OCR result:",JSON.stringify(e).slice(0,500));const t=i=>i.map(n=>n.lines&&Array.isArray(n.lines)?n.lines.map(d=>d.text||"").join(`
`):n.text?n.text:n.content?n.content:"").filter(Boolean).join(`

`);if((o=e.mistral)!=null&&o.text)return console.log("ðŸ“„ Found mistral.text"),e.mistral.text;if((r=e.mistral)!=null&&r.pages){console.log("ðŸ“„ Found mistral.pages");const i=t(e.mistral.pages);return console.log("ðŸ“„ Extracted text length:",i.length),i}if(e.results){if(console.log("ðŸ“„ Found results wrapper, checking inside..."),(s=e.results.mistral)!=null&&s.text)return e.results.mistral.text;if((a=e.results.mistral)!=null&&a.pages)return t(e.results.mistral.pages);for(const i of Object.keys(e.results)){const n=e.results[i];if(n!=null&&n.text)return n.text;if(n!=null&&n.pages)return t(n.pages)}}for(const i of Object.keys(e)){if(i==="status"||i==="public_id")continue;const n=e[i];if(n!=null&&n.text)return console.log(`ðŸ“„ Found ${i}.text`),n.text;if(n!=null&&n.pages)return console.log(`ðŸ“„ Found ${i}.pages`),t(n.pages)}throw console.error("ðŸ“„ No text found in result:",e),new Error("No text extracted from OCR result")},async chat(e,t={}){return u?this.chatLocal(e,t):this.chatViaProxy(e,t)},async chatLocal(e,t={}){console.log("ðŸ’¬ Chat with LOCAL API key...");const r=await(await fetch("https://api.edenai.run/v2/text/chat",{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({providers:t.provider||"openai/gpt-4o-mini",text:e,chatbot_global_action:"You are an expert assistant.",previous_history:[],temperature:t.temperature||.1,max_tokens:t.maxTokens||4e3})})).json();console.log("ðŸ’¬ Chat response:",JSON.stringify(r).slice(0,500));const s=Object.keys(r).find(a=>{var i;return(i=r[a])==null?void 0:i.generated_text});if(s)return r[s].generated_text;throw console.error("ðŸ’¬ No generated_text found in response:",JSON.stringify(r,null,2)),new Error("No response from EdenAI chat")},async chatViaProxy(e,t={}){const o=await c("edenai","chat",{prompt:e,provider:t.provider||"openai/gpt-4o-mini",temperature:t.temperature||.1,maxTokens:t.maxTokens||4e3}),r=Object.keys(o).find(s=>{var a;return(a=o[s])==null?void 0:a.generated_text});if(r)return o[r].generated_text;throw console.error("ðŸ’¬ No generated_text found in proxy response:",JSON.stringify(o,null,2)),new Error("No response from EdenAI chat")},async summarize(e,t="medium"){const o=await c("edenai","summarize",{text:e,outputLength:t}),r=Object.keys(o).find(s=>{var a;return(a=o[s])==null?void 0:a.result});if(r)return o[r].result;throw new Error("No summary generated")},async moderate(e){return c("edenai","moderation",{text:e})},async spellCheck(e){return c("edenai","spell_check",{text:e})}},x={async chat(e,t={}){var r,s,a;return((a=(s=(r=(await c("openrouter","chat",{prompt:e,model:t.model||"google/gemini-2.5-flash",temperature:t.temperature||.3,maxTokens:t.maxTokens||4e3})).choices)==null?void 0:r[0])==null?void 0:s.message)==null?void 0:a.content)||""},async chatWithSystem(e,t,o={}){var s,a,i;return((i=(a=(s=(await c("openrouter","chat_with_system",{systemPrompt:e,userPrompt:t,model:o.model||"google/gemini-2.5-flash",temperature:o.temperature||.3})).choices)==null?void 0:s[0])==null?void 0:a.message)==null?void 0:i.content)||""}},f={async getUser(e){return c("github","user",{username:e})},async getRepo(e,t){return c("github","repo",{owner:e,repo:t})},async getCommits(e,t){return c("github","commits",{owner:e,repo:t})},async searchRepos(e,t={}){return c("github","search_repos",{query:e,sort:t.sort||"stars",order:t.order||"desc",perPage:t.perPage||10})}};export{y as e,f as g,x as o};
