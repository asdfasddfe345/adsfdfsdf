import{j as e}from"./vendor-motion-_XdJ9pBm.js";import{r as m}from"./vendor-react-B4msnGgW.js";import{e as p}from"./aiProxyService-HwcJnoDm.js";import{a as K,C as q,S as R,X as V,l as O,p as C}from"./index-BbSeE-q4.js";import{Q as Z}from"./quote-DhoHTT2m.js";import{U as ee}from"./upload-CurydzNZ.js";const te=p.extractText.bind(p),re=p.chat.bind(p);p.summarize.bind(p);const F=45e3,se=async s=>{let a="";try{if(s.type==="text/plain"||s.name.endsWith(".txt"))a=await s.text();else try{a=await te(s)}catch{try{const c=await s.text();if(c.substring(0,2e3).replace(/[\x00-\x08\x0E-\x1F\x7F-\xFF]/g,"").length>200)a=c.replace(/[\x00-\x08\x0E-\x1F]/g," ").replace(/\s+/g," ").trim();else throw new Error("File content is not readable text")}catch{throw new Error("OCR extraction failed. Please try a different file format (PDF, DOCX, or TXT).")}}if(!a||a.length<50)throw new Error("Could not extract enough text from file. Please ensure the file contains readable text.");const n=await U(a);if(n.name==="John Doe"||n.email==="johndoe@example.com")throw console.warn("⚠️ Got placeholder data"),new Error("Placeholder data received");return ie(n),n}catch(n){throw console.error("❌ PARSING FAILED:",n.message),new Error(`Failed to parse resume: ${n.message}`)}},U=async(s,a=0)=>{const l=o=>new Promise(d=>setTimeout(d,o)),c=`Parse this resume and extract ALL information. Return ONLY valid JSON.

RESUME TEXT:
"""
${s.slice(0,12e3)}
"""

Return JSON with this exact structure:
{
  "name": "Full name from resume",
  "phone": "Phone number",
  "email": "Email address",
  "linkedin": "LinkedIn URL",
  "github": "GitHub URL",
  "location": "City, State",
  "summary": "Professional summary or objective",
  "education": [{"degree": "Degree name", "school": "School name", "year": "Year", "cgpa": "GPA if mentioned", "location": "Location"}],
  "workExperience": [{"role": "Job title", "company": "Company name", "year": "Date range", "bullets": ["Achievement 1", "Achievement 2"]}],
  "projects": [{"title": "Project name", "bullets": ["Description 1", "Description 2"], "githubUrl": "URL if any"}],
  "skills": [{"category": "Category name", "list": ["Skill1", "Skill2"]}],
  "certifications": [{"title": "Cert name", "description": "Details"}]
}

IMPORTANT: Extract ACTUAL data from the resume text. Do NOT use placeholder values like "John Doe".`;try{const o=await re(c,{provider:"openai/gpt-4o-mini",temperature:.1,maxTokens:4e3});if(!o)throw new Error("Empty response from Chat API");const d=o.match(/\{[\s\S]*\}/);if(!d)throw new Error("No JSON in response");const u=JSON.parse(d[0]);return ae(u,s,{proxy:!0})}catch(o){if(a<2)return await l(2e3),U(s,a+1);throw o}},ae=(s,a,n)=>{const l=a.length>F?a.substring(0,F)+"... [truncated]":a,c=(s.education||[]).map(r=>({degree:r.degree||"",school:r.school||"",year:r.year||"",cgpa:r.cgpa||"",location:r.location||""})),o=(s.workExperience||[]).map(r=>({role:r.role||"",company:r.company||"",year:r.year||"",bullets:Array.isArray(r.bullets)?r.bullets:[]})),d=(s.projects||[]).map(r=>({title:r.title||"",bullets:Array.isArray(r.bullets)?r.bullets:[],githubUrl:r.githubUrl||""})),u=(s.skills||[]).map(r=>{if(typeof r=="string")return{category:"Skills",count:1,list:[r]};const f=Array.isArray(r.list)?r.list:[];return{category:r.category||"Skills",count:f.length,list:f}}),g=(s.certifications||[]).map(r=>({title:r.title||"",description:r.description||""}));return{name:s.name||"",phone:s.phone||"",email:s.email||"",linkedin:s.linkedin||"",github:s.github||"",location:s.location||"",summary:s.summary||"",careerObjective:s.summary||"",education:c,workExperience:o,projects:d,skills:u,certifications:g,parsedText:l,parsingConfidence:.95,rawEdenResponse:n,origin:"eden_parsed"}},ie=s=>{},P=["ATS scans your resume in seconds — make every keyword count!","75% of resumes are rejected by ATS before a human sees them.","Simple formatting = Higher ATS compatibility.","Keywords from the job description boost your ATS score significantly.","Avoid tables and graphics — ATS can't read them properly.","Use standard section headings like 'Experience' and 'Education'.","PDF and DOCX are the safest formats for ATS systems.","Quantify your achievements — numbers catch both ATS and recruiters' attention.","Tailor your resume for each job to maximize ATS match.","Action verbs like 'Developed', 'Led', 'Optimized' improve ATS scoring.","Your resume's first 6 seconds determine if you get shortlisted.","Include both acronyms and full forms (e.g., 'SEO' and 'Search Engine Optimization').","ATS ranks resumes by keyword density and relevance.","A clean, single-column layout is ATS-friendly.","Skills section should mirror the job description's requirements."],xe=({onFileUpload:s,onParsedResume:a,isAuthenticated:n=!0,onShowAuth:l,requireAuth:c=!1,userId:o,creditType:d="optimization",onShowSubscriptionPlans:u,onCreditCheckPassed:g})=>{const r=m.useRef(null),[f,j]=m.useState(!1),[y,N]=m.useState(null),[h,k]=m.useState(!1),[v,b]=m.useState(null),[I,w]=m.useState(!1),[z,L]=m.useState(0),[_,T]=m.useState(!1),[X,E]=m.useState(!1);m.useEffect(()=>{if(!h)return;const t=setInterval(()=>{L(i=>(i+1)%P.length)},3e3);return()=>clearInterval(t)},[h]);const G=async()=>{if(!o)return!0;try{const t=await C.getUserSubscription(o);if(d==="optimization"){const i=t?t.optimizationsTotal-t.optimizationsUsed:0,x=await C.getAddOnCreditsByType(o,"optimization");return Math.max(0,i)+x>0}else if(d==="score_check"){const i=t?t.scoreChecksTotal-t.scoreChecksUsed:0,x=await C.getAddOnCreditsByType(o,"score_check");return Math.max(0,i)+x>0}return!0}catch(t){return console.error("[FileUpload] Error checking credits:",t),!1}},A=async()=>{if(!o)return c&&!n||u?(l&&l(),!1):!0;if(!u)return!0;E(!0);const t=await G();return E(!1),t?!0:(T(!0),!1)},S=async t=>c&&!n?(l&&l(),!1):(await Q(t),!0),M=async()=>{var i;if(h||y)return;if(c&&!n){l&&l();return}await A()&&((i=r.current)==null||i.click())},J=async t=>{var x;const i=(x=t.target.files)==null?void 0:x[0];i&&(b(null),await S(i))},Q=async t=>{k(!0),b(null),w(!1);try{const i=await se(t),x={text:i.parsedText,extraction_mode:"TEXT",trimmed:!1,filename:t.name};s(x,t),a&&a(i),N(t.name),w(!0),g&&g()}catch(i){console.error("❌ EdenAI parsing failed:",i),b(i.message||"Failed to parse resume. Please try again or use a different file."),N(null),s({text:"",extraction_mode:"TEXT",trimmed:!1}),a&&a(null)}finally{k(!1)}},W=t=>{t.preventDefault(),j(!0)},Y=t=>{t.preventDefault(),j(!1)},$=async t=>{t.preventDefault(),j(!1);const i=t.dataTransfer.files[0];if(!i)return;if(c&&!n){l&&l();return}await A()&&(b(null),await S(i))},D=()=>{N(null),b(null),w(!1),s({text:"",extraction_mode:"TEXT",trimmed:!1}),a&&a(null),r.current&&(r.current.value="")},B=()=>{var t;D(),(t=r.current)==null||t.click()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:`relative border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200 ${h?"border-emerald-400 bg-emerald-500/5 cursor-wait":v?"border-red-400 bg-red-500/5 cursor-pointer":y?"border-emerald-400 bg-emerald-500/5":f?"border-cyan-400 bg-cyan-500/5 cursor-pointer":"border-slate-700 bg-slate-800/30 hover:border-emerald-500/50 hover:bg-slate-800/50 cursor-pointer"}`,onDragOver:W,onDragLeave:Y,onDrop:$,onClick:M,children:h?e.jsxs("div",{className:"flex flex-col items-center py-4",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-base font-medium text-slate-200 mb-1",children:"AI parsing your resume..."}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Extracting structured data from your resume"}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-slate-800/50 rounded-lg border border-slate-700/50 max-w-sm transition-all duration-300",children:[e.jsx(Z,{className:"w-4 h-4 text-amber-400 flex-shrink-0"}),e.jsxs("p",{className:"text-amber-300 text-xs italic text-center",children:['"',P[z],'"']})]})]}):v?e.jsxs("div",{className:"flex flex-col items-center py-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-red-500/10 flex items-center justify-center mb-4",children:e.jsx(K,{className:"w-7 h-7 text-red-400"})}),e.jsx("p",{className:"text-base font-medium text-red-300 mb-1",children:"Parsing Failed"}),e.jsx("p",{className:"text-sm text-red-400/80 mb-4 max-w-sm",children:v}),e.jsx("button",{onClick:t=>{t.stopPropagation(),B()},className:"flex items-center gap-2 text-emerald-400 hover:text-emerald-300 font-medium text-sm transition-colors px-4 py-2 rounded-lg hover:bg-emerald-500/10",children:e.jsx("span",{children:"Try again"})})]}):y?e.jsxs("div",{className:"flex flex-col items-center py-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-emerald-500/10 flex items-center justify-center mb-4 shadow-emerald-glow",children:e.jsx(q,{className:"w-7 h-7 text-emerald-400"})}),e.jsx("p",{className:"text-base font-medium text-emerald-300 mb-1",children:"Resume parsed successfully!"}),e.jsx("p",{className:"text-sm text-slate-400 mb-2 truncate max-w-[200px] sm:max-w-xs text-center px-2",children:y}),I&&e.jsxs("div",{className:"flex items-center gap-2 text-emerald-400 text-xs mb-3",children:[e.jsx(R,{className:"w-3 h-3"}),e.jsx("span",{children:"AI-powered structured extraction complete"})]}),e.jsxs("button",{onClick:t=>{t.stopPropagation(),D()},className:"flex items-center gap-2 text-red-400 hover:text-red-300 font-medium text-sm transition-colors px-4 py-2 rounded-lg hover:bg-red-500/10",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"Remove"})]})]}):X?e.jsxs("div",{className:"flex flex-col items-center py-4",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-base font-medium text-slate-200 mb-1",children:"Checking credits..."}),e.jsx("p",{className:"text-sm text-slate-400",children:"Please wait"})]}):e.jsxs("div",{className:"flex flex-col items-center py-4",children:[e.jsx("div",{className:`w-14 h-14 rounded-full flex items-center justify-center mb-4 transition-colors ${f?"bg-cyan-500/20":"bg-slate-700/50"}`,children:e.jsx(ee,{className:`w-7 h-7 transition-colors ${f?"text-cyan-400":"text-slate-400"}`})}),e.jsx("p",{className:"text-base font-medium text-slate-200 mb-1",children:f?"Drop your file here":"Upload your resume"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Drag and drop your file here, or click to browse"})]})}),e.jsx("input",{ref:r,type:"file",accept:".pdf,.docx,.txt",onChange:J,className:"hidden"}),e.jsx("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-emerald-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-slate-200 mb-2",children:"AI-Powered Resume Parsing"}),e.jsx("p",{className:"text-slate-400 text-xs mb-3",children:"Our AI parser extracts structured data including contact info, experience, education, skills, and projects."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full"}),e.jsx("span",{children:"PDF files (.pdf)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-cyan-400 rounded-full"}),e.jsx("span",{children:"Word documents (.docx)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full"}),e.jsx("span",{children:"Text files (.txt)"})]})]})]})]})}),_&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl p-6 max-w-md w-full shadow-2xl",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-500/20 flex items-center justify-center",children:e.jsx(O,{className:"w-8 h-8 text-amber-400"})})}),e.jsx("h3",{className:"text-xl font-bold text-slate-100 text-center mb-2",children:d==="optimization"?"Optimization Credits Required":"Score Check Credits Required"}),e.jsx("p",{className:"text-slate-400 text-center mb-6",children:d==="optimization"?"You need credits to optimize your resume against the job description. Get credits to unlock AI-powered optimization.":"You need credits to check your resume score. Get credits to see your ATS compatibility score."}),e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs("button",{onClick:()=>{T(!1),u&&u(d==="optimization"?"jd-optimizer":"score-checker")},className:"w-full py-3 px-4 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white font-semibold rounded-xl hover:from-emerald-400 hover:to-cyan-400 transition-all flex items-center justify-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Get Credits"]})})]})})]})};export{xe as F};
